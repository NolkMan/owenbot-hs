<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This is the code for the main engine.  This captures the posix subexpressions. This 'execMatch'</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- also dispatches to &quot;Engine_NC&quot;, &quot;Engine_FA&quot;, and &quot;Engine_FC_NA&quot;</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- </span><span>
</span><span id="line-4"></span><span class="hs-comment">-- It is polymorphic over the internal Uncons type class, and specialized to produce the needed</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- variants.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text.Regex.TDFA.NewDFA.Engine</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-identifier">execMatch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">liftM2</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">join</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">filterM</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.Base</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeRead</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">unsafeWrite</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">STUArray</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- #ifdef __GLASGOW_HASKELL__</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Arr</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">STArray</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.ST</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MutableByteArray#</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">RealWorld</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">Int#</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">sizeofMutableByteArray#</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">unsafeCoerce#</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-comment">{-
-- #else
import Control.Monad.ST(ST)
import Data.Array.ST(STArray)
-- #endif
-}</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.MArray</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MArray</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.Unsafe</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeFreeze</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.IArray</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Array</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">bounds</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">assocs</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">Ix</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">rangeSize</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">range</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Data.IntMap.CharMap2.html"><span class="hs-identifier">Data.IntMap.CharMap2</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CMap</span></span><span class="hs-special">(</span><span class="annot"><a href="Data.IntMap.CharMap2.html#findWithDefault"><span class="hs-identifier">findWithDefault</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IMap</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">insert</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mon</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monoid</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ISet</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toAscList</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Array.IArray</span></span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">sortBy</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">groupBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.STRef</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">STRef</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">newSTRef</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">readSTRef</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">writeSTRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">runST</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">strictToLazyST</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ST</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Seq</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">ViewL</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">viewl</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LBS</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex.Base</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MatchArray</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">MatchOffset</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">MatchLength</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html"><span class="hs-identifier">Text.Regex.TDFA.IntArrTrieSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Trie</span></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.IntArrTrieSet.html#lookupAsc"><span class="hs-identifier">lookupAsc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html"><span class="hs-identifier">Text.Regex.TDFA.Common</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#indent"><span class="hs-identifier">indent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Uncons.html"><span class="hs-identifier">Text.Regex.TDFA.NewDFA.Uncons</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Uncons.html#Uncons"><span class="hs-identifier">Uncons</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Uncons.html#uncons"><span class="hs-identifier">uncons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.MakeTest.html"><span class="hs-identifier">Text.Regex.TDFA.NewDFA.MakeTest</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.MakeTest.html#test_singleline"><span class="hs-identifier">test_singleline</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.MakeTest.html#test_multiline"><span class="hs-identifier">test_multiline</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine_FA.html"><span class="hs-identifier">Text.Regex.TDFA.NewDFA.Engine_FA</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FA</span></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine_FA.html#execMatch"><span class="hs-identifier">execMatch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine_NC.html"><span class="hs-identifier">Text.Regex.TDFA.NewDFA.Engine_NC</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NC</span></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine_NC.html#execMatch"><span class="hs-identifier">execMatch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine_NC_FA.html"><span class="hs-identifier">Text.Regex.TDFA.NewDFA.Engine_NC_FA</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NC_FA</span></span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine_NC_FA.html#execMatch"><span class="hs-identifier">execMatch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">--import Debug.Trace</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">-- trace :: String -&gt; a -&gt; a</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- trace _ a = a</span><span>
</span><span id="line-54"></span><span class="hs-comment">{-
see :: (Show x, Monad m) =&gt; String -&gt;  x -&gt; m a -&gt; m a
see _ _ m = m
--see msg s m = trace (&quot;\nsee: &quot;++msg++&quot; : &quot;++show s) m

sees :: (Monad m) =&gt; String -&gt;  String -&gt; m a -&gt; m a
sees _ _ m = m
--sees msg s m = trace (&quot;\nsee: &quot;++msg++&quot; :\n&quot;++s) m
-}</span><span>
</span><span id="line-63"></span><span id="local-6989586621679093853"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093853"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-64"></span><span id="err"><span class="annot"><span class="annottext">err :: String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679093625"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679093625"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; a
forall a. String -&gt; String -&gt; a
</span><a href="Text.Regex.TDFA.Common.html#common_error"><span class="hs-identifier hs-var">common_error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Text.Regex.TDFA.NewDFA.Engine&quot;</span></span><span>  </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679093625"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">!!</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-67"></span><span id="local-6989586621679093849"><span id="local-6989586621679093850"><span id="local-6989586621679093851"><span id="local-6989586621679093852"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-type">(!!)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093852"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093851"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093850"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Ix</span></span><span> </span><span class="annot"><a href="#local-6989586621679093849"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093852"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093849"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093851"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093850"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093851"><span class="hs-identifier hs-type">e</span></a></span></span></span></span></span><span>
</span><span id="line-68"></span><span id="%21%21"><span class="annot"><span class="annottext">!! :: a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var hs-var">(!!)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a i e -&gt; Int -&gt; ST s e
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; Int -&gt; m e
</span><span class="hs-identifier hs-var">unsafeRead</span></span><span>
</span><span id="line-69"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-pragma hs-type">set</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-70"></span><span id="local-6989586621679093822"><span id="local-6989586621679093823"><span id="local-6989586621679093824"><span id="local-6989586621679093825"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093824"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093823"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Ix</span></span><span> </span><span class="annot"><a href="#local-6989586621679093822"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093822"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093824"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093824"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093823"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-71"></span><span id="set"><span class="annot"><span class="annottext">set :: a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a i e -&gt; Int -&gt; e -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; m ()
</span><span class="hs-identifier hs-var">unsafeWrite</span></span><span>
</span><span id="line-72"></span><span> </span><span>
</span><span id="line-73"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-pragma hs-type">execMatch</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-pragma hs-type">Regex</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-pragma hs-type">Position</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Char</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">[</span><span class="hs-pragma">]</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Char</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">[</span><span class="annot"><span class="hs-pragma hs-type">MatchArray</span></span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-74"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-pragma hs-type">execMatch</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-pragma hs-type">Regex</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-pragma hs-type">Position</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Char</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Seq</span></span><span> </span><span class="annot"><span class="hs-pragma hs-type">Char</span></span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">[</span><span class="annot"><span class="hs-pragma hs-type">MatchArray</span></span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-75"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-pragma hs-type">execMatch</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-pragma hs-type">Regex</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-pragma hs-type">Position</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Char</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">SBS.ByteString</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">[</span><span class="annot"><span class="hs-pragma hs-type">MatchArray</span></span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-76"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-pragma hs-type">execMatch</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-pragma hs-type">Regex</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-pragma hs-type">Position</span></a></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Char</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="annot"><span class="hs-pragma hs-type">LBS.ByteString</span></span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">[</span><span class="annot"><span class="hs-pragma hs-type">MatchArray</span></span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-77"></span><span id="local-6989586621679093620"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-identifier hs-type">execMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Uncons.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093620"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093620"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MatchArray</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-78"></span><span id="execMatch"><span class="annot"><span class="annottext">execMatch :: Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#execMatch"><span class="hs-identifier hs-var hs-var">execMatch</span></a></span></span><span> </span><span id="local-6989586621679093619"><span class="annot"><span class="annottext">r :: Regex
</span><a href="#local-6989586621679093619"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Regex"><span class="hs-identifier hs-type">Regex</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">regex_dfa :: Regex -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#regex_dfa"><span class="hs-identifier hs-var">regex_dfa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">d_id :: DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093614"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093614"><span class="hs-identifier hs-var">didIn</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d_dt :: DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093612"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093612"><span class="hs-identifier hs-var">dtIn</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_init :: Regex -&gt; Int
</span><a href="Text.Regex.TDFA.Common.html#regex_init"><span class="hs-identifier hs-var">regex_init</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093610"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093610"><span class="hs-identifier hs-var">startState</span></a></span></span><span>
</span><span id="line-80"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_b_index :: Regex -&gt; (Int, Int)
</span><a href="Text.Regex.TDFA.Common.html#regex_b_index"><span class="hs-identifier hs-var">regex_b_index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093608"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093608"><span class="hs-identifier hs-var">b_index</span></a></span></span><span>
</span><span id="line-81"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_b_tags :: Regex -&gt; (Int, Int)
</span><a href="Text.Regex.TDFA.Common.html#regex_b_tags"><span class="hs-identifier hs-var">regex_b_tags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093606"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093606"><span class="hs-identifier hs-var">b_tags_all</span></a></span></span><span>
</span><span id="line-82"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_trie :: Regex -&gt; TrieSet DFA
</span><a href="Text.Regex.TDFA.Common.html#regex_trie"><span class="hs-identifier hs-var">regex_trie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093604"><span class="annot"><span class="annottext">TrieSet DFA
</span><a href="#local-6989586621679093604"><span class="hs-identifier hs-var">trie</span></a></span></span><span>
</span><span id="line-83"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_tags :: Regex -&gt; Array Int OP
</span><a href="Text.Regex.TDFA.Common.html#regex_tags"><span class="hs-identifier hs-var">regex_tags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093602"><span class="annot"><span class="annottext">Array Int OP
</span><a href="#local-6989586621679093602"><span class="hs-identifier hs-var">aTags</span></a></span></span><span>
</span><span id="line-84"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_groups :: Regex -&gt; Array Int [GroupInfo]
</span><a href="Text.Regex.TDFA.Common.html#regex_groups"><span class="hs-identifier hs-var">regex_groups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093600"><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093600"><span class="hs-identifier hs-var">aGroups</span></a></span></span><span>
</span><span id="line-85"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_isFrontAnchored :: Regex -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#regex_isFrontAnchored"><span class="hs-identifier hs-var">regex_isFrontAnchored</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093598"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093598"><span class="hs-identifier hs-var">frontAnchored</span></a></span></span><span>
</span><span id="line-86"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_compOptions :: Regex -&gt; CompOption
</span><a href="Text.Regex.TDFA.Common.html#regex_compOptions"><span class="hs-identifier hs-var">regex_compOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#CompOption"><span class="hs-identifier hs-type">CompOption</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">multiline :: CompOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#multiline"><span class="hs-identifier hs-var">multiline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093594"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093594"><span class="hs-identifier hs-var">newline</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">regex_execOptions :: Regex -&gt; ExecOption
</span><a href="Text.Regex.TDFA.Common.html#regex_execOptions"><span class="hs-identifier hs-var">regex_execOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#ExecOption"><span class="hs-identifier hs-type">ExecOption</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">captureGroups :: ExecOption -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#captureGroups"><span class="hs-identifier hs-var">captureGroups</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679093590"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093590"><span class="hs-identifier hs-var">capture</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>          </span><span id="local-6989586621679093589"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">offsetIn</span></a></span></span><span> </span><span id="local-6989586621679093588"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093588"><span class="hs-identifier hs-var">prevIn</span></a></span></span><span> </span><span id="local-6989586621679093587"><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093587"><span class="hs-identifier hs-var">inputIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093586"><span class="hs-identifier hs-var">subCapture</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093598"><span class="hs-identifier hs-var">frontAnchored</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-89"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. ST s [MatchArray]) -&gt; [MatchArray]
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">L.runST</span></span><span> </span><span class="annot"><span class="annottext">forall s. ST s [MatchArray]
</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var">runCaptureGroup</span></a></span><span>
</span><span id="line-90"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
forall text.
Uncons text =&gt;
Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
</span><a href="Text.Regex.TDFA.NewDFA.Engine_FA.html#execMatch"><span class="hs-identifier hs-var">FA.execMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679093619"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">offsetIn</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093588"><span class="hs-identifier hs-var">prevIn</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093587"><span class="hs-identifier hs-var">inputIn</span></a></span><span>
</span><span id="line-91"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
forall text.
Uncons text =&gt;
Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
</span><a href="Text.Regex.TDFA.NewDFA.Engine_NC.html#execMatch"><span class="hs-identifier hs-var">NC.execMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679093619"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">offsetIn</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093588"><span class="hs-identifier hs-var">prevIn</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093587"><span class="hs-identifier hs-var">inputIn</span></a></span><span>
</span><span id="line-92"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
forall text.
Uncons text =&gt;
Regex -&gt; Int -&gt; Char -&gt; text -&gt; [MatchArray]
</span><a href="Text.Regex.TDFA.NewDFA.Engine_NC_FA.html#execMatch"><span class="hs-identifier hs-var">NC_FA.execMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Regex
</span><a href="#local-6989586621679093619"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">offsetIn</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093588"><span class="hs-identifier hs-var">prevIn</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093587"><span class="hs-identifier hs-var">inputIn</span></a></span><span>
</span><span id="line-93"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="#local-6989586621679093586"><span class="hs-identifier hs-type">subCapture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679093586"><span class="annot"><span class="annottext">subCapture :: Bool
</span><a href="#local-6989586621679093586"><span class="hs-identifier hs-var hs-var">subCapture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093590"><span class="hs-identifier hs-var">capture</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a. Ix a =&gt; (a, a) -&gt; Int
</span><span class="hs-identifier hs-var">rangeSize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int [GroupInfo] -&gt; (Int, Int)
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093600"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="#local-6989586621679093582"><span class="hs-identifier hs-type">b_tags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679093582"><span class="annot"><span class="annottext">b_tags :: (Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var hs-var">b_tags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093606"><span class="hs-identifier hs-var">b_tags_all</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="#local-6989586621679093580"><span class="hs-identifier hs-type">orbitTags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679093580"><span class="annot"><span class="annottext">orbitTags :: [Int]
</span><a href="#local-6989586621679093580"><span class="hs-identifier hs-var hs-var">orbitTags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, OP) -&gt; Int) -&gt; [(Int, OP)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, OP) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Int, OP)] -&gt; [Int])
-&gt; (Array Int OP -&gt; [(Int, OP)]) -&gt; Array Int OP -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, OP) -&gt; Bool) -&gt; [(Int, OP)] -&gt; [(Int, OP)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Orbit"><span class="hs-identifier hs-var">Orbit</span></a></span><span class="annot"><span class="annottext">OP -&gt; OP -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(OP -&gt; Bool) -&gt; ((Int, OP) -&gt; OP) -&gt; (Int, OP) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Int, OP) -&gt; OP
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, OP)] -&gt; [(Int, OP)])
-&gt; (Array Int OP -&gt; [(Int, OP)]) -&gt; Array Int OP -&gt; [(Int, OP)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Array Int OP -&gt; [(Int, OP)]
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; [(i, e)]
</span><span class="hs-identifier hs-var">assocs</span></span><span> </span><span class="annot"><span class="annottext">(Array Int OP -&gt; [Int]) -&gt; Array Int OP -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Array Int OP
</span><a href="#local-6989586621679093602"><span class="hs-identifier hs-var">aTags</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679093577"><span class="annot"><span class="annottext">test :: WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="#local-6989586621679093577"><span class="hs-identifier hs-var hs-var">test</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
forall text.
Uncons text =&gt;
Bool -&gt; WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mkTest"><span class="hs-identifier hs-var">mkTest</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093594"><span class="hs-identifier hs-var">newline</span></a></span><span>         </span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679093785"><span class="annot"><a href="#local-6989586621679093575"><span class="hs-identifier hs-type">comp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093785"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679093575"><span class="annot"><span class="annottext">comp :: C s
</span><a href="#local-6989586621679093575"><span class="hs-identifier hs-var hs-var">comp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;matchHere.comp&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">Array Int OP -&gt; C s
forall s. Array Int OP -&gt; C s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#ditzyComp%273"><span class="hs-identifier hs-var">ditzyComp'3</span></a></span><span> </span><span class="annot"><span class="annottext">Array Int OP
</span><a href="#local-6989586621679093602"><span class="hs-identifier hs-var">aTags</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621679093573"><span class="annot"><a href="#local-6989586621679093585"><span class="hs-identifier hs-type">runCaptureGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093573"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MatchArray</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621679093585"><span class="annot"><span class="annottext">runCaptureGroup :: ST s [MatchArray]
</span><a href="#local-6989586621679093585"><span class="hs-identifier hs-var hs-var">runCaptureGroup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;runCaptureGroup&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679093572"><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093572"><span class="hs-identifier hs-var">obtainNext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (ST s [MatchArray]) -&gt; ST s (ST s [MatchArray])
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">L.strictToLazyST</span></span><span> </span><span class="annot"><span class="annottext">ST s (ST s [MatchArray])
forall s. ST s (ST s [MatchArray])
</span><a href="#local-6989586621679093571"><span class="hs-identifier hs-var">constructNewEngine</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093570"><span class="annot"><span class="annottext">loop :: ST s [MatchArray]
</span><a href="#local-6989586621679093570"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679093569"><span class="annot"><span class="annottext">[MatchArray]
</span><a href="#local-6989586621679093569"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray] -&gt; ST s [MatchArray]
forall s a. ST s a -&gt; ST s a
</span><span class="hs-identifier hs-var">L.strictToLazyST</span></span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093572"><span class="hs-identifier hs-var">obtainNext</span></a></span><span>
</span><span id="line-112"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[MatchArray] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[MatchArray]
</span><a href="#local-6989586621679093569"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="hs-comment">-- force vals before defining valsRest</span><span>
</span><span id="line-113"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[MatchArray] -&gt; ST s [MatchArray]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- end of capturing</span><span>
</span><span id="line-114"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679093567"><span class="annot"><span class="annottext">[MatchArray]
</span><a href="#local-6989586621679093567"><span class="hs-identifier hs-var">valsRest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093570"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-115"></span><span>                            </span><span class="annot"><span class="annottext">[MatchArray] -&gt; ST s [MatchArray]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MatchArray]
</span><a href="#local-6989586621679093569"><span class="hs-identifier hs-var">vals</span></a></span><span> </span><span class="annot"><span class="annottext">[MatchArray] -&gt; [MatchArray] -&gt; [MatchArray]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[MatchArray]
</span><a href="#local-6989586621679093567"><span class="hs-identifier hs-var">valsRest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093570"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621679093897"><span class="annot"><a href="#local-6989586621679093571"><span class="hs-identifier hs-type">constructNewEngine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093897"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093897"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MatchArray</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621679093571"><span class="annot"><span class="annottext">constructNewEngine :: ST s (ST s [MatchArray])
</span><a href="#local-6989586621679093571"><span class="hs-identifier hs-var hs-var">constructNewEngine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;constructNewEngine&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679093566"><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093566"><span class="hs-identifier hs-var">storeNext</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray] -&gt; ST s (STRef s (ST s [MatchArray]))
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray]
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray]) -&gt; ST s [MatchArray] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093566"><span class="hs-identifier hs-var">storeNext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray]) -&gt; ST s [MatchArray]
forall s. STRef s (ST s [MatchArray]) -&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093564"><span class="hs-identifier hs-var">goNext</span></a></span><span> </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093566"><span class="hs-identifier hs-var">storeNext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093563"><span class="annot"><span class="annottext">obtainNext :: ST s [MatchArray]
</span><a href="#local-6989586621679093563"><span class="hs-identifier hs-var hs-var">obtainNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ST s (ST s [MatchArray]) -&gt; ST s [MatchArray]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray]) -&gt; ST s (ST s [MatchArray])
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093566"><span class="hs-identifier hs-var">storeNext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">ST s [MatchArray] -&gt; ST s (ST s [MatchArray])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093563"><span class="hs-identifier hs-var">obtainNext</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679093881"><span class="annot"><a href="#local-6989586621679093564"><span class="hs-identifier hs-type">goNext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679093881"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093881"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MatchArray</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093881"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MatchArray</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621679093564"><span class="annot"><span class="annottext">goNext :: STRef s (ST s [MatchArray]) -&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093564"><span class="hs-identifier hs-var hs-var">goNext</span></a></span></span><span> </span><span id="local-6989586621679093562"><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093562"><span class="hs-identifier hs-var">storeNext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#SScratch"><span class="hs-identifier hs-type">SScratch</span></a></span><span> </span><span id="local-6989586621679093560"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093560"><span class="hs-identifier hs-var">s1In</span></a></span></span><span> </span><span id="local-6989586621679093559"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093559"><span class="hs-identifier hs-var">s2In</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093558"><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093557"><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">blank</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093556"><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093556"><span class="hs-identifier hs-var">which</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int) -&gt; ST s (SScratch s)
forall s. (Int, Int) -&gt; (Int, Int) -&gt; ST s (SScratch s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newScratch"><span class="hs-identifier hs-var">newScratch</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093608"><span class="hs-identifier hs-var">b_index</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">b_tags</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
forall s.
(Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#spawnStart"><span class="hs-identifier hs-var">spawnStart</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">b_tags</span></a></span><span> </span><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">blank</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093610"><span class="hs-identifier hs-var">startState</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093560"><span class="hs-identifier hs-var">s1In</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">offsetIn</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679093553"><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093553"><span class="hs-identifier hs-var">eliminatedStateFlag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s (STRef s Bool)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679093552"><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093552"><span class="hs-identifier hs-var">eliminatedRespawnFlag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ST s (STRef s Bool)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093551"><span class="annot"><span class="annottext">next :: MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span id="local-6989586621679093550"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679093549"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093549"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621679093548"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093548"><span class="hs-identifier hs-var">did</span></a></span></span><span> </span><span id="local-6989586621679093547"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093547"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span id="local-6989586621679093546"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679093545"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093545"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span id="local-6989586621679093544"><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093544"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.next&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-132"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093547"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_test :: DT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#dt_test"><span class="hs-identifier hs-var">dt_test</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093541"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679093541"><span class="hs-identifier hs-var">wt</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_a :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093539"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093539"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_b :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093537"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093537"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="#local-6989586621679093577"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679093541"><span class="hs-identifier hs-var">wt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093545"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093544"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-135"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093549"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093548"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093539"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093545"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093544"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-136"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093549"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093548"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093537"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093545"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093544"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-137"></span><span>            </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_win :: DT -&gt; IntMap Instructions
</span><a href="Text.Regex.TDFA.Common.html#dt_win"><span class="hs-identifier hs-var">dt_win</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093534"><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679093534"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_trans :: DT -&gt; CharMap Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_trans"><span class="hs-identifier hs-var">dt_trans</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093532"><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679093532"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_other :: DT -&gt; Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_other"><span class="hs-identifier hs-var">dt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093530"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679093530"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IntMap Instructions -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679093534"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">text -&gt; Maybe (Char, text)
forall a. Uncons a =&gt; a -&gt; Maybe (Char, a)
</span><a href="Text.Regex.TDFA.NewDFA.Uncons.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093544"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-140"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Char, text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093529"><span class="hs-identifier hs-var">finalizeWinners</span></a></span><span>
</span><span id="line-141"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093528"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093528"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093527"><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093527"><span class="hs-identifier hs-var">input'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Transition -&gt; Char -&gt; CharMap Transition -&gt; Transition
forall a. a -&gt; Char -&gt; CharMap a -&gt; a
</span><a href="Data.IntMap.CharMap2.html#findWithDefault"><span class="hs-identifier hs-var">CMap.findWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679093530"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093528"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679093532"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>                        </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">trans_many :: Transition -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_many"><span class="hs-identifier hs-var">trans_many</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">d_id :: DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093524"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093524"><span class="hs-identifier hs-var">did'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d_dt :: DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093523"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093523"><span class="hs-identifier hs-var">dt'</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span class="annot"><span class="annottext">trans_how :: Transition -&gt; DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093521"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679093521"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>                          </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; SetIndex
-&gt; DT
-&gt; DTrans
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093520"><span class="hs-identifier hs-var">findTrans</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093549"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093548"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093524"><span class="hs-identifier hs-var">did'</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093523"><span class="hs-identifier hs-var">dt'</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679093521"><span class="hs-identifier hs-var">dtrans</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093528"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093527"><span class="hs-identifier hs-var">input'</span></a></span><span>
</span><span id="line-145"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621679093519"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093519"><span class="hs-identifier hs-var">did'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093518"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093518"><span class="hs-identifier hs-var">dt'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; IntMap Instructions
-&gt; Int
-&gt; ST s (SetIndex, DT)
</span><a href="#local-6989586621679093517"><span class="hs-identifier hs-var">processWinner</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093548"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093547"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679093534"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span><span>
</span><span id="line-147"></span><span>                  </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093516"><span class="hs-identifier hs-var">next'</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093550"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093549"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093519"><span class="hs-identifier hs-var">did'</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093518"><span class="hs-identifier hs-var">dt'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093546"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093545"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093544"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>        </span><span id="local-6989586621679093516"><span class="annot"><span class="annottext">next' :: MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093516"><span class="hs-identifier hs-var hs-var">next'</span></a></span></span><span> </span><span id="local-6989586621679093515"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679093514"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093514"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621679093513"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093513"><span class="hs-identifier hs-var">did</span></a></span></span><span> </span><span id="local-6989586621679093512"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093512"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span id="local-6989586621679093511"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679093510"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span id="local-6989586621679093509"><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093509"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.next'&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-150"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093512"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-151"></span><span>            </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Testing%27"><span class="hs-identifier hs-type">Testing'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_test :: DT -&gt; WhichTest
</span><a href="Text.Regex.TDFA.Common.html#dt_test"><span class="hs-identifier hs-var">dt_test</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093508"><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679093508"><span class="hs-identifier hs-var">wt</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_a :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_a"><span class="hs-identifier hs-var">dt_a</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093507"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093507"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">dt_b :: DT -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#dt_b"><span class="hs-identifier hs-var">dt_b</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093506"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093506"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="#local-6989586621679093577"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="annot"><span class="annottext">WhichTest
</span><a href="#local-6989586621679093508"><span class="hs-identifier hs-var">wt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093509"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-153"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093516"><span class="hs-identifier hs-var">next'</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093514"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093513"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093507"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093509"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-154"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093516"><span class="hs-identifier hs-var">next'</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093514"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093513"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093506"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093510"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093509"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Simple%27"><span class="hs-identifier hs-type">Simple'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_trans :: DT -&gt; CharMap Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_trans"><span class="hs-identifier hs-var">dt_trans</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093505"><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679093505"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_other :: DT -&gt; Transition
</span><a href="Text.Regex.TDFA.Common.html#dt_other"><span class="hs-identifier hs-var">dt_other</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093504"><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679093504"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">text -&gt; Maybe (Char, text)
forall a. Uncons a =&gt; a -&gt; Maybe (Char, a)
</span><a href="Text.Regex.TDFA.NewDFA.Uncons.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093509"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Char, text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ST s [MatchArray]
</span><a href="#local-6989586621679093529"><span class="hs-identifier hs-var">finalizeWinners</span></a></span><span>
</span><span id="line-158"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093503"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093503"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093502"><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">input'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Transition -&gt; Char -&gt; CharMap Transition -&gt; Transition
forall a. a -&gt; Char -&gt; CharMap a -&gt; a
</span><a href="Data.IntMap.CharMap2.html#findWithDefault"><span class="hs-identifier hs-var">CMap.findWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Transition
</span><a href="#local-6989586621679093504"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093503"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">CharMap Transition
</span><a href="#local-6989586621679093505"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-160"></span><span>                    </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">trans_many :: Transition -&gt; DFA
</span><a href="Text.Regex.TDFA.Common.html#trans_many"><span class="hs-identifier hs-var">trans_many</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">d_id :: DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093501"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093501"><span class="hs-identifier hs-var">did'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d_dt :: DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093500"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093500"><span class="hs-identifier hs-var">dt'</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span class="annot"><span class="annottext">trans_how :: Transition -&gt; DTrans
</span><a href="Text.Regex.TDFA.Common.html#trans_how"><span class="hs-identifier hs-var">trans_how</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093499"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679093499"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>                      </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; SetIndex
-&gt; DT
-&gt; DTrans
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093520"><span class="hs-identifier hs-var">findTrans</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093515"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093514"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093513"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093501"><span class="hs-identifier hs-var">did'</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093500"><span class="hs-identifier hs-var">dt'</span></a></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679093499"><span class="hs-identifier hs-var">dtrans</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093511"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093503"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093502"><span class="hs-identifier hs-var">input'</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- compressOrbits gets all the current Tag-0 start information from</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- the NFA states; then it loops through all the Orbit tags with</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- compressOrbit.</span><span>
</span><span id="line-166"></span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- compressOrbit on such a Tag loops through all the NFS states'</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- m_orbit record, discarding ones that are Nothing and discarding</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- ones that are too new to care about (after the cutoff value).</span><span>
</span><span id="line-170"></span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- compressOrbit then groups the Orbits records by the Tag-0 start</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- position and the basePos position.  Entries in different groups</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- will never be comparable in the future so they can be processed</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- separately.  Groups could probably be even more finely</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- distinguished, as a futher optimization, but the justification will</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- be tricky.</span><span>
</span><span id="line-177"></span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- Current Tag-0 values are at most offset and all newly spawned</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- groups will have Tag-0 of at least (succ offset) so the current</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- groups are closed to those spawned in the future.  The basePos may</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- be as large as offset and may be overwritten later with values of</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- offset or larger (and this will also involve deleting the Orbits</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- record).  Thus there could be a future collision between a current</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- group with basePos==offset and an updated record that acquires</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- basePos==offset.  By excluding groups with basePos before the</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- current offset the collision between existing and future records</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- is avoided.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- An entry in a group can only collide with that group's</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- descendents. compressOrbit sends each group to the compressGroup</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- command.</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- compressGroup on a single record checks whether it's Seq can be</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- cleared and if so it will clear it (and set ordinal to Nothing but</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- this this not particularly important).</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- compressGroup on many records sorts and groups the members and zips</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- the groups with their new ordinal value.  The comparision is based</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- on the old ordinal value, then the inOrbit value, and then the (Seq</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- Position) data.</span><span>
</span><span id="line-201"></span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- The old ordinals of the group will all be Nothing or all be Just,</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- but this condition is neither checked nor violations detected.</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- This comparision is justified because once records get different</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- ordinals assigned they will never change places.</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- The inOrbit Bool is only different if one of them has set the stop</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- position to at most (succ offset).  They will obly be compared if</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- the other one leaves, an its stop position will be at least offset.</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- The previous sentence is justified by inspectin of the &quot;assemble&quot;</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- function in the TDFA module: there is no (PostUpdate</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- LeaveOrbitTask) so the largest possible value for the stop Tag is</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- (pred offset). Thus the record with inOrbit==False would beat (be</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- GT than) the record with inOrbit==True.</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- The Seq comparison is safe because the largest existing Position</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- value is (pred offset) and the smallest future Position value is</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- offset.  The previous sentence is justified by inspectin of the</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- &quot;assemble&quot; function in the TDFA module: there is no (PostUpdate</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- EnterOrbitTags) so the largest possible value in the Seq is (pred</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- offset).</span><span>
</span><span id="line-222"></span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- The updated Orbits get the new ordinal value and an empty (Seq</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- Position).</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621679093498"><span class="annot"><span class="annottext">compressOrbits :: MScratch s -&gt; SetIndex -&gt; Int -&gt; ST s ()
</span><a href="#local-6989586621679093498"><span class="hs-identifier hs-var hs-var">compressOrbits</span></a></span></span><span> </span><span id="local-6989586621679093497"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679093496"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093496"><span class="hs-identifier hs-var">did</span></a></span></span><span> </span><span id="local-6989586621679093495"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093495"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093494"><span class="annot"><span class="annottext">getStart :: Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679093494"><span class="hs-identifier hs-var hs-var">getStart</span></a></span></span><span> </span><span id="local-6989586621679093493"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093493"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679093492"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093492"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s Int
-&gt; (STUArray s Int Int -&gt; ST s Int)
-&gt; Maybe (STUArray s Int Int)
-&gt; ST s Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ST s Int
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compressOrbit,1&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (STUArray s Int Int) -&gt; ST s Int)
-&gt; ST s (Maybe (STUArray s Int Int)) -&gt; ST s Int
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; ST s (Maybe (STUArray s Int Int))
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093493"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-228"></span><span>                                  </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (Int, Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093493"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093492"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>              </span><span id="local-6989586621679093488"><span class="annot"><span class="annottext">cutoff :: Int
</span><a href="#local-6989586621679093488"><span class="hs-identifier hs-var hs-var">cutoff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093495"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="hs-comment">-- Require: cutoff &lt;= offset, MAGIC TUNABLE CONSTANT 50</span><span>
</span><span id="line-230"></span><span>          </span><span id="local-6989586621679093487"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679093487"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s (Int, Int)) -&gt; [Int] -&gt; ST s [(Int, Int)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (Int, Int)
forall s.
(MArray (STUArray s) Int (ST s),
 MArray (STArray s) (Maybe (STUArray s Int Int)) (ST s)) =&gt;
Int -&gt; ST s (Int, Int)
</span><a href="#local-6989586621679093494"><span class="hs-identifier hs-var">getStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetIndex -&gt; [Int]
</span><span class="hs-identifier hs-var">ISet.toAscList</span></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093496"><span class="hs-identifier hs-var">did</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093485"><span class="annot"><span class="annottext">compressOrbit :: Int -&gt; ST s ()
</span><a href="#local-6989586621679093485"><span class="hs-identifier hs-var hs-var">compressOrbit</span></a></span></span><span> </span><span id="local-6989586621679093484"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093484"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>                </span><span id="local-6989586621679093483"><span class="annot"><span class="annottext">[Maybe ((Int, Int), Orbits)]
</span><a href="#local-6989586621679093483"><span class="hs-identifier hs-var">mos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
-&gt; ((Int, Int) -&gt; ST s (Maybe ((Int, Int), Orbits)))
-&gt; ST s [Maybe ((Int, Int), Orbits)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679093487"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679093482"><span class="annot"><span class="annottext">p :: (Int, Int)
</span><a href="#local-6989586621679093482"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093481"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093481"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093480"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093480"><span class="hs-identifier hs-var">_start</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>                                  </span><span id="local-6989586621679093479"><span class="annot"><span class="annottext">Maybe Orbits
</span><a href="#local-6989586621679093479"><span class="hs-identifier hs-var">mo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(OrbitLog -&gt; Maybe Orbits) -&gt; ST s OrbitLog -&gt; ST s (Maybe Orbits)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; Maybe Orbits
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093484"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; ST s OrbitLog
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093481"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>                                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Orbits
</span><a href="#local-6989586621679093479"><span class="hs-identifier hs-var">mo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679093477"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093477"><span class="hs-identifier hs-var">orbits</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Int
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var hs-var">basePos</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093477"><span class="hs-identifier hs-var">orbits</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093488"><span class="hs-identifier hs-var">cutoff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((Int, Int), Orbits) -&gt; ST s (Maybe ((Int, Int), Orbits))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Int), Orbits) -&gt; Maybe ((Int, Int), Orbits)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093482"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093477"><span class="hs-identifier hs-var">orbits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>                                                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((Int, Int), Orbits) -&gt; ST s (Maybe ((Int, Int), Orbits))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((Int, Int), Orbits)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-237"></span><span>                                    </span><span class="annot"><span class="annottext">Maybe Orbits
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((Int, Int), Orbits) -&gt; ST s (Maybe ((Int, Int), Orbits))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((Int, Int), Orbits)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093474"><span class="annot"><span class="annottext">compressGroup :: [((Int, b), Orbits)] -&gt; ST s ()
</span><a href="#local-6989586621679093474"><span class="hs-identifier hs-var hs-var">compressGroup</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093473"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093473"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093472"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093472"><span class="hs-identifier hs-var">orbit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Seq Int -&gt; Bool
forall a. Seq a -&gt; Bool
</span><span class="hs-identifier hs-var">Seq.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093472"><span class="hs-identifier hs-var">orbit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>                                                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>                      </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; OrbitLog -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093473"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span>
</span><span id="line-241"></span><span>                      </span><span class="annot"><span class="annottext">(OrbitLog -&gt; ST s ())
-&gt; (OrbitLog -&gt; OrbitLog) -&gt; OrbitLog -&gt; ST s ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Orbits -&gt; OrbitLog -&gt; OrbitLog
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093484"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">(Orbits -&gt; OrbitLog -&gt; OrbitLog) -&gt; Orbits -&gt; OrbitLog -&gt; OrbitLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093472"><span class="hs-identifier hs-var">orbit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ordinal :: Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var">ordinal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getOrbits :: Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var">getOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq Int
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>                      </span><span class="annot"><span class="annottext">(OrbitLog -&gt; ST s ()) -&gt; ST s OrbitLog -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; ST s OrbitLog
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093473"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>                    </span><span class="annot"><a href="#local-6989586621679093474"><span class="hs-identifier hs-var">compressGroup</span></a></span><span> </span><span id="local-6989586621679093468"><span class="annot"><span class="annottext">[((Int, b), Orbits)]
</span><a href="#local-6989586621679093468"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093467"><span class="annot"><span class="annottext">sortPos :: (a, Orbits) -&gt; (a, Orbits) -&gt; Ordering
</span><a href="#local-6989586621679093467"><span class="hs-identifier hs-var hs-var">sortPos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093466"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093466"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093465"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093465"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Maybe Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var hs-var">ordinal</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093466"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var hs-var">ordinal</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093465"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-246"></span><span>                                                  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var hs-var">inOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093465"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var hs-var">inOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093466"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-247"></span><span>                                                  </span><span class="annot"><span class="annottext">ViewL Int -&gt; ViewL Int -&gt; Ordering
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var">comparePos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Int -&gt; ViewL Int
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">viewl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093466"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Int -&gt; ViewL Int
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">viewl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093465"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>                          </span><span id="local-6989586621679093461"><span class="annot"><span class="annottext">groupPos :: (a, Orbits) -&gt; (a, Orbits) -&gt; Bool
</span><a href="#local-6989586621679093461"><span class="hs-identifier hs-var hs-var">groupPos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093460"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093460"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093459"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093459"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var hs-var">ordinal</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093460"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Maybe Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var hs-var">ordinal</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093459"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093460"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Seq Int -&gt; Seq Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093459"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-249"></span><span>                          </span><span id="local-6989586621679093458"><span class="annot"><span class="annottext">gs' :: [(Int, [((Int, b), Orbits)])]
</span><a href="#local-6989586621679093458"><span class="hs-identifier hs-var hs-var">gs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [[((Int, b), Orbits)]] -&gt; [(Int, [((Int, b), Orbits)])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((Int, b), Orbits) -&gt; ((Int, b), Orbits) -&gt; Bool)
-&gt; [((Int, b), Orbits)] -&gt; [[((Int, b), Orbits)]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">groupBy</span></span><span> </span><span class="annot"><span class="annottext">((Int, b), Orbits) -&gt; ((Int, b), Orbits) -&gt; Bool
forall a a. (a, Orbits) -&gt; (a, Orbits) -&gt; Bool
</span><a href="#local-6989586621679093461"><span class="hs-identifier hs-var">groupPos</span></a></span><span> </span><span class="annot"><span class="annottext">([((Int, b), Orbits)] -&gt; [[((Int, b), Orbits)]])
-&gt; ([((Int, b), Orbits)] -&gt; [((Int, b), Orbits)])
-&gt; [((Int, b), Orbits)]
-&gt; [[((Int, b), Orbits)]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(((Int, b), Orbits) -&gt; ((Int, b), Orbits) -&gt; Ordering)
-&gt; [((Int, b), Orbits)] -&gt; [((Int, b), Orbits)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">((Int, b), Orbits) -&gt; ((Int, b), Orbits) -&gt; Ordering
forall a a. (a, Orbits) -&gt; (a, Orbits) -&gt; Ordering
</span><a href="#local-6989586621679093467"><span class="hs-identifier hs-var">sortPos</span></a></span><span> </span><span class="annot"><span class="annottext">([((Int, b), Orbits)] -&gt; [[((Int, b), Orbits)]])
-&gt; [((Int, b), Orbits)] -&gt; [[((Int, b), Orbits)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[((Int, b), Orbits)]
</span><a href="#local-6989586621679093468"><span class="hs-identifier hs-var">gs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                      </span><span class="annot"><span class="annottext">[(Int, [((Int, b), Orbits)])]
-&gt; ((Int, [((Int, b), Orbits)]) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, [((Int, b), Orbits)])]
</span><a href="#local-6989586621679093458"><span class="hs-identifier hs-var">gs'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Int, [((Int, b), Orbits)]) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((Int, [((Int, b), Orbits)]) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679093457"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093457"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093456"><span class="annot"><span class="annottext">[((Int, b), Orbits)]
</span><a href="#local-6989586621679093456"><span class="hs-identifier hs-var">eqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>                        </span><span class="annot"><span class="annottext">[((Int, b), Orbits)] -&gt; (((Int, b), Orbits) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[((Int, b), Orbits)]
</span><a href="#local-6989586621679093456"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">((((Int, b), Orbits) -&gt; ST s ()) -&gt; ST s ())
-&gt; (((Int, b), Orbits) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093455"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093454"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093454"><span class="hs-identifier hs-var">orbit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>                          </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; OrbitLog -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-253"></span><span>                           </span><span class="annot"><span class="annottext">(OrbitLog -&gt; ST s ())
-&gt; (OrbitLog -&gt; OrbitLog) -&gt; OrbitLog -&gt; ST s ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Orbits -&gt; OrbitLog -&gt; OrbitLog
forall a. Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IMap.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093484"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">(Orbits -&gt; OrbitLog -&gt; OrbitLog) -&gt; Orbits -&gt; OrbitLog -&gt; OrbitLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093454"><span class="hs-identifier hs-var">orbit</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ordinal :: Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var">ordinal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093457"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getOrbits :: Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var">getOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq Int
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>                            </span><span class="annot"><span class="annottext">(OrbitLog -&gt; ST s ()) -&gt; ST s OrbitLog -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093497"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; ST s OrbitLog
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093455"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-255"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093453"><span class="annot"><span class="annottext">sorter :: ((a, a), Orbits) -&gt; ((a, a), Orbits) -&gt; Ordering
</span><a href="#local-6989586621679093453"><span class="hs-identifier hs-var hs-var">sorter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093452"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093452"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093451"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093451"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093450"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093450"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093449"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093449"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093452"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093450"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Int
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var hs-var">basePos</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093451"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Int
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var hs-var">basePos</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093449"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                    </span><span id="local-6989586621679093448"><span class="annot"><span class="annottext">grouper :: ((a, a), Orbits) -&gt; ((a, a), Orbits) -&gt; Bool
</span><a href="#local-6989586621679093448"><span class="hs-identifier hs-var hs-var">grouper</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093447"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093447"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093446"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093446"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679093445"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093444"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093444"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093447"><span class="hs-identifier hs-var">a1</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093445"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Int
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var hs-var">basePos</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093446"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Int
</span><a href="Text.Regex.TDFA.Common.html#basePos"><span class="hs-identifier hs-var hs-var">basePos</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093444"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-257"></span><span>                    </span><span id="local-6989586621679093443"><span class="annot"><span class="annottext">orbitGroups :: [[((Int, Int), Orbits)]]
</span><a href="#local-6989586621679093443"><span class="hs-identifier hs-var hs-var">orbitGroups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((Int, Int), Orbits) -&gt; ((Int, Int), Orbits) -&gt; Bool)
-&gt; [((Int, Int), Orbits)] -&gt; [[((Int, Int), Orbits)]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">groupBy</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int), Orbits) -&gt; ((Int, Int), Orbits) -&gt; Bool
forall a a a. Eq a =&gt; ((a, a), Orbits) -&gt; ((a, a), Orbits) -&gt; Bool
</span><a href="#local-6989586621679093448"><span class="hs-identifier hs-var">grouper</span></a></span><span> </span><span class="annot"><span class="annottext">([((Int, Int), Orbits)] -&gt; [[((Int, Int), Orbits)]])
-&gt; ([Maybe ((Int, Int), Orbits)] -&gt; [((Int, Int), Orbits)])
-&gt; [Maybe ((Int, Int), Orbits)]
-&gt; [[((Int, Int), Orbits)]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(((Int, Int), Orbits) -&gt; ((Int, Int), Orbits) -&gt; Ordering)
-&gt; [((Int, Int), Orbits)] -&gt; [((Int, Int), Orbits)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortBy</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int), Orbits) -&gt; ((Int, Int), Orbits) -&gt; Ordering
forall a a a.
Ord a =&gt;
((a, a), Orbits) -&gt; ((a, a), Orbits) -&gt; Ordering
</span><a href="#local-6989586621679093453"><span class="hs-identifier hs-var">sorter</span></a></span><span> </span><span class="annot"><span class="annottext">([((Int, Int), Orbits)] -&gt; [((Int, Int), Orbits)])
-&gt; ([Maybe ((Int, Int), Orbits)] -&gt; [((Int, Int), Orbits)])
-&gt; [Maybe ((Int, Int), Orbits)]
-&gt; [((Int, Int), Orbits)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Maybe ((Int, Int), Orbits)] -&gt; [((Int, Int), Orbits)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe ((Int, Int), Orbits)] -&gt; [[((Int, Int), Orbits)]])
-&gt; [Maybe ((Int, Int), Orbits)] -&gt; [[((Int, Int), Orbits)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe ((Int, Int), Orbits)]
</span><a href="#local-6989586621679093483"><span class="hs-identifier hs-var">mos</span></a></span><span>
</span><span id="line-258"></span><span>                </span><span class="annot"><span class="annottext">([((Int, Int), Orbits)] -&gt; ST s ())
-&gt; [[((Int, Int), Orbits)]] -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">[((Int, Int), Orbits)] -&gt; ST s ()
forall s b.
(MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s)) =&gt;
[((Int, b), Orbits)] -&gt; ST s ()
</span><a href="#local-6989586621679093474"><span class="hs-identifier hs-var">compressGroup</span></a></span><span> </span><span class="annot"><span class="annottext">[[((Int, Int), Orbits)]]
</span><a href="#local-6989586621679093443"><span class="hs-identifier hs-var">orbitGroups</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">(Int -&gt; ST s ()) -&gt; [Int] -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s ()
forall s.
(MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s),
 MArray (STArray s) OrbitLog (ST s)) =&gt;
Int -&gt; ST s ()
</span><a href="#local-6989586621679093485"><span class="hs-identifier hs-var">compressOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093580"><span class="hs-identifier hs-var">orbitTags</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- findTrans has to (part 1) decide, for each destination, &quot;which&quot; of</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- zero or more source NFA states will be the chosen source.  Then it</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- has to (part 2) perform the transition or spawn.  It keeps track of</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- the starting index while doing so, and compares the earliest start</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- with the stored winners.  (part 3) If some winners are ready to be</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- released then the future continuation of the search is placed in</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- &quot;storeNext&quot;.  If no winners are ready to be released then the</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- computation continues immediately.</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>        </span><span id="local-6989586621679093520"><span class="annot"><span class="annottext">findTrans :: MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; SetIndex
-&gt; DT
-&gt; DTrans
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093520"><span class="hs-identifier hs-var hs-var">findTrans</span></a></span></span><span> </span><span id="local-6989586621679093441"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679093440"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093440"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621679093439"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093439"><span class="hs-identifier hs-var">did</span></a></span></span><span> </span><span id="local-6989586621679093438"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093438"><span class="hs-identifier hs-var">did'</span></a></span></span><span> </span><span id="local-6989586621679093437"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">dt'</span></a></span></span><span> </span><span id="local-6989586621679093436"><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679093436"><span class="hs-identifier hs-var">dtrans</span></a></span></span><span> </span><span id="local-6989586621679093435"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679093434"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093434"><span class="hs-identifier hs-var">prev'</span></a></span></span><span> </span><span id="local-6989586621679093433"><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093433"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.findTrans&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>          </span><span class="hs-comment">-- findTrans part 0</span><span>
</span><span id="line-272"></span><span>          </span><span class="hs-comment">-- MAGIC TUNABLE CONSTANT 100 (and 100-1). TODO: (offset .&amp;. 127 == 127) instead?</span><span>
</span><span id="line-273"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093580"><span class="hs-identifier hs-var">orbitTags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`rem`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">99</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; SetIndex -&gt; Int -&gt; ST s ()
forall s s.
(MArray (STUArray s) Int (ST s),
 MArray (STArray s) (Maybe (STUArray s Int Int)) (ST s),
 MArray (STArray s) OrbitLog (ST s)) =&gt;
MScratch s -&gt; SetIndex -&gt; Int -&gt; ST s ()
</span><a href="#local-6989586621679093498"><span class="hs-identifier hs-var">compressOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093439"><span class="hs-identifier hs-var">did</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>          </span><span class="hs-comment">-- findTrans part 1</span><span>
</span><span id="line-275"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093430"><span class="annot"><span class="annottext">findTransTo :: (Int, IntMap (a, Instructions)) -&gt; ST s ()
</span><a href="#local-6989586621679093430"><span class="hs-identifier hs-var hs-var">findTransTo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093429"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093429"><span class="hs-identifier hs-var">destIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093428"><span class="annot"><span class="annottext">IntMap (a, Instructions)
</span><a href="#local-6989586621679093428"><span class="hs-identifier hs-var">sources</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IntMap (a, Instructions) -&gt; Bool
forall a. IntMap a -&gt; Bool
</span><span class="hs-identifier hs-var">IMap.null</span></span><span> </span><span class="annot"><span class="annottext">IntMap (a, Instructions)
</span><a href="#local-6989586621679093428"><span class="hs-identifier hs-var">sources</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>                </span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093556"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093429"><span class="hs-identifier hs-var">destIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Instructions :: [(Int, Action)]
-&gt; Maybe (Int -&gt; OrbitLog -&gt; OrbitLog) -&gt; Instructions
</span><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">newPos :: [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var">newPos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">newOrbits :: Maybe (Int -&gt; OrbitLog -&gt; OrbitLog)
</span><a href="Text.Regex.TDFA.Common.html#newOrbits"><span class="hs-identifier hs-var">newOrbits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Int -&gt; OrbitLog -&gt; OrbitLog)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>                                    </span><span class="hs-special">,</span><span class="annot"><span class="annottext">BlankScratch s -&gt; STUArray s Int Int
forall s. BlankScratch s -&gt; STUArray s Int Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#blank_pos"><span class="hs-identifier hs-var hs-var">blank_pos</span></a></span><span> </span><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">blank</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OrbitLog
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>                                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093422"><span class="annot"><span class="annottext">prep :: (Int, (a, Instructions))
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093422"><span class="hs-identifier hs-var hs-var">prep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093421"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093421"><span class="hs-identifier hs-var">sourceIndex</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679093420"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093420"><span class="hs-identifier hs-var">_dopa</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093419"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">instructions</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.findTrans.prep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>                      </span><span id="local-6989586621679093418"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093418"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (STUArray s Int Int)
-&gt; (STUArray s Int Int -&gt; ST s (STUArray s Int Int))
-&gt; Maybe (STUArray s Int Int)
-&gt; ST s (STUArray s Int Int)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ST s (STUArray s Int Int)
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s (STUArray s Int Int))
-&gt; String -&gt; ST s (STUArray s Int Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;findTrans,1 : &quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Int, Int, SetIndex) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093421"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093429"><span class="hs-identifier hs-var">destIndex</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093438"><span class="hs-identifier hs-var">did'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-281"></span><span>                               </span><span class="annot"><span class="annottext">(Maybe (STUArray s Int Int) -&gt; ST s (STUArray s Int Int))
-&gt; ST s (Maybe (STUArray s Int Int)) -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; ST s (Maybe (STUArray s Int Int))
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093421"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span>
</span><span id="line-282"></span><span>                      </span><span id="local-6989586621679093416"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093416"><span class="hs-identifier hs-var">orbit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; ST s OrbitLog
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093421"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span>
</span><span id="line-283"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093415"><span class="annot"><span class="annottext">orbit' :: OrbitLog
</span><a href="#local-6989586621679093415"><span class="hs-identifier hs-var hs-var">orbit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrbitLog
-&gt; ((Int -&gt; OrbitLog -&gt; OrbitLog) -&gt; OrbitLog)
-&gt; Maybe (Int -&gt; OrbitLog -&gt; OrbitLog)
-&gt; OrbitLog
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093416"><span class="hs-identifier hs-var">orbit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679093414"><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; OrbitLog
</span><a href="#local-6989586621679093414"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; OrbitLog
</span><a href="#local-6989586621679093414"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093416"><span class="hs-identifier hs-var">orbit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; Maybe (Int -&gt; OrbitLog -&gt; OrbitLog)
</span><a href="Text.Regex.TDFA.Common.html#newOrbits"><span class="hs-identifier hs-var hs-var">newOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">instructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                      </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093421"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093419"><span class="hs-identifier hs-var">instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093418"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093415"><span class="hs-identifier hs-var">orbit'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>                    </span><span id="local-6989586621679093413"><span class="annot"><span class="annottext">challenge :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093413"><span class="hs-identifier hs-var hs-var">challenge</span></a></span></span><span> </span><span id="local-6989586621679093412"><span class="annot"><span class="annottext">x1 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093412"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093411"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093411"><span class="hs-identifier hs-var">_si1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093410"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">ins1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093409"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093409"><span class="hs-identifier hs-var">_p1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093408"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093408"><span class="hs-identifier hs-var">_o1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093407"><span class="annot"><span class="annottext">x2 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093407"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093406"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093406"><span class="hs-identifier hs-var">_si2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093405"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093405"><span class="hs-identifier hs-var">ins2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093404"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093404"><span class="hs-identifier hs-var">_p2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093403"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093403"><span class="hs-identifier hs-var">_o2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.findTrans.challenge&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>                      </span><span id="local-6989586621679093402"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093402"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">C s
forall s. C s
</span><a href="#local-6989586621679093575"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093412"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093410"><span class="hs-identifier hs-var">ins1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093407"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093405"><span class="hs-identifier hs-var">ins2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093402"><span class="hs-identifier hs-var">check</span></a></span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093407"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093412"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679093401"><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093401"><span class="hs-identifier hs-var">first</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093400"><span class="annot"><span class="annottext">[((Int, Instructions), STUArray s Int Int, OrbitLog)]
</span><a href="#local-6989586621679093400"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int, (a, Instructions))
 -&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; [(Int, (a, Instructions))]
-&gt; ST s [((Int, Instructions), STUArray s Int Int, OrbitLog)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Int, (a, Instructions))
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall s a.
(MArray (STArray s) (Maybe (STUArray s Int Int)) (ST s),
 MArray (STArray s) OrbitLog (ST s)) =&gt;
(Int, (a, Instructions))
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093422"><span class="hs-identifier hs-var">prep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap (a, Instructions) -&gt; [(Int, (a, Instructions))]
forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">IMap.toList</span></span><span> </span><span class="annot"><span class="annottext">IntMap (a, Instructions)
</span><a href="#local-6989586621679093428"><span class="hs-identifier hs-var">sources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>                </span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093556"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093429"><span class="hs-identifier hs-var">destIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(((Int, Instructions), STUArray s Int Int, OrbitLog) -&gt; ST s ())
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(((Int, Instructions), STUArray s Int Int, OrbitLog)
 -&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
 -&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [((Int, Instructions), STUArray s Int Int, OrbitLog)]
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall s.
((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093413"><span class="hs-identifier hs-var">challenge</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093401"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">[((Int, Instructions), STUArray s Int Int, OrbitLog)]
</span><a href="#local-6989586621679093400"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093399"><span class="annot"><span class="annottext">dl :: [(Int, IntMap (DoPa, Instructions))]
</span><a href="#local-6989586621679093399"><span class="hs-identifier hs-var hs-var">dl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DTrans -&gt; [(Int, IntMap (DoPa, Instructions))]
forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">IMap.toList</span></span><span> </span><span class="annot"><span class="annottext">DTrans
</span><a href="#local-6989586621679093436"><span class="hs-identifier hs-var">dtrans</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">((Int, IntMap (DoPa, Instructions)) -&gt; ST s ())
-&gt; [(Int, IntMap (DoPa, Instructions))] -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Int, IntMap (DoPa, Instructions)) -&gt; ST s ()
forall a. (Int, IntMap (a, Instructions)) -&gt; ST s ()
</span><a href="#local-6989586621679093430"><span class="hs-identifier hs-var">findTransTo</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, IntMap (DoPa, Instructions))]
</span><a href="#local-6989586621679093399"><span class="hs-identifier hs-var">dl</span></a></span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-comment">-- findTrans part 2</span><span>
</span><span id="line-293"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093398"><span class="annot"><span class="annottext">performTransTo :: (Int, b) -&gt; ST s Int
</span><a href="#local-6989586621679093398"><span class="hs-identifier hs-var hs-var">performTransTo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093397"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093397"><span class="hs-identifier hs-var">destIndex</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.findTrans.performTransTo&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>                </span><span id="local-6989586621679093396"><span class="annot"><span class="annottext">x :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093396"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093395"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093395"><span class="hs-identifier hs-var">sourceIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093394"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093394"><span class="hs-identifier hs-var">_instructions</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093393"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093393"><span class="hs-identifier hs-var">_pos</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093392"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093392"><span class="hs-identifier hs-var">_orbit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093556"><span class="hs-identifier hs-var">which</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; Int -&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093397"><span class="hs-identifier hs-var">destIndex</span></a></span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093395"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
forall s.
(Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#spawnStart"><span class="hs-identifier hs-var">spawnStart</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">b_tags</span></a></span><span> </span><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">blank</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093397"><span class="hs-identifier hs-var">destIndex</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093440"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
forall s.
((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#updateCopy"><span class="hs-identifier hs-var">updateCopy</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093396"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093440"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093397"><span class="hs-identifier hs-var">destIndex</span></a></span><span>
</span><span id="line-298"></span><span>          </span><span id="local-6989586621679093389"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093389"><span class="hs-identifier hs-var">earlyStart</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; ST s [Int] -&gt; ST s Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimum</span></span><span> </span><span class="annot"><span class="annottext">(ST s [Int] -&gt; ST s Int) -&gt; ST s [Int] -&gt; ST s Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, IntMap (DoPa, Instructions)) -&gt; ST s Int)
-&gt; [(Int, IntMap (DoPa, Instructions))] -&gt; ST s [Int]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Int, IntMap (DoPa, Instructions)) -&gt; ST s Int
forall b. (Int, b) -&gt; ST s Int
</span><a href="#local-6989586621679093398"><span class="hs-identifier hs-var">performTransTo</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, IntMap (DoPa, Instructions))]
</span><a href="#local-6989586621679093399"><span class="hs-identifier hs-var">dl</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-comment">-- findTrans part 3</span><span>
</span><span id="line-300"></span><span>          </span><span id="local-6989586621679093387"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093387"><span class="hs-identifier hs-var">earlyWin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; ST s Int
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQ s -&gt; STRef s Int
forall s. MQ s -&gt; STRef s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_earliest"><span class="hs-identifier hs-var hs-var">mq_earliest</span></a></span><span> </span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093387"><span class="hs-identifier hs-var">earlyWin</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093389"><span class="hs-identifier hs-var">earlyStart</span></a></span><span> </span><span>
</span><span id="line-302"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>              </span><span id="local-6989586621679093385"><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093385"><span class="hs-identifier hs-var">winners</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([WScratch s] -&gt; [WScratch s])
-&gt; ST s [WScratch s] -&gt; ST s [WScratch s]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([WScratch s] -&gt; WScratch s -&gt; [WScratch s])
-&gt; [WScratch s] -&gt; [WScratch s] -&gt; [WScratch s]
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679093384"><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093384"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621679093383"><span class="annot"><span class="annottext">WScratch s
</span><a href="#local-6989586621679093383"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WScratch s
</span><a href="#local-6989586621679093383"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">WScratch s -&gt; [WScratch s] -&gt; [WScratch s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093384"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s [WScratch s] -&gt; ST s [WScratch s])
-&gt; ST s [WScratch s] -&gt; ST s [WScratch s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-304"></span><span>                           </span><span class="annot"><span class="annottext">Int -&gt; MQ s -&gt; ST s [WScratch s]
forall s. Int -&gt; MQ s -&gt; ST s [WScratch s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#getMQ"><span class="hs-identifier hs-var">getMQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093389"><span class="hs-identifier hs-var">earlyStart</span></a></span><span> </span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span><span>
</span><span id="line-305"></span><span>              </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray]) -&gt; ST s [MatchArray] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093562"><span class="hs-identifier hs-var">storeNext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093440"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093438"><span class="hs-identifier hs-var">did'</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">dt'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093434"><span class="hs-identifier hs-var">prev'</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093433"><span class="hs-identifier hs-var">input'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>              </span><span class="annot"><span class="annottext">(WScratch s -&gt; ST s MatchArray)
-&gt; [WScratch s] -&gt; ST s [MatchArray]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int [GroupInfo] -&gt; WScratch s -&gt; ST s MatchArray
forall s. Array Int [GroupInfo] -&gt; WScratch s -&gt; ST s MatchArray
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#tagsToGroupsST"><span class="hs-identifier hs-var">tagsToGroupsST</span></a></span><span> </span><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093600"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093385"><span class="hs-identifier hs-var">winners</span></a></span><span>
</span><span id="line-307"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093380"><span class="annot"><span class="annottext">offset' :: Int
</span><a href="#local-6989586621679093380"><span class="hs-identifier hs-var hs-var">offset'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093435"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s [MatchArray] -&gt; ST s [MatchArray]
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093380"><span class="hs-identifier hs-var">offset'</span></a></span><span> </span><span class="annot"><span class="annottext">(ST s [MatchArray] -&gt; ST s [MatchArray])
-&gt; ST s [MatchArray] -&gt; ST s [MatchArray]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093440"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093441"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093438"><span class="hs-identifier hs-var">did'</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093437"><span class="hs-identifier hs-var">dt'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093380"><span class="hs-identifier hs-var">offset'</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093434"><span class="hs-identifier hs-var">prev'</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093433"><span class="hs-identifier hs-var">input'</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- The &quot;newWinnerThenProceed&quot; can find both a new non-empty winner and</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- a new empty winner.  A new non-empty winner can cause some of the</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- NFA states that comprise the DFA state to be eliminated, and if the</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- startState is eliminated then it must then be respawned.  And</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- imperative flag setting and resetting style is used.</span><span>
</span><span id="line-315"></span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- A non-empty winner from the startState might obscure a potential</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- empty winner (form the startState at the current offset).  This</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- winEmpty possibility is also checked for. (unit test pattern &quot;.*&quot;)</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- (futher test &quot;(.+|.+.)*&quot; on &quot;aa\n&quot;)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679093517"><span class="hs-pragma hs-type">processWinner</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-322"></span><span>        </span><span id="local-6989586621679093517"><span class="annot"><span class="annottext">processWinner :: MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; IntMap Instructions
-&gt; Int
-&gt; ST s (SetIndex, DT)
</span><a href="#local-6989586621679093517"><span class="hs-identifier hs-var hs-var">processWinner</span></a></span></span><span> </span><span id="local-6989586621679093379"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679093378"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093378"><span class="hs-identifier hs-var">did</span></a></span></span><span> </span><span id="local-6989586621679093377"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093377"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span id="local-6989586621679093376"><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679093376"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679093375"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.newWinnerThenProceed&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-323"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093374"><span class="annot"><span class="annottext">prep :: (Int, Instructions)
-&gt; ST s (Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
</span><a href="#local-6989586621679093374"><span class="hs-identifier hs-var hs-var">prep</span></a></span></span><span> </span><span id="local-6989586621679093373"><span class="annot"><span class="annottext">x :: (Int, Instructions)
</span><a href="#local-6989586621679093373"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093372"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-var">sourceIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093371"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093371"><span class="hs-identifier hs-var">instructions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.newWinnerThenProceed.prep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-324"></span><span>                </span><span id="local-6989586621679093370"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (STUArray s Int Int)
-&gt; (STUArray s Int Int -&gt; ST s (STUArray s Int Int))
-&gt; Maybe (STUArray s Int Int)
-&gt; ST s (STUArray s Int Int)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ST s (STUArray s Int Int)
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newWinnerThenProceed,1&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (STUArray s Int Int) -&gt; ST s (STUArray s Int Int))
-&gt; ST s (Maybe (STUArray s Int Int)) -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; ST s (Maybe (STUArray s Int Int))
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span>
</span><span id="line-325"></span><span>                </span><span id="local-6989586621679093369"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093369"><span class="hs-identifier hs-var">startPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-326"></span><span>                </span><span id="local-6989586621679093368"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093368"><span class="hs-identifier hs-var">orbit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; ST s OrbitLog
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093372"><span class="hs-identifier hs-var">sourceIndex</span></a></span><span>
</span><span id="line-327"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093367"><span class="annot"><span class="annottext">orbit' :: OrbitLog
</span><a href="#local-6989586621679093367"><span class="hs-identifier hs-var hs-var">orbit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OrbitLog
-&gt; ((Int -&gt; OrbitLog -&gt; OrbitLog) -&gt; OrbitLog)
-&gt; Maybe (Int -&gt; OrbitLog -&gt; OrbitLog)
-&gt; OrbitLog
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093368"><span class="hs-identifier hs-var">orbit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679093366"><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; OrbitLog
</span><a href="#local-6989586621679093366"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; OrbitLog
</span><a href="#local-6989586621679093366"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093368"><span class="hs-identifier hs-var">orbit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; Maybe (Int -&gt; OrbitLog -&gt; OrbitLog)
</span><a href="Text.Regex.TDFA.Common.html#newOrbits"><span class="hs-identifier hs-var hs-var">newOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093371"><span class="hs-identifier hs-var">instructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                </span><span class="annot"><span class="annottext">(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; ST s (Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093369"><span class="hs-identifier hs-var">startPos</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093373"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093370"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093367"><span class="hs-identifier hs-var">orbit'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>              </span><span id="local-6989586621679093365"><span class="annot"><span class="annottext">challenge :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093365"><span class="hs-identifier hs-var hs-var">challenge</span></a></span></span><span> </span><span id="local-6989586621679093364"><span class="annot"><span class="annottext">x1 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093364"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093363"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093363"><span class="hs-identifier hs-var">_si1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093362"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093362"><span class="hs-identifier hs-var">ins1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093361"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093361"><span class="hs-identifier hs-var">_p1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093360"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093360"><span class="hs-identifier hs-var">_o1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093359"><span class="annot"><span class="annottext">x2 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093359"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093358"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093358"><span class="hs-identifier hs-var">_si2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093357"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093357"><span class="hs-identifier hs-var">ins2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093356"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093356"><span class="hs-identifier hs-var">_p2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093355"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093355"><span class="hs-identifier hs-var">_o2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.newWinnerThenProceed.challenge&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>                </span><span id="local-6989586621679093354"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093354"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">C s
forall s. C s
</span><a href="#local-6989586621679093575"><span class="hs-identifier hs-var">comp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093364"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093362"><span class="hs-identifier hs-var">ins1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093359"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093357"><span class="hs-identifier hs-var">ins2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093354"><span class="hs-identifier hs-var">check</span></a></span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093359"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093364"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-332"></span><span>          </span><span id="local-6989586621679093353"><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><a href="#local-6989586621679093353"><span class="hs-identifier hs-var">prep'd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Int, Instructions)
 -&gt; ST s (Int, ((Int, Instructions), STUArray s Int Int, OrbitLog)))
-&gt; [(Int, Instructions)]
-&gt; ST
     s [(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">(Int, Instructions)
-&gt; ST s (Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
forall s.
(MArray (STUArray s) Int (ST s),
 MArray (STArray s) (Maybe (STUArray s Int Int)) (ST s),
 MArray (STArray s) OrbitLog (ST s)) =&gt;
(Int, Instructions)
-&gt; ST s (Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
</span><a href="#local-6989586621679093374"><span class="hs-identifier hs-var">prep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntMap Instructions -&gt; [(Int, Instructions)]
forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">IMap.toList</span></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679093376"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093352"><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><a href="#local-6989586621679093352"><span class="hs-identifier hs-var">emptyFalse</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093351"><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><a href="#local-6989586621679093351"><span class="hs-identifier hs-var">emptyTrue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
 -&gt; Bool)
-&gt; [(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
-&gt; ([(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))],
    [(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool)
-&gt; ((Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
    -&gt; Int)
-&gt; (Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog)) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><a href="#local-6989586621679093353"><span class="hs-identifier hs-var">prep'd</span></a></span><span>
</span><span id="line-334"></span><span>          </span><span id="local-6989586621679093349"><span class="annot"><span class="annottext">Maybe [Int]
</span><a href="#local-6989586621679093349"><span class="hs-identifier hs-var">mayID</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.newWinnerThenProceed.mayID&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-335"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">((Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
 -&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; [(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
-&gt; [((Int, Instructions), STUArray s Int Int, OrbitLog)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><a href="#local-6989586621679093352"><span class="hs-identifier hs-var">emptyFalse</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-336"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [Int] -&gt; ST s (Maybe [Int])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Int]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-337"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621679093348"><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093348"><span class="hs-identifier hs-var">first</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093347"><span class="annot"><span class="annottext">[((Int, Instructions), STUArray s Int Int, OrbitLog)]
</span><a href="#local-6989586621679093347"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>                      </span><span id="local-6989586621679093346"><span class="annot"><span class="annottext">best :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093346"><span class="hs-identifier hs-var">best</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093345"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093345"><span class="hs-identifier hs-var">_sourceIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093344"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093344"><span class="hs-identifier hs-var">_instructions</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093343"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093343"><span class="hs-identifier hs-var">bp</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093342"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093342"><span class="hs-identifier hs-var">_orbit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((Int, Instructions), STUArray s Int Int, OrbitLog)
 -&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
 -&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [((Int, Instructions), STUArray s Int Int, OrbitLog)]
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall s.
((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST s ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093365"><span class="hs-identifier hs-var">challenge</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093348"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">[((Int, Instructions), STUArray s Int Int, OrbitLog)]
</span><a href="#local-6989586621679093347"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-339"></span><span>                      </span><span class="annot"><span class="annottext">Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog) -&gt; ST s ()
forall a c.
Int -&gt; ((a, Instructions), STUArray s Int Int, c) -&gt; ST s ()
</span><a href="#local-6989586621679093341"><span class="hs-identifier hs-var">newWinner</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093346"><span class="hs-identifier hs-var">best</span></a></span><span>
</span><span id="line-340"></span><span>                      </span><span id="local-6989586621679093340"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093340"><span class="hs-identifier hs-var">startWin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093343"><span class="hs-identifier hs-var">bp</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-341"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093339"><span class="annot"><span class="annottext">states :: [Int]
</span><a href="#local-6989586621679093339"><span class="hs-identifier hs-var hs-var">states</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SetIndex -&gt; [Int]
</span><span class="hs-identifier hs-var">ISet.toAscList</span></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093378"><span class="hs-identifier hs-var">did</span></a></span><span>
</span><span id="line-342"></span><span>                          </span><span id="local-6989586621679093338"><span class="annot"><span class="annottext">keepState :: Int -&gt; ST s Bool
</span><a href="#local-6989586621679093338"><span class="hs-identifier hs-var hs-var">keepState</span></a></span></span><span> </span><span id="local-6989586621679093337"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093337"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>                            </span><span id="local-6989586621679093336"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093336"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (STUArray s Int Int)
-&gt; (STUArray s Int Int -&gt; ST s (STUArray s Int Int))
-&gt; Maybe (STUArray s Int Int)
-&gt; ST s (STUArray s Int Int)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ST s (STUArray s Int Int)
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newWinnerThenProceed,2&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (STUArray s Int Int) -&gt; ST s (STUArray s Int Int))
-&gt; ST s (Maybe (STUArray s Int Int)) -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; ST s (Maybe (STUArray s Int Int))
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093337"><span class="hs-identifier hs-var">i1</span></a></span><span>
</span><span id="line-344"></span><span>                            </span><span id="local-6989586621679093335"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093335"><span class="hs-identifier hs-var">startsAt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093336"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-345"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093334"><span class="annot"><span class="annottext">keep :: Bool
</span><a href="#local-6989586621679093334"><span class="hs-identifier hs-var hs-var">keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093335"><span class="hs-identifier hs-var">startsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093340"><span class="hs-identifier hs-var">startWin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093335"><span class="hs-identifier hs-var">startsAt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>                            </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093334"><span class="hs-identifier hs-var">keep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s () -&gt; ST s ()) -&gt; ST s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>                              </span><span class="annot"><span class="annottext">STRef s Bool -&gt; Bool -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093553"><span class="hs-identifier hs-var">eliminatedStateFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-348"></span><span>                              </span><span class="annot"><span class="annottext">Bool -&gt; ST s () -&gt; ST s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093337"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093610"><span class="hs-identifier hs-var">startState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRef s Bool -&gt; Bool -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093552"><span class="hs-identifier hs-var">eliminatedRespawnFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>                            </span><span class="annot"><span class="annottext">Bool -&gt; ST s Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093334"><span class="hs-identifier hs-var">keep</span></a></span><span>
</span><span id="line-350"></span><span>                      </span><span id="local-6989586621679093332"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093332"><span class="hs-identifier hs-var">states'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ST s Bool) -&gt; [Int] -&gt; ST s [Int]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s Bool
</span><a href="#local-6989586621679093338"><span class="hs-identifier hs-var">keepState</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093339"><span class="hs-identifier hs-var">states</span></a></span><span>
</span><span id="line-351"></span><span>                      </span><span id="local-6989586621679093331"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093331"><span class="hs-identifier hs-var">changed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Bool -&gt; ST s Bool
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093553"><span class="hs-identifier hs-var">eliminatedStateFlag</span></a></span><span>
</span><span id="line-352"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093331"><span class="hs-identifier hs-var">changed</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe [Int] -&gt; ST s (Maybe [Int])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Maybe [Int]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093332"><span class="hs-identifier hs-var">states'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [Int] -&gt; ST s (Maybe [Int])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Int]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-353"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><a href="#local-6989586621679093351"><span class="hs-identifier hs-var">emptyTrue</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap Instructions -&gt; Maybe Instructions
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093610"><span class="hs-identifier hs-var">startState</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Instructions
</span><a href="#local-6989586621679093376"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-355"></span><span>                   </span><span class="annot"><span class="annottext">Maybe Instructions
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679093330"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093330"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Instructions -&gt; ST s ()
</span><a href="#local-6989586621679093329"><span class="hs-identifier hs-var">winEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093330"><span class="hs-identifier hs-var">ins</span></a></span><span>
</span><span id="line-357"></span><span>            </span><span class="hs-special">[</span><span id="local-6989586621679093328"><span class="annot"><span class="annottext">(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
</span><a href="#local-6989586621679093328"><span class="hs-identifier hs-var">first</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog) -&gt; ST s ()
forall a c.
Int -&gt; ((a, Instructions), STUArray s Int Int, c) -&gt; ST s ()
</span><a href="#local-6989586621679093341"><span class="hs-identifier hs-var">newWinner</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))
</span><a href="#local-6989586621679093328"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>            </span><span class="annot"><span class="annottext">[(Int, ((Int, Instructions), STUArray s Int Int, OrbitLog))]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ST s ()
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newWinnerThenProceed,3 : too many emptyTrue values&quot;</span></span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [Int]
</span><a href="#local-6989586621679093349"><span class="hs-identifier hs-var">mayID</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Int]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SetIndex, DT) -&gt; ST s (SetIndex, DT)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093378"><span class="hs-identifier hs-var">did</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093377"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- proceedNow s1 s2 did dt offset prev input</span><span>
</span><span id="line-361"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679093327"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093327"><span class="hs-identifier hs-var">states'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>              </span><span class="annot"><span class="annottext">STRef s Bool -&gt; Bool -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093553"><span class="hs-identifier hs-var">eliminatedStateFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-363"></span><span>              </span><span id="local-6989586621679093326"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093326"><span class="hs-identifier hs-var">respawn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Bool -&gt; ST s Bool
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093552"><span class="hs-identifier hs-var">eliminatedRespawnFlag</span></a></span><span>
</span><span id="line-364"></span><span>              </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#DFA"><span class="hs-identifier hs-type">DFA</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">d_id :: DFA -&gt; SetIndex
</span><a href="Text.Regex.TDFA.Common.html#d_id"><span class="hs-identifier hs-var">d_id</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093325"><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093325"><span class="hs-identifier hs-var">did'</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d_dt :: DFA -&gt; DT
</span><a href="Text.Regex.TDFA.Common.html#d_dt"><span class="hs-identifier hs-var">d_dt</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093324"><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093324"><span class="hs-identifier hs-var">dt'</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-365"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093326"><span class="hs-identifier hs-var">respawn</span></a></span><span>
</span><span id="line-366"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>                    </span><span class="annot"><span class="annottext">STRef s Bool -&gt; Bool -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Bool
</span><a href="#local-6989586621679093552"><span class="hs-identifier hs-var">eliminatedRespawnFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-368"></span><span>                    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
forall s.
(Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#spawnStart"><span class="hs-identifier hs-var">spawnStart</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">b_tags</span></a></span><span> </span><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">blank</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093610"><span class="hs-identifier hs-var">startState</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093379"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093375"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                    </span><span class="annot"><span class="annottext">DFA -&gt; ST s DFA
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TrieSet DFA -&gt; [Int] -&gt; DFA
forall v. TrieSet v -&gt; [Int] -&gt; v
</span><a href="Text.Regex.TDFA.IntArrTrieSet.html#lookupAsc"><span class="hs-identifier hs-var">Trie.lookupAsc</span></a></span><span> </span><span class="annot"><span class="annottext">TrieSet DFA
</span><a href="#local-6989586621679093604"><span class="hs-identifier hs-var">trie</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093327"><span class="hs-identifier hs-var">states'</span></a></span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093610"><span class="hs-identifier hs-var">startState</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DFA -&gt; ST s DFA
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TrieSet DFA -&gt; [Int] -&gt; DFA
forall v. TrieSet v -&gt; [Int] -&gt; v
</span><a href="Text.Regex.TDFA.IntArrTrieSet.html#lookupAsc"><span class="hs-identifier hs-var">Trie.lookupAsc</span></a></span><span> </span><span class="annot"><span class="annottext">TrieSet DFA
</span><a href="#local-6989586621679093604"><span class="hs-identifier hs-var">trie</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679093327"><span class="hs-identifier hs-var">states'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>              </span><span class="annot"><span class="annottext">(SetIndex, DT) -&gt; ST s (SetIndex, DT)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093325"><span class="hs-identifier hs-var">did'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093324"><span class="hs-identifier hs-var">dt'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621679093329"><span class="annot"><span class="annottext">winEmpty :: Int -&gt; Instructions -&gt; ST s ()
</span><a href="#local-6989586621679093329"><span class="hs-identifier hs-var hs-var">winEmpty</span></a></span></span><span> </span><span id="local-6989586621679093323"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093323"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093322"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093322"><span class="hs-identifier hs-var">winInstructions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.winEmpty&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-374"></span><span>          </span><span id="local-6989586621679093321"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093321"><span class="hs-identifier hs-var">newerPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (STUArray s Int Int)
forall s e.
MArray (STUArray s) e (ST s) =&gt;
(Int, Int) -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-identifier hs-var">newA_</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">b_tags</span></a></span><span>
</span><span id="line-375"></span><span>          </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; STUArray s Int Int -&gt; ST s ()
forall i s e.
(Show i, Ix i, MArray (STUArray s) e (ST s)) =&gt;
STUArray s i e -&gt; STUArray s i e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-identifier hs-var">copySTU</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlankScratch s -&gt; STUArray s Int Int
forall s. BlankScratch s -&gt; STUArray s Int Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#blank_pos"><span class="hs-identifier hs-var hs-var">blank_pos</span></a></span><span> </span><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093557"><span class="hs-identifier hs-var">blank</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093321"><span class="hs-identifier hs-var">newerPos</span></a></span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093321"><span class="hs-identifier hs-var">newerPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093323"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-377"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
forall s. Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#doActions"><span class="hs-identifier hs-var">doActions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093323"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093321"><span class="hs-identifier hs-var">newerPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093322"><span class="hs-identifier hs-var">winInstructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>          </span><span class="annot"><span class="annottext">WScratch s -&gt; MQ s -&gt; ST s ()
forall s. WScratch s -&gt; MQ s -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#putMQ"><span class="hs-identifier hs-var">putMQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; WScratch s
forall s. STUArray s Int Int -&gt; WScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-var">WScratch</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093321"><span class="hs-identifier hs-var">newerPos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span><span>
</span><span id="line-379"></span><span>                </span><span>
</span><span id="line-380"></span><span>        </span><span id="local-6989586621679093341"><span class="annot"><span class="annottext">newWinner :: Int -&gt; ((a, Instructions), STUArray s Int Int, c) -&gt; ST s ()
</span><a href="#local-6989586621679093341"><span class="hs-identifier hs-var hs-var">newWinner</span></a></span></span><span> </span><span id="local-6989586621679093315"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093315"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093314"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679093314"><span class="hs-identifier hs-var">_sourceIndex</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093313"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093313"><span class="hs-identifier hs-var">winInstructions</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093312"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093312"><span class="hs-identifier hs-var">oldPos</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093311"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679093311"><span class="hs-identifier hs-var">_newOrbit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;goNext.newWinner&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>          </span><span id="local-6989586621679093310"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093310"><span class="hs-identifier hs-var">newerPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (STUArray s Int Int)
forall s e.
MArray (STUArray s) e (ST s) =&gt;
(Int, Int) -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-identifier hs-var">newA_</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093582"><span class="hs-identifier hs-var">b_tags</span></a></span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; STUArray s Int Int -&gt; ST s ()
forall i s e.
(Show i, Ix i, MArray (STUArray s) e (ST s)) =&gt;
STUArray s i e -&gt; STUArray s i e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-identifier hs-var">copySTU</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093312"><span class="hs-identifier hs-var">oldPos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093310"><span class="hs-identifier hs-var">newerPos</span></a></span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="annottext">Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
forall s. Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#doActions"><span class="hs-identifier hs-var">doActions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093315"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093310"><span class="hs-identifier hs-var">newerPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093313"><span class="hs-identifier hs-var">winInstructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>          </span><span class="annot"><span class="annottext">WScratch s -&gt; MQ s -&gt; ST s ()
forall s. WScratch s -&gt; MQ s -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#putMQ"><span class="hs-identifier hs-var">putMQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; WScratch s
forall s. STUArray s Int Int -&gt; WScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-var">WScratch</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093310"><span class="hs-identifier hs-var">newerPos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>        </span><span id="local-6989586621679093529"><span class="annot"><span class="annottext">finalizeWinners :: ST s [MatchArray]
</span><a href="#local-6989586621679093529"><span class="hs-identifier hs-var hs-var">finalizeWinners</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-387"></span><span>          </span><span id="local-6989586621679093309"><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093309"><span class="hs-identifier hs-var">winners</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([MQA s] -&gt; [WScratch s]) -&gt; ST s [MQA s] -&gt; ST s [WScratch s]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([WScratch s] -&gt; MQA s -&gt; [WScratch s])
-&gt; [WScratch s] -&gt; [MQA s] -&gt; [WScratch s]
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679093308"><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093308"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621679093307"><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093307"><span class="hs-identifier hs-var">mqa</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MQA s -&gt; WScratch s
forall s. MQA s -&gt; WScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_ws"><span class="hs-identifier hs-var hs-var">mqa_ws</span></a></span><span> </span><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093307"><span class="hs-identifier hs-var">mqa</span></a></span><span> </span><span class="annot"><span class="annottext">WScratch s -&gt; [WScratch s] -&gt; [WScratch s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093308"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ST s [MQA s] -&gt; ST s [WScratch s])
-&gt; ST s [MQA s] -&gt; ST s [WScratch s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-388"></span><span>                       </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; ST s [MQA s]
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQ s -&gt; STRef s [MQA s]
forall s. MQ s -&gt; STRef s [MQA s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_list"><span class="hs-identifier hs-var hs-var">mq_list</span></a></span><span> </span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- reverses the winner list</span><span>
</span><span id="line-389"></span><span>          </span><span class="annot"><span class="annottext">MQ s -&gt; ST s ()
forall s. MQ s -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#resetMQ"><span class="hs-identifier hs-var">resetMQ</span></a></span><span> </span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093558"><span class="hs-identifier hs-var">winQ</span></a></span><span>
</span><span id="line-390"></span><span>          </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray]) -&gt; ST s [MatchArray] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s (ST s [MatchArray])
</span><a href="#local-6989586621679093562"><span class="hs-identifier hs-var">storeNext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MatchArray] -&gt; ST s [MatchArray]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>          </span><span class="annot"><span class="annottext">(WScratch s -&gt; ST s MatchArray)
-&gt; [WScratch s] -&gt; ST s [MatchArray]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int [GroupInfo] -&gt; WScratch s -&gt; ST s MatchArray
forall s. Array Int [GroupInfo] -&gt; WScratch s -&gt; ST s MatchArray
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#tagsToGroupsST"><span class="hs-identifier hs-var">tagsToGroupsST</span></a></span><span> </span><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093600"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[WScratch s]
</span><a href="#local-6989586621679093309"><span class="hs-identifier hs-var">winners</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-comment">-- goNext then ends with the next statement</span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; SetIndex
-&gt; DT
-&gt; Int
-&gt; Char
-&gt; text
-&gt; ST s [MatchArray]
</span><a href="#local-6989586621679093551"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093560"><span class="hs-identifier hs-var">s1In</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093559"><span class="hs-identifier hs-var">s2In</span></a></span><span> </span><span class="annot"><span class="annottext">SetIndex
</span><a href="#local-6989586621679093614"><span class="hs-identifier hs-var">didIn</span></a></span><span> </span><span class="annot"><span class="annottext">DT
</span><a href="#local-6989586621679093612"><span class="hs-identifier hs-var">dtIn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093589"><span class="hs-identifier hs-var">offsetIn</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679093588"><span class="hs-identifier hs-var">prevIn</span></a></span><span> </span><span class="annot"><span class="annottext">text
</span><a href="#local-6989586621679093587"><span class="hs-identifier hs-var">inputIn</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#doActions"><span class="hs-pragma hs-type">doActions</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-397"></span><span id="local-6989586621679093752"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#doActions"><span class="hs-identifier hs-type">doActions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093752"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093752"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-398"></span><span id="doActions"><span class="annot"><span class="annottext">doActions :: Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#doActions"><span class="hs-identifier hs-var hs-var">doActions</span></a></span></span><span> </span><span id="local-6989586621679093303"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093303"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093302"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093302"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679093301"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093301"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Action) -&gt; ST s ()) -&gt; [(Int, Action)] -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">(Int, Action) -&gt; ST s ()
forall s.
MArray (STUArray s) Int (ST s) =&gt;
(Int, Action) -&gt; ST s ()
</span><a href="#local-6989586621679093300"><span class="hs-identifier hs-var">doAction</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093301"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621679093299"><span class="annot"><span class="annottext">postTag :: Int
</span><a href="#local-6989586621679093299"><span class="hs-identifier hs-var hs-var">postTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093303"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span id="local-6989586621679093300"><span class="annot"><span class="annottext">doAction :: (Int, Action) -&gt; ST s ()
</span><a href="#local-6989586621679093300"><span class="hs-identifier hs-var hs-var">doAction</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093298"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093298"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093302"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093298"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093303"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><a href="#local-6989586621679093300"><span class="hs-identifier hs-var">doAction</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093296"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093296"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093302"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093296"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093299"><span class="hs-identifier hs-var">postTag</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><a href="#local-6989586621679093300"><span class="hs-identifier hs-var">doAction</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093295"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093295"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679093293"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093293"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093302"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093295"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093293"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-comment">----</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#mkTest"><span class="hs-pragma hs-type">mkTest</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-407"></span><span id="local-6989586621679093904"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#mkTest"><span class="hs-identifier hs-type">mkTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Uncons.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093904"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#WhichTest"><span class="hs-identifier hs-type">WhichTest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093904"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-408"></span><span id="mkTest"><span class="annot"><span class="annottext">mkTest :: Bool -&gt; WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mkTest"><span class="hs-identifier hs-var hs-var">mkTest</span></a></span></span><span> </span><span id="local-6989586621679093291"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093291"><span class="hs-identifier hs-var">isMultiline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093291"><span class="hs-identifier hs-var">isMultiline</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
forall text.
Uncons text =&gt;
WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="Text.Regex.TDFA.NewDFA.MakeTest.html#test_multiline"><span class="hs-identifier hs-var">test_multiline</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
forall text.
Uncons text =&gt;
WhichTest -&gt; Int -&gt; Char -&gt; text -&gt; Bool
</span><a href="Text.Regex.TDFA.NewDFA.MakeTest.html#test_singleline"><span class="hs-identifier hs-var">test_singleline</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">----</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="hs-comment">{- MUTABLE WINNER QUEUE -}</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-keyword">data</span><span> </span><span id="MQA"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQA"><span class="hs-identifier hs-var">MQA</span></a></span></span><span> </span><span id="local-6989586621679093748"><span class="annot"><a href="#local-6989586621679093748"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MQA"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQA"><span class="hs-identifier hs-var">MQA</span></a></span></span><span> </span><span class="hs-special">{</span><span id="mqa_start"><span class="annot"><span class="annottext">MQA s -&gt; Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_start"><span class="hs-identifier hs-var hs-var">mqa_start</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">,</span><span> </span><span id="mqa_ws"><span class="annot"><span class="annottext">MQA s -&gt; WScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_ws"><span class="hs-identifier hs-var hs-var">mqa_ws</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-type">WScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093748"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-keyword">data</span><span> </span><span id="MQ"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-var">MQ</span></a></span></span><span> </span><span id="local-6989586621679093774"><span class="annot"><a href="#local-6989586621679093774"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MQ"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-var">MQ</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="mq_earliest"><span class="annot"><span class="annottext">MQ s -&gt; STRef s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_earliest"><span class="hs-identifier hs-var hs-var">mq_earliest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679093774"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="mq_list"><span class="annot"><span class="annottext">MQ s -&gt; STRef s [MQA s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_list"><span class="hs-identifier hs-var hs-var">mq_list</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679093774"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQA"><span class="hs-identifier hs-type">MQA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093774"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span id="local-6989586621679093715"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMQ"><span class="hs-identifier hs-type">newMQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093715"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093715"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-421"></span><span id="newMQ"><span class="annot"><span class="annottext">newMQ :: ST s (MQ s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMQ"><span class="hs-identifier hs-var hs-var">newMQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621679093286"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-var">earliest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (STRef s Int)
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621679093284"><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093284"><span class="hs-identifier hs-var">list</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[MQA s] -&gt; ST s (STRef s [MQA s])
forall a s. a -&gt; ST s (STRef s a)
</span><span class="hs-identifier hs-var">newSTRef</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">MQ s -&gt; ST s (MQ s)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STRef s Int -&gt; STRef s [MQA s] -&gt; MQ s
forall s. STRef s Int -&gt; STRef s [MQA s] -&gt; MQ s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-var">MQ</span></a></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-var">earliest</span></a></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093284"><span class="hs-identifier hs-var">list</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span id="local-6989586621679093747"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#resetMQ"><span class="hs-identifier hs-type">resetMQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093747"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093747"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-427"></span><span id="resetMQ"><span class="annot"><span class="annottext">resetMQ :: MQ s -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#resetMQ"><span class="hs-identifier hs-var hs-var">resetMQ</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mq_earliest :: forall s. MQ s -&gt; STRef s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_earliest"><span class="hs-identifier hs-var">mq_earliest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093283"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093283"><span class="hs-identifier hs-var">earliest</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">mq_list :: forall s. MQ s -&gt; STRef s [MQA s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_list"><span class="hs-identifier hs-var">mq_list</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093282"><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093282"><span class="hs-identifier hs-var">list</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093283"><span class="hs-identifier hs-var">earliest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; [MQA s] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093282"><span class="hs-identifier hs-var">list</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span id="local-6989586621679093751"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#putMQ"><span class="hs-identifier hs-type">putMQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-type">WScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093751"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093751"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093751"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-432"></span><span id="putMQ"><span class="annot"><span class="annottext">putMQ :: WScratch s -&gt; MQ s -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#putMQ"><span class="hs-identifier hs-var hs-var">putMQ</span></a></span></span><span> </span><span id="local-6989586621679093281"><span class="annot"><span class="annottext">WScratch s
</span><a href="#local-6989586621679093281"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mq_earliest :: forall s. MQ s -&gt; STRef s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_earliest"><span class="hs-identifier hs-var">mq_earliest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093280"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093280"><span class="hs-identifier hs-var">earliest</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">mq_list :: forall s. MQ s -&gt; STRef s [MQA s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_list"><span class="hs-identifier hs-var">mq_list</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093279"><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093279"><span class="hs-identifier hs-var">list</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>  </span><span id="local-6989586621679093278"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093278"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WScratch s -&gt; STUArray s Int Int
forall s. WScratch s -&gt; STUArray s Int Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#w_pos"><span class="hs-identifier hs-var hs-var">w_pos</span></a></span><span> </span><span class="annot"><span class="annottext">WScratch s
</span><a href="#local-6989586621679093281"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093276"><span class="annot"><span class="annottext">mqa :: MQA s
</span><a href="#local-6989586621679093276"><span class="hs-identifier hs-var hs-var">mqa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; WScratch s -&gt; MQA s
forall s. Int -&gt; WScratch s -&gt; MQA s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQA"><span class="hs-identifier hs-var">MQA</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093278"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">WScratch s
</span><a href="#local-6989586621679093281"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span id="local-6989586621679093275"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093275"><span class="hs-identifier hs-var">startE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; ST s Int
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093280"><span class="hs-identifier hs-var">earliest</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093278"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093275"><span class="hs-identifier hs-var">startE</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093280"><span class="hs-identifier hs-var">earliest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093278"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">ST s () -&gt; ST s () -&gt; ST s ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; [MQA s] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093279"><span class="hs-identifier hs-var">list</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093276"><span class="hs-identifier hs-var">mqa</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>  </span><span id="local-6989586621679093274"><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093274"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; ST s [MQA s]
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093279"><span class="hs-identifier hs-var">list</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679093273"><span class="annot"><span class="annottext">rest :: [MQA s]
</span><a href="#local-6989586621679093273"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MQA s -&gt; Bool) -&gt; [MQA s] -&gt; [MQA s]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">dropWhile</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679093271"><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093271"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093278"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">MQA s -&gt; Int
forall s. MQA s -&gt; Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_start"><span class="hs-identifier hs-var hs-var">mqa_start</span></a></span><span> </span><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093271"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093274"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679093270"><span class="annot"><span class="annottext">new :: [MQA s]
</span><a href="#local-6989586621679093270"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093276"><span class="hs-identifier hs-var">mqa</span></a></span><span> </span><span class="annot"><span class="annottext">MQA s -&gt; [MQA s] -&gt; [MQA s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093273"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; [MQA s] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093279"><span class="hs-identifier hs-var">list</span></a></span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093270"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span id="local-6989586621679093770"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#getMQ"><span class="hs-identifier hs-type">getMQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093770"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093770"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-type">WScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093770"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-445"></span><span id="getMQ"><span class="annot"><span class="annottext">getMQ :: Int -&gt; MQ s -&gt; ST s [WScratch s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#getMQ"><span class="hs-identifier hs-var hs-var">getMQ</span></a></span></span><span> </span><span id="local-6989586621679093269"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093269"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mq_earliest :: forall s. MQ s -&gt; STRef s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_earliest"><span class="hs-identifier hs-var">mq_earliest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093268"><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093268"><span class="hs-identifier hs-var">earliest</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">mq_list :: forall s. MQ s -&gt; STRef s [MQA s]
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mq_list"><span class="hs-identifier hs-var">mq_list</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093267"><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093267"><span class="hs-identifier hs-var">list</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>  </span><span id="local-6989586621679093266"><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093266"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; ST s [MQA s]
forall s a. STRef s a -&gt; ST s a
</span><span class="hs-identifier hs-var">readSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093267"><span class="hs-identifier hs-var">list</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(MQA s -&gt; Bool) -&gt; [MQA s] -&gt; ([MQA s], [MQA s])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">span</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679093264"><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093264"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093269"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">MQA s -&gt; Int
forall s. MQA s -&gt; Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_start"><span class="hs-identifier hs-var hs-var">mqa_start</span></a></span><span> </span><span class="annot"><span class="annottext">MQA s
</span><a href="#local-6989586621679093264"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093266"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span id="local-6989586621679093263"><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093263"><span class="hs-identifier hs-var">ans</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>      </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093268"><span class="hs-identifier hs-var">earliest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; [MQA s] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093267"><span class="hs-identifier hs-var">list</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><span class="annottext">[WScratch s] -&gt; ST s [WScratch s]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MQA s -&gt; WScratch s) -&gt; [MQA s] -&gt; [WScratch s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MQA s -&gt; WScratch s
forall s. MQA s -&gt; WScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_ws"><span class="hs-identifier hs-var hs-var">mqa_ws</span></a></span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093263"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679093262"><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093262"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093261"><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093261"><span class="hs-identifier hs-var">ans</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>      </span><span class="annot"><span class="annottext">STRef s Int -&gt; Int -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s Int
</span><a href="#local-6989586621679093268"><span class="hs-identifier hs-var">earliest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQA s -&gt; Int
forall s. MQA s -&gt; Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_start"><span class="hs-identifier hs-var hs-var">mqa_start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MQA s] -&gt; MQA s
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093262"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>      </span><span class="annot"><span class="annottext">STRef s [MQA s] -&gt; [MQA s] -&gt; ST s ()
forall s a. STRef s a -&gt; a -&gt; ST s ()
</span><span class="hs-identifier hs-var">writeSTRef</span></span><span> </span><span class="annot"><span class="annottext">STRef s [MQA s]
</span><a href="#local-6989586621679093267"><span class="hs-identifier hs-var">list</span></a></span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093262"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><span class="annottext">[WScratch s] -&gt; ST s [WScratch s]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MQA s -&gt; WScratch s) -&gt; [MQA s] -&gt; [WScratch s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MQA s -&gt; WScratch s
forall s. MQA s -&gt; WScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#mqa_ws"><span class="hs-identifier hs-var hs-var">mqa_ws</span></a></span><span> </span><span class="annot"><span class="annottext">[MQA s]
</span><a href="#local-6989586621679093261"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">{- MUTABLE SCRATCH DATA STRUCTURES -}</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="hs-keyword">data</span><span> </span><span id="SScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#SScratch"><span class="hs-identifier hs-var">SScratch</span></a></span></span><span> </span><span id="local-6989586621679093712"><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#SScratch"><span class="hs-identifier hs-var">SScratch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_s_1"><span class="annot"><span class="annottext">SScratch s -&gt; MScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#_s_1"><span class="hs-identifier hs-var hs-var">_s_1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-type">MScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="_s_2"><span class="annot"><span class="annottext">SScratch s -&gt; MScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#_s_2"><span class="hs-identifier hs-var hs-var">_s_2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-type">MScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="_s_rest"><span class="annot"><span class="annottext">SScratch s
-&gt; (MQ s, BlankScratch s,
    STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#_s_rest"><span class="hs-identifier hs-var hs-var">_s_rest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MQ"><span class="hs-identifier hs-type">MQ</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-462"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#BlankScratch"><span class="hs-identifier hs-type">BlankScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-463"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093712"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OrbitLog"><span class="hs-identifier hs-type">OrbitLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-466"></span><span class="hs-keyword">data</span><span> </span><span id="MScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-var">MScratch</span></a></span></span><span> </span><span id="local-6989586621679093845"><span class="annot"><a href="#local-6989586621679093845"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-var">MScratch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="m_pos"><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093845"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093845"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                           </span><span class="hs-special">,</span><span> </span><span id="m_orbit"><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093845"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OrbitLog"><span class="hs-identifier hs-type">OrbitLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-469"></span><span class="hs-keyword">newtype</span><span> </span><span id="BlankScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#BlankScratch"><span class="hs-identifier hs-var">BlankScratch</span></a></span></span><span> </span><span id="local-6989586621679093790"><span class="annot"><a href="#local-6989586621679093790"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BlankScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#BlankScratch"><span class="hs-identifier hs-var">BlankScratch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="blank_pos"><span class="annot"><span class="annottext">BlankScratch s -&gt; STUArray s Int Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#blank_pos"><span class="hs-identifier hs-var hs-var">blank_pos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093790"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>                                      </span><span class="hs-special">}</span><span>
</span><span id="line-471"></span><span class="hs-keyword">newtype</span><span> </span><span id="WScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-var">WScratch</span></a></span></span><span> </span><span id="local-6989586621679093750"><span class="annot"><a href="#local-6989586621679093750"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WScratch"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-var">WScratch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="w_pos"><span class="annot"><span class="annottext">WScratch s -&gt; STUArray s Int Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#w_pos"><span class="hs-identifier hs-var hs-var">w_pos</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093750"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>                              </span><span class="hs-special">}</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-comment">{- DEBUGGING HELPERS -}</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">{-
indent :: String -&gt; String
indent xs = ' ':' ':xs

showMS :: MScratch s -&gt; Index -&gt; ST s String
showMS s i = do
  ma &lt;- m_pos s !! i
  mc &lt;- m_orbit s !! i
  a &lt;- case ma of
        Nothing -&gt; return &quot;No pos&quot;
        Just pos -&gt; fmap show (getAssocs pos)
  let c = show mc
  return $ unlines [ &quot;MScratch, index = &quot;++show i
                   , indent a
                   , indent c]

showMS2 :: MScratch s -&gt; ST s String
showMS2 s = do
  (lo,hi) &lt;- getBounds (m_pos s)
  strings &lt;- forM [lo..hi] (showMS s)
  return (unlines strings)

showWS :: WScratch s -&gt; ST s String
showWS (WScratch pos) = do
  a &lt;- getAssocs pos
  return $ unlines [ &quot;WScratch&quot; 
                   , indent (show a)]
-}</span><span>
</span><span id="line-504"></span><span class="hs-comment">{- CREATING INITIAL MUTABLE SCRATCH DATA STRUCTURES -}</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA"><span class="hs-pragma hs-type">newA</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-507"></span><span id="local-6989586621679093713"><span id="local-6989586621679093714"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA"><span class="hs-identifier hs-type">newA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093714"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679093713"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093714"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679093713"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093714"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093714"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093713"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-508"></span><span id="newA"><span class="annot"><span class="annottext">newA :: (Int, Int) -&gt; e -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA"><span class="hs-identifier hs-var hs-var">newA</span></a></span></span><span> </span><span id="local-6989586621679093253"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093253"><span class="hs-identifier hs-var">b_tags</span></a></span></span><span> </span><span id="local-6989586621679093252"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679093252"><span class="hs-identifier hs-var">initial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; e -&gt; ST s (STUArray s Int e)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093253"><span class="hs-identifier hs-var">b_tags</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679093252"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-pragma hs-type">newA_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-511"></span><span id="local-6989586621679093756"><span id="local-6989586621679093757"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-identifier hs-type">newA_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093757"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679093756"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093757"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093757"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093757"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093756"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-512"></span><span id="newA_"><span class="annot"><span class="annottext">newA_ :: (Int, Int) -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-identifier hs-var hs-var">newA_</span></a></span></span><span> </span><span id="local-6989586621679093250"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093250"><span class="hs-identifier hs-var">b_tags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (STUArray s Int e)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray_</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093250"><span class="hs-identifier hs-var">b_tags</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span id="local-6989586621679093867"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newScratch"><span class="hs-identifier hs-type">newScratch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093867"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#SScratch"><span class="hs-identifier hs-type">SScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093867"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-515"></span><span id="newScratch"><span class="annot"><span class="annottext">newScratch :: (Int, Int) -&gt; (Int, Int) -&gt; ST s (SScratch s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newScratch"><span class="hs-identifier hs-var hs-var">newScratch</span></a></span></span><span> </span><span id="local-6989586621679093248"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093248"><span class="hs-identifier hs-var">b_index</span></a></span></span><span> </span><span id="local-6989586621679093247"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093247"><span class="hs-identifier hs-var">b_tags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-516"></span><span>  </span><span id="local-6989586621679093246"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093246"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (MScratch s)
forall s. (Int, Int) -&gt; ST s (MScratch s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMScratch"><span class="hs-identifier hs-var">newMScratch</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093248"><span class="hs-identifier hs-var">b_index</span></a></span><span>
</span><span id="line-517"></span><span>  </span><span id="local-6989586621679093244"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093244"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (MScratch s)
forall s. (Int, Int) -&gt; ST s (MScratch s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMScratch"><span class="hs-identifier hs-var">newMScratch</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093248"><span class="hs-identifier hs-var">b_index</span></a></span><span>
</span><span id="line-518"></span><span>  </span><span id="local-6989586621679093243"><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093243"><span class="hs-identifier hs-var">winQ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (MQ s)
forall s. ST s (MQ s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMQ"><span class="hs-identifier hs-var">newMQ</span></a></span><span>
</span><span id="line-519"></span><span>  </span><span id="local-6989586621679093242"><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093242"><span class="hs-identifier hs-var">blank</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(STUArray s Int Int -&gt; BlankScratch s)
-&gt; ST s (STUArray s Int Int) -&gt; ST s (BlankScratch s)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; BlankScratch s
forall s. STUArray s Int Int -&gt; BlankScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#BlankScratch"><span class="hs-identifier hs-var">BlankScratch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int -&gt; ST s (STUArray s Int Int)
forall s e.
MArray (STUArray s) e (ST s) =&gt;
(Int, Int) -&gt; e -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA"><span class="hs-identifier hs-var">newA</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093247"><span class="hs-identifier hs-var">b_tags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span id="local-6989586621679093241"><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093241"><span class="hs-identifier hs-var">which</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int)
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; ST
     s
     (STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog))
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093248"><span class="hs-identifier hs-var">b_index</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; Instructions
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newScratch which 1&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; STUArray s Int Int
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newScratch which 2&quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; OrbitLog
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newScratch which 3&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">SScratch s -&gt; ST s (SScratch s)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s
-&gt; MScratch s
-&gt; (MQ s, BlankScratch s,
    STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; SScratch s
forall s.
MScratch s
-&gt; MScratch s
-&gt; (MQ s, BlankScratch s,
    STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog))
-&gt; SScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#SScratch"><span class="hs-identifier hs-var">SScratch</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093246"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093244"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MQ s
</span><a href="#local-6989586621679093243"><span class="hs-identifier hs-var">winQ</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">BlankScratch s
</span><a href="#local-6989586621679093242"><span class="hs-identifier hs-var">blank</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">STArray s Int ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093241"><span class="hs-identifier hs-var">which</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span id="local-6989586621679093716"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMScratch"><span class="hs-identifier hs-type">newMScratch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093716"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-type">MScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093716"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-524"></span><span id="newMScratch"><span class="annot"><span class="annottext">newMScratch :: (Int, Int) -&gt; ST s (MScratch s)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newMScratch"><span class="hs-identifier hs-var hs-var">newMScratch</span></a></span></span><span> </span><span id="local-6989586621679093240"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093240"><span class="hs-identifier hs-var">b_index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-525"></span><span>  </span><span id="local-6989586621679093239"><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
</span><a href="#local-6989586621679093239"><span class="hs-identifier hs-var">pos's</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; Maybe (STUArray s Int Int)
-&gt; ST s (STArray s Int (Maybe (STUArray s Int Int)))
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093240"><span class="hs-identifier hs-var">b_index</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (STUArray s Int Int)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-526"></span><span>  </span><span id="local-6989586621679093238"><span class="annot"><span class="annottext">STArray s Int OrbitLog
</span><a href="#local-6989586621679093238"><span class="hs-identifier hs-var">orbit's</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; OrbitLog -&gt; ST s (STArray s Int OrbitLog)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093240"><span class="hs-identifier hs-var">b_index</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">Mon.mempty</span></span><span>
</span><span id="line-527"></span><span>  </span><span class="annot"><span class="annottext">MScratch s -&gt; ST s (MScratch s)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; STArray s Int OrbitLog -&gt; MScratch s
forall s.
STArray s Int (Maybe (STUArray s Int Int))
-&gt; STArray s Int OrbitLog -&gt; MScratch s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-var">MScratch</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
</span><a href="#local-6989586621679093239"><span class="hs-identifier hs-var">pos's</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int OrbitLog
</span><a href="#local-6989586621679093238"><span class="hs-identifier hs-var">orbit's</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="hs-comment">{- COMPOSE A FUNCTION CLOSURE TO COMPARE TAG VALUES -}</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="hs-keyword">newtype</span><span> </span><span id="F"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-var">F</span></a></span></span><span> </span><span id="local-6989586621679093700"><span class="annot"><a href="#local-6989586621679093700"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="F"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-var">F</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093700"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093700"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span class="hs-keyword">type</span><span> </span><span id="C"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#C"><span class="hs-identifier hs-var">C</span></a></span></span><span> </span><span id="local-6989586621679093236"><span class="annot"><a href="#local-6989586621679093236"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span>
</span><span id="line-533"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093236"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Orbits"><span class="hs-identifier hs-type">Orbits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093236"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Orbits"><span class="hs-identifier hs-type">Orbits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-537"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093236"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#orderOf"><span class="hs-pragma hs-type">orderOf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-540"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#orderOf"><span class="hs-identifier hs-type">orderOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-541"></span><span id="orderOf"><span class="annot"><span class="annottext">orderOf :: Action -&gt; Action -&gt; Ordering
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#orderOf"><span class="hs-identifier hs-var hs-var">orderOf</span></a></span></span><span> </span><span id="local-6989586621679093234"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093234"><span class="hs-identifier hs-var">post1</span></a></span></span><span> </span><span id="local-6989586621679093233"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093233"><span class="hs-identifier hs-var">post2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093234"><span class="hs-identifier hs-var">post1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093233"><span class="hs-identifier hs-var">post2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679093232"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093232"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679093231"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093231"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093232"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093231"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><span class="annottext">(Action, Action)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Ordering
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Ordering) -&gt; String -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bestTrans.compareWith.choose sees incomparable &quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="annot"><span class="annottext">(Action, Action) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093234"><span class="hs-identifier hs-var">post1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093233"><span class="hs-identifier hs-var">post2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#ditzyComp%273"><span class="hs-identifier hs-type">ditzyComp'3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679093901"><span class="annot"><a href="#local-6989586621679093901"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OP"><span class="hs-identifier hs-type">OP</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093901"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-551"></span><span id="ditzyComp%273"><span class="annot"><span class="annottext">ditzyComp'3 :: Array Int OP -&gt; C s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#ditzyComp%273"><span class="hs-identifier hs-var hs-var">ditzyComp'3</span></a></span></span><span> </span><span id="local-6989586621679093230"><span class="annot"><span class="annottext">Array Int OP
</span><a href="#local-6989586621679093230"><span class="hs-identifier hs-var">aTagOP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">C s
forall s. C s
</span><a href="#local-6989586621679093229"><span class="hs-identifier hs-var">comp0</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span id="local-6989586621679093228"><span class="annot"><span class="annottext">[F s] -&gt; C s
</span><a href="#local-6989586621679093228"><span class="hs-identifier hs-var">comp1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093227"><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093227"><span class="hs-identifier hs-var">compsRest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [F s]
forall s. Int -&gt; [F s]
</span><a href="#local-6989586621679093226"><span class="hs-identifier hs-var">allcomps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621679093225"><span class="annot"><a href="#local-6989586621679093229"><span class="hs-identifier hs-type">comp0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093225"><span class="hs-identifier hs-type">s</span></a></span></span><span>
</span><span id="line-555"></span><span>  </span><span id="local-6989586621679093229"><span class="annot"><span class="annottext">comp0 :: C s
</span><a href="#local-6989586621679093229"><span class="hs-identifier hs-var hs-var">comp0</span></a></span></span><span> </span><span id="local-6989586621679093224"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093224"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093223"><span class="annot"><span class="annottext">x1 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093223"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093222"><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093222"><span class="hs-identifier hs-var">_state1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093221"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093221"><span class="hs-identifier hs-var">pos1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093220"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093220"><span class="hs-identifier hs-var">_orbit1'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093219"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093219"><span class="hs-identifier hs-var">np1</span></a></span></span><span> </span><span id="local-6989586621679093218"><span class="annot"><span class="annottext">x2 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093218"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093217"><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093217"><span class="hs-identifier hs-var">_state2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093216"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093216"><span class="hs-identifier hs-var">pos2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093215"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093215"><span class="hs-identifier hs-var">_orbit2'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093214"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093214"><span class="hs-identifier hs-var">np2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621679093213"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093213"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Ordering) -&gt; ST s Int -&gt; ST s Int -&gt; ST s Ordering
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093216"><span class="hs-identifier hs-var">pos2</span></a></span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093221"><span class="hs-identifier hs-var">pos1</span></a></span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- reversed since Minimize</span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093213"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-558"></span><span>      </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[F s] -&gt; C s
forall s. [F s] -&gt; C s
</span><a href="#local-6989586621679093228"><span class="hs-identifier hs-var">comp1</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
forall s. [F s]
</span><a href="#local-6989586621679093227"><span class="hs-identifier hs-var">compsRest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093224"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093223"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093219"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093218"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093214"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-559"></span><span>      </span><span id="local-6989586621679093212"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093212"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093212"><span class="hs-identifier hs-var">answer</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>  </span><span id="local-6989586621679093707"><span class="annot"><a href="#local-6989586621679093226"><span class="hs-identifier hs-type">allcomps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093707"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621679093226"><span class="annot"><span class="annottext">allcomps :: Int -&gt; [F s]
</span><a href="#local-6989586621679093226"><span class="hs-identifier hs-var hs-var">allcomps</span></a></span></span><span> </span><span id="local-6989586621679093211"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093210"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">([F s] -&gt; C s) -&gt; F s
forall s. ([F s] -&gt; C s) -&gt; F s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-var">F</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[F s]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-563"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Array Int OP
</span><a href="#local-6989586621679093230"><span class="hs-identifier hs-var">aTagOP</span></a></span><span> </span><span class="annot"><span class="annottext">Array Int OP -&gt; Int -&gt; OP
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-565"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Orbit"><span class="hs-identifier hs-var">Orbit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([F s] -&gt; C s) -&gt; F s
forall s. ([F s] -&gt; C s) -&gt; F s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-var">F</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [F s] -&gt; C s
forall s.
Int
-&gt; [F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093209"><span class="hs-identifier hs-var">challenge_Orb</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">F s -&gt; [F s] -&gt; [F s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [F s]
forall s. Int -&gt; [F s]
</span><a href="#local-6989586621679093226"><span class="hs-identifier hs-var">allcomps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Maximize"><span class="hs-identifier hs-var">Maximize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([F s] -&gt; C s) -&gt; F s
forall s. ([F s] -&gt; C s) -&gt; F s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-var">F</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [F s] -&gt; C s
forall s.
Int
-&gt; [F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093207"><span class="hs-identifier hs-var">challenge_Max</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">F s -&gt; [F s] -&gt; [F s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [F s]
forall s. Int -&gt; [F s]
</span><a href="#local-6989586621679093226"><span class="hs-identifier hs-var">allcomps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Ignore"><span class="hs-identifier hs-var">Ignore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([F s] -&gt; C s) -&gt; F s
forall s. ([F s] -&gt; C s) -&gt; F s
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-var">F</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [F s] -&gt; C s
forall s.
Int
-&gt; [F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093205"><span class="hs-identifier hs-var">challenge_Ignore</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">F s -&gt; [F s] -&gt; [F s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [F s]
forall s. Int -&gt; [F s]
</span><a href="#local-6989586621679093226"><span class="hs-identifier hs-var">allcomps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093211"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>      </span><span class="annot"><span class="annottext">OP
</span><a href="Text.Regex.TDFA.Common.html#Minimize"><span class="hs-identifier hs-var">Minimize</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [F s]
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;allcomps Minimize&quot;</span></span><span>
</span><span id="line-569"></span><span>   </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679093210"><span class="annot"><span class="annottext">top :: Int
</span><a href="#local-6989586621679093210"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int OP -&gt; (Int, Int)
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Array Int OP
</span><a href="#local-6989586621679093230"><span class="hs-identifier hs-var">aTagOP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>  </span><span id="local-6989586621679093205"><span class="annot"><span class="annottext">challenge_Ignore :: Int
-&gt; [F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093205"><span class="hs-identifier hs-var hs-var">challenge_Ignore</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679093203"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093203"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span id="local-6989586621679093202"><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093202"><span class="hs-identifier hs-var">next</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093201"><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093201"><span class="hs-identifier hs-var">comps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093200"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093200"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093199"><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093199"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621679093198"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093198"><span class="hs-identifier hs-var">np1</span></a></span></span><span> </span><span id="local-6989586621679093197"><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093197"><span class="hs-identifier hs-var">x2</span></a></span></span><span> </span><span id="local-6989586621679093196"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093196"><span class="hs-identifier hs-var">np2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093198"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093195"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093195"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093194"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093194"><span class="hs-identifier hs-var">rest1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093195"><span class="hs-identifier hs-var">t1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093203"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093196"><span class="hs-identifier hs-var">np2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-575"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093193"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093193"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093192"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093192"><span class="hs-identifier hs-var">rest2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093193"><span class="hs-identifier hs-var">t2</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093203"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093202"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093201"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093200"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093199"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093194"><span class="hs-identifier hs-var">rest1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093197"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093192"><span class="hs-identifier hs-var">rest2</span></a></span><span>
</span><span id="line-576"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093202"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093201"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093200"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093199"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093194"><span class="hs-identifier hs-var">rest1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093197"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093196"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093196"><span class="hs-identifier hs-var">np2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-579"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093191"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093191"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093190"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093190"><span class="hs-identifier hs-var">rest2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093191"><span class="hs-identifier hs-var">t2</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093203"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093202"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093201"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093200"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093199"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093198"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093197"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093190"><span class="hs-identifier hs-var">rest2</span></a></span><span>
</span><span id="line-580"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093202"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093201"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093200"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093199"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093198"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093197"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093196"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><a href="#local-6989586621679093205"><span class="hs-identifier hs-var">challenge_Ignore</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ST s Ordering
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible 2347867&quot;</span></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>  </span><span id="local-6989586621679093207"><span class="annot"><span class="annottext">challenge_Max :: Int
-&gt; [F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093207"><span class="hs-identifier hs-var hs-var">challenge_Max</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679093189"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span id="local-6989586621679093188"><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093188"><span class="hs-identifier hs-var">next</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093187"><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093187"><span class="hs-identifier hs-var">comps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093186"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093185"><span class="annot"><span class="annottext">x1 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093185"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093184"><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093184"><span class="hs-identifier hs-var">_state1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093183"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093183"><span class="hs-identifier hs-var">pos1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093182"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093182"><span class="hs-identifier hs-var">_orbit1'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093181"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093181"><span class="hs-identifier hs-var">np1</span></a></span></span><span> </span><span id="local-6989586621679093180"><span class="annot"><span class="annottext">x2 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093180"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093179"><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093179"><span class="hs-identifier hs-var">_state2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093178"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093178"><span class="hs-identifier hs-var">pos2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093177"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093177"><span class="hs-identifier hs-var">_orbit2'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093176"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093176"><span class="hs-identifier hs-var">np2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-584"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093181"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093175"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093175"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093174"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093174"><span class="hs-identifier hs-var">b1</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093173"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093173"><span class="hs-identifier hs-var">rest1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093175"><span class="hs-identifier hs-var">t1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093176"><span class="hs-identifier hs-var">np2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-587"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093172"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093172"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093171"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093171"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093170"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093170"><span class="hs-identifier hs-var">rest2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093172"><span class="hs-identifier hs-var">t2</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-588"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093174"><span class="hs-identifier hs-var">b1</span></a></span><span class="annot"><span class="annottext">Action -&gt; Action -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093171"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093188"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093187"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093185"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093173"><span class="hs-identifier hs-var">rest1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093180"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093170"><span class="hs-identifier hs-var">rest2</span></a></span><span>
</span><span id="line-589"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action -&gt; Action -&gt; Ordering
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#orderOf"><span class="hs-identifier hs-var">orderOf</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093174"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093171"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>            </span><span id="local-6989586621679093169"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093169"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093178"><span class="hs-identifier hs-var">pos2</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-592"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093168"><span class="annot"><span class="annottext">p1 :: Int
</span><a href="#local-6989586621679093168"><span class="hs-identifier hs-var hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093174"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-593"></span><span>                                </span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-594"></span><span>                                </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679093167"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093167"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093167"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-595"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093168"><span class="hs-identifier hs-var">p1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093169"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093188"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093187"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093185"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093173"><span class="hs-identifier hs-var">rest1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093180"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093176"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-596"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093168"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093169"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>      </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-598"></span><span>        </span><span id="local-6989586621679093166"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093166"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093183"><span class="hs-identifier hs-var">pos1</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093176"><span class="hs-identifier hs-var">np2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-600"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093165"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093165"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093164"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093164"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093163"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093163"><span class="hs-identifier hs-var">rest2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093165"><span class="hs-identifier hs-var">t2</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-601"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093162"><span class="annot"><span class="annottext">p2 :: Int
</span><a href="#local-6989586621679093162"><span class="hs-identifier hs-var hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679093164"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPre"><span class="hs-identifier hs-var">SetPre</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-602"></span><span>                                </span><span class="annot"><span class="annottext">Action
</span><a href="Text.Regex.TDFA.Common.html#SetPost"><span class="hs-identifier hs-var">SetPost</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span>
</span><span id="line-603"></span><span>                                </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#SetVal"><span class="hs-identifier hs-type">SetVal</span></a></span><span> </span><span id="local-6989586621679093161"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093161"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093161"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-604"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093166"><span class="hs-identifier hs-var">p1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093162"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093188"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093187"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093185"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093181"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093180"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093163"><span class="hs-identifier hs-var">rest2</span></a></span><span>
</span><span id="line-605"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093166"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093162"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-607"></span><span>            </span><span id="local-6989586621679093160"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093160"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093178"><span class="hs-identifier hs-var">pos2</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093189"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-608"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093166"><span class="hs-identifier hs-var">p1</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093160"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093188"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093187"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093186"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093185"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093181"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093180"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093176"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-609"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093166"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093160"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><a href="#local-6989586621679093207"><span class="hs-identifier hs-var">challenge_Max</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ST s Ordering
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible 9384324&quot;</span></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>  </span><span id="local-6989586621679093209"><span class="annot"><span class="annottext">challenge_Orb :: Int
-&gt; [F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093209"><span class="hs-identifier hs-var hs-var">challenge_Orb</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679093159"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093159"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span id="local-6989586621679093158"><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093158"><span class="hs-identifier hs-var">next</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093157"><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093157"><span class="hs-identifier hs-var">comps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093156"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093156"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093155"><span class="annot"><span class="annottext">x1 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093155"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093154"><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093154"><span class="hs-identifier hs-var">_state1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093153"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093153"><span class="hs-identifier hs-var">_pos1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093152"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093152"><span class="hs-identifier hs-var">orbit1'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093151"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093151"><span class="hs-identifier hs-var">np1</span></a></span></span><span> </span><span id="local-6989586621679093150"><span class="annot"><span class="annottext">x2 :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093150"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679093149"><span class="annot"><span class="annottext">(Int, Instructions)
</span><a href="#local-6989586621679093149"><span class="hs-identifier hs-var">_state2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093148"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093148"><span class="hs-identifier hs-var">_pos2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093147"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093147"><span class="hs-identifier hs-var">orbit2'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093146"><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093146"><span class="hs-identifier hs-var">np2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093145"><span class="annot"><span class="annottext">s1 :: Maybe Orbits
</span><a href="#local-6989586621679093145"><span class="hs-identifier hs-var hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; Maybe Orbits
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093159"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093152"><span class="hs-identifier hs-var">orbit1'</span></a></span><span>
</span><span id="line-614"></span><span>        </span><span id="local-6989586621679093144"><span class="annot"><span class="annottext">s2 :: Maybe Orbits
</span><a href="#local-6989586621679093144"><span class="hs-identifier hs-var hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; OrbitLog -&gt; Maybe Orbits
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093159"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093147"><span class="hs-identifier hs-var">orbit2'</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Orbits
</span><a href="#local-6989586621679093145"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Orbits
</span><a href="#local-6989586621679093144"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-616"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Orbits
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe Orbits
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093158"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093157"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093156"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093155"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093151"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093150"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093146"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-617"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679093143"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093143"><span class="hs-identifier hs-var">o1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679093142"><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093142"><span class="hs-identifier hs-var">o2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var hs-var">inOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093143"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Orbits -&gt; Bool
</span><a href="Text.Regex.TDFA.Common.html#inOrbit"><span class="hs-identifier hs-var hs-var">inOrbit</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093142"><span class="hs-identifier hs-var">o2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-618"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Maybe Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var hs-var">ordinal</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093143"><span class="hs-identifier hs-var">o1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Maybe Int
</span><a href="Text.Regex.TDFA.Common.html#ordinal"><span class="hs-identifier hs-var hs-var">ordinal</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093142"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-619"></span><span>                 </span><span class="annot"><span class="annottext">ViewL Int -&gt; ViewL Int -&gt; Ordering
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var">comparePos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Int -&gt; ViewL Int
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">viewl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093143"><span class="hs-identifier hs-var">o1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Int -&gt; ViewL Int
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">viewl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Orbits -&gt; Seq Int
</span><a href="Text.Regex.TDFA.Common.html#getOrbits"><span class="hs-identifier hs-var hs-var">getOrbits</span></a></span><span> </span><span class="annot"><span class="annottext">Orbits
</span><a href="#local-6989586621679093142"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-620"></span><span>              </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[F s]
-&gt; Int
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; [(Int, Action)]
-&gt; ST s Ordering
</span><a href="#local-6989586621679093158"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[F s]
</span><a href="#local-6989586621679093157"><span class="hs-identifier hs-var">comps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093156"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093155"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093151"><span class="hs-identifier hs-var">np1</span></a></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><a href="#local-6989586621679093150"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093146"><span class="hs-identifier hs-var">np2</span></a></span><span>
</span><span id="line-621"></span><span>              </span><span id="local-6989586621679093141"><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093141"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; ST s Ordering
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679093141"><span class="hs-identifier hs-var">answer</span></a></span><span>
</span><span id="line-622"></span><span>         </span><span class="annot"><span class="annottext">(Maybe Orbits, Maybe Orbits)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ST s Ordering
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ST s Ordering) -&gt; String -&gt; ST s Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;challenge_Orb is too stupid to handle mismatched orbit data :&quot;</span></span><span>
</span><span id="line-623"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int, [(Int, Action)], [(Int, Action)]) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093159"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093156"><span class="hs-identifier hs-var">preTag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093151"><span class="hs-identifier hs-var">np1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Int, Action)]
</span><a href="#local-6989586621679093146"><span class="hs-identifier hs-var">np2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Orbits -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe Orbits
</span><a href="#local-6989586621679093145"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-625"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Orbits -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe Orbits
</span><a href="#local-6989586621679093144"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-626"></span><span>                           </span><span class="hs-special">]</span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><a href="#local-6989586621679093209"><span class="hs-identifier hs-var">challenge_Orb</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">((Int, Instructions), STUArray s Int Int, OrbitLog)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ST s Ordering
forall a. String -&gt; a
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#err"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible 0298347&quot;</span></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-type">comparePos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ViewL</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ViewL</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-630"></span><span id="comparePos"><span class="annot"><span class="annottext">comparePos :: ViewL Int -&gt; ViewL Int -&gt; Ordering
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var hs-var">comparePos</span></a></span></span><span> </span><span class="annot"><span class="annottext">ViewL Int
</span><span class="hs-identifier hs-var">EmptyL</span></span><span> </span><span class="annot"><span class="annottext">ViewL Int
</span><span class="hs-identifier hs-var">EmptyL</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-631"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var">comparePos</span></a></span><span> </span><span class="annot"><span class="annottext">ViewL Int
</span><span class="hs-identifier hs-var">EmptyL</span></span><span> </span><span class="annot"><span class="annottext">ViewL Int
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-632"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var">comparePos</span></a></span><span> </span><span class="annot"><span class="annottext">ViewL Int
</span><span class="hs-identifier">_</span></span><span>      </span><span class="annot"><span class="annottext">ViewL Int
</span><span class="hs-identifier hs-var">EmptyL</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-633"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var">comparePos</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093138"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093138"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;</span></span><span> </span><span id="local-6989586621679093136"><span class="annot"><span class="annottext">Seq Int
</span><a href="#local-6989586621679093136"><span class="hs-identifier hs-var">ps1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679093135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093135"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;</span></span><span> </span><span id="local-6989586621679093134"><span class="annot"><span class="annottext">Seq Int
</span><a href="#local-6989586621679093134"><span class="hs-identifier hs-var">ps2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-634"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093138"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093135"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Ordering
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">ViewL Int -&gt; ViewL Int -&gt; Ordering
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#comparePos"><span class="hs-identifier hs-var">comparePos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Int -&gt; ViewL Int
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">viewl</span></span><span> </span><span class="annot"><span class="annottext">Seq Int
</span><a href="#local-6989586621679093136"><span class="hs-identifier hs-var">ps1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq Int -&gt; ViewL Int
forall a. Seq a -&gt; ViewL a
</span><span class="hs-identifier hs-var">viewl</span></span><span> </span><span class="annot"><span class="annottext">Seq Int
</span><a href="#local-6989586621679093134"><span class="hs-identifier hs-var">ps2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="hs-comment">{- CONVERT WINNERS TO MATCHARRAY -}</span><span>
</span><span id="line-637"></span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#tagsToGroupsST"><span class="hs-identifier hs-type">tagsToGroupsST</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679093769"><span class="annot"><a href="#local-6989586621679093769"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupIndex"><span class="hs-identifier hs-type">GroupIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-type">WScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093769"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093769"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MatchArray</span></span><span>
</span><span id="line-638"></span><span id="tagsToGroupsST"><span class="annot"><span class="annottext">tagsToGroupsST :: Array Int [GroupInfo] -&gt; WScratch s -&gt; ST s MatchArray
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#tagsToGroupsST"><span class="hs-identifier hs-var hs-var">tagsToGroupsST</span></a></span></span><span> </span><span id="local-6989586621679093132"><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093132"><span class="hs-identifier hs-var">aGroups</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#WScratch"><span class="hs-identifier hs-type">WScratch</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">w_pos :: forall s. WScratch s -&gt; STUArray s Int Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#w_pos"><span class="hs-identifier hs-var">w_pos</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679093131"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093131"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093130"><span class="annot"><span class="annottext">b_max :: Int
</span><a href="#local-6989586621679093130"><span class="hs-identifier hs-var hs-var">b_max</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int [GroupInfo] -&gt; (Int, Int)
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093132"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>  </span><span id="local-6989586621679093129"><span class="annot"><span class="annottext">STArray s Int (Int, Int)
</span><a href="#local-6989586621679093129"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span id="local-6989586621679093128"><span class="annot"><span class="annottext">(Int, Int) -&gt; (Int, Int) -&gt; ST s (STArray s Int (Int, Int))
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
(i, i) -&gt; e -&gt; m (a i e)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093130"><span class="hs-identifier hs-var">b_max</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093128"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093128"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MatchOffset</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">MatchLength</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-641"></span><span>  </span><span id="local-6989586621679093127"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093127"><span class="hs-identifier hs-var">startPos0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093131"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-642"></span><span>  </span><span id="local-6989586621679093126"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093126"><span class="hs-identifier hs-var">stopPos0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093131"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><span class="annottext">STArray s Int (Int, Int) -&gt; Int -&gt; (Int, Int) -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Int, Int)
</span><a href="#local-6989586621679093129"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093127"><span class="hs-identifier hs-var">startPos0</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093126"><span class="hs-identifier hs-var">stopPos0</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093127"><span class="hs-identifier hs-var">startPos0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093125"><span class="annot"><span class="annottext">act :: Int -&gt; [GroupInfo] -&gt; ST s ()
</span><a href="#local-6989586621679093125"><span class="hs-identifier hs-var hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679093124"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093124"><span class="hs-identifier hs-var">_this_index</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ST s ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>      </span><span class="annot"><a href="#local-6989586621679093125"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span id="local-6989586621679093123"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093123"><span class="hs-identifier hs-var">this_index</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#GroupInfo"><span class="hs-identifier hs-type">GroupInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679093121"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093121"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621679093120"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093120"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679093119"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093119"><span class="hs-identifier hs-var">stop</span></a></span></span><span> </span><span id="local-6989586621679093118"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093118"><span class="hs-identifier hs-var">flagtag</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679093117"><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679093117"><span class="hs-identifier hs-var">gs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-646"></span><span>        </span><span id="local-6989586621679093116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093116"><span class="hs-identifier hs-var">flagVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093131"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093118"><span class="hs-identifier hs-var">flagtag</span></a></span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093116"><span class="hs-identifier hs-var">flagVal</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [GroupInfo] -&gt; ST s ()
</span><a href="#local-6989586621679093125"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093123"><span class="hs-identifier hs-var">this_index</span></a></span><span> </span><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679093117"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-648"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>        </span><span id="local-6989586621679093115"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093115"><span class="hs-identifier hs-var">startPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093131"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093120"><span class="hs-identifier hs-var">start</span></a></span><span>
</span><span id="line-650"></span><span>        </span><span id="local-6989586621679093114"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093114"><span class="hs-identifier hs-var">stopPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093131"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093119"><span class="hs-identifier hs-var">stop</span></a></span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679093113"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093113"><span class="hs-identifier hs-var">startParent</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093112"><span class="hs-identifier hs-var">lengthParent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STArray s Int (Int, Int)
</span><a href="#local-6989586621679093129"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Int, Int) -&gt; Int -&gt; ST s (Int, Int)
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093121"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-652"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679093111"><span class="annot"><span class="annottext">ok :: Bool
</span><a href="#local-6989586621679093111"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093113"><span class="hs-identifier hs-var">startParent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-653"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093112"><span class="hs-identifier hs-var">lengthParent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-654"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093113"><span class="hs-identifier hs-var">startParent</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093115"><span class="hs-identifier hs-var">startPos</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-655"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093114"><span class="hs-identifier hs-var">stopPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093115"><span class="hs-identifier hs-var">startPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093112"><span class="hs-identifier hs-var">lengthParent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679093111"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [GroupInfo] -&gt; ST s ()
</span><a href="#local-6989586621679093125"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093123"><span class="hs-identifier hs-var">this_index</span></a></span><span> </span><span class="annot"><span class="annottext">[GroupInfo]
</span><a href="#local-6989586621679093117"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-657"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">STArray s Int (Int, Int) -&gt; Int -&gt; (Int, Int) -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Int, Int)
</span><a href="#local-6989586621679093129"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093123"><span class="hs-identifier hs-var">this_index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093115"><span class="hs-identifier hs-var">startPos</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093114"><span class="hs-identifier hs-var">stopPos</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093115"><span class="hs-identifier hs-var">startPos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; [Int]
forall a. Ix a =&gt; (a, a) -&gt; [a]
</span><span class="hs-identifier hs-var">range</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093130"><span class="hs-identifier hs-var">b_max</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ST s ()) -&gt; ST s ()) -&gt; (Int -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679093109"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093109"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [GroupInfo] -&gt; ST s ()
forall s.
(MArray (STUArray s) Int (ST s),
 MArray (STArray s) (Int, Int) (ST s)) =&gt;
Int -&gt; [GroupInfo] -&gt; ST s ()
</span><a href="#local-6989586621679093125"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093109"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Int [GroupInfo]
</span><a href="#local-6989586621679093132"><span class="hs-identifier hs-var">aGroups</span></a></span><span class="annot"><span class="annottext">Array Int [GroupInfo] -&gt; Int -&gt; [GroupInfo]
forall (a :: * -&gt; * -&gt; *) e i.
(IArray a e, Ix i) =&gt;
a i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093109"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>  </span><span class="annot"><span class="annottext">STArray s Int (Int, Int) -&gt; ST s MatchArray
forall i (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) (b :: * -&gt; * -&gt; *).
(Ix i, MArray a e m, IArray b e) =&gt;
a i e -&gt; m (b i e)
</span><span class="hs-identifier hs-var">unsafeFreeze</span></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Int, Int)
</span><a href="#local-6989586621679093129"><span class="hs-identifier hs-var">ma</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-comment">{- MUTABLE TAGGED TRANSITION (returning Tag-0 value) -}</span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#spawnStart"><span class="hs-pragma hs-type">spawnStart</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-664"></span><span class="hs-comment">-- Reset the entry at &quot;Index&quot;, or allocate such an entry.</span><span>
</span><span id="line-665"></span><span class="hs-comment">-- set tag 0 to the &quot;Position&quot;</span><span>
</span><span id="line-666"></span><span id="local-6989586621679093866"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#spawnStart"><span class="hs-identifier hs-type">spawnStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#BlankScratch"><span class="hs-identifier hs-type">BlankScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093866"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-type">MScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093866"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093866"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span></span><span>
</span><span id="line-667"></span><span id="spawnStart"><span class="annot"><span class="annottext">spawnStart :: (Int, Int)
-&gt; BlankScratch s -&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#spawnStart"><span class="hs-identifier hs-var hs-var">spawnStart</span></a></span></span><span> </span><span id="local-6989586621679093108"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093108"><span class="hs-identifier hs-var">b_tags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#BlankScratch"><span class="hs-identifier hs-type">BlankScratch</span></a></span><span> </span><span id="local-6989586621679093107"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093107"><span class="hs-identifier hs-var">blankPos</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093106"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093106"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679093105"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093105"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679093104"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093104"><span class="hs-identifier hs-var">thisPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>  </span><span id="local-6989586621679093103"><span class="annot"><span class="annottext">Maybe (STUArray s Int Int)
</span><a href="#local-6989586621679093103"><span class="hs-identifier hs-var">oldPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093105"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; ST s (Maybe (STUArray s Int Int))
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093106"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span id="local-6989586621679093102"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093102"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (STUArray s Int Int)
</span><a href="#local-6989586621679093103"><span class="hs-identifier hs-var">oldPos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-670"></span><span>           </span><span class="annot"><span class="annottext">Maybe (STUArray s Int Int)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>             </span><span id="local-6989586621679093101"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093101"><span class="hs-identifier hs-var">pos'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (STUArray s Int Int)
forall s e.
MArray (STUArray s) e (ST s) =&gt;
(Int, Int) -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-identifier hs-var">newA_</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093108"><span class="hs-identifier hs-var">b_tags</span></a></span><span>
</span><span id="line-672"></span><span>             </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; Maybe (STUArray s Int Int) -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093105"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093106"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Maybe (STUArray s Int Int)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093101"><span class="hs-identifier hs-var">pos'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>             </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093101"><span class="hs-identifier hs-var">pos'</span></a></span><span>
</span><span id="line-674"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679093100"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093100"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093100"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; STUArray s Int Int -&gt; ST s ()
forall i s e.
(Show i, Ix i, MArray (STUArray s) e (ST s)) =&gt;
STUArray s i e -&gt; STUArray s i e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-identifier hs-var">copySTU</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093107"><span class="hs-identifier hs-var">blankPos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093102"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; OrbitLog -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093105"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093106"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(OrbitLog -&gt; ST s ()) -&gt; OrbitLog -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">OrbitLog
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; Int -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093102"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093104"><span class="hs-identifier hs-var">thisPos</span></a></span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; ST s Int
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093104"><span class="hs-identifier hs-var">thisPos</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#updateCopy"><span class="hs-pragma hs-type">updateCopy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-681"></span><span id="local-6989586621679093776"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#updateCopy"><span class="hs-identifier hs-type">updateCopy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Instructions"><span class="hs-identifier hs-type">Instructions</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093776"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#OrbitLog"><span class="hs-identifier hs-type">OrbitLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span>
</span><span id="line-683"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#MScratch"><span class="hs-identifier hs-type">MScratch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093776"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-684"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-685"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093776"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Text.Regex.TDFA.Common.html#Position"><span class="hs-identifier hs-type">Position</span></a></span></span><span>
</span><span id="line-686"></span><span id="updateCopy"><span class="annot"><span class="annottext">updateCopy :: ((Int, Instructions), STUArray s Int Int, OrbitLog)
-&gt; Int -&gt; MScratch s -&gt; Int -&gt; ST s Int
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#updateCopy"><span class="hs-identifier hs-var hs-var">updateCopy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679093099"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093099"><span class="hs-identifier hs-var">_i1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093098"><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093098"><span class="hs-identifier hs-var">instructions</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679093097"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093097"><span class="hs-identifier hs-var">oldPos</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679093096"><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093096"><span class="hs-identifier hs-var">newOrbit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093095"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093095"><span class="hs-identifier hs-var">preTag</span></a></span></span><span> </span><span id="local-6989586621679093094"><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093094"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621679093093"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093093"><span class="hs-identifier hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-687"></span><span>  </span><span id="local-6989586621679093092"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093092"><span class="hs-identifier hs-var">b_tags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (Int, Int)
forall (a :: * -&gt; * -&gt; *) e (m :: * -&gt; *) i.
(MArray a e m, Ix i) =&gt;
a i e -&gt; m (i, i)
</span><span class="hs-identifier hs-var">getBounds</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093097"><span class="hs-identifier hs-var">oldPos</span></a></span><span>
</span><span id="line-688"></span><span>  </span><span id="local-6989586621679093090"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093090"><span class="hs-identifier hs-var">newerPos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ST s (STUArray s Int Int)
-&gt; (STUArray s Int Int -&gt; ST s (STUArray s Int Int))
-&gt; Maybe (STUArray s Int Int)
-&gt; ST s (STUArray s Int Int)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><span id="line-689"></span><span>    </span><span id="local-6989586621679093089"><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093089"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ST s (STUArray s Int Int)
forall s e.
MArray (STUArray s) e (ST s) =&gt;
(Int, Int) -&gt; ST s (STUArray s Int e)
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#newA_"><span class="hs-identifier hs-var">newA_</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679093092"><span class="hs-identifier hs-var">b_tags</span></a></span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; Maybe (STUArray s Int Int) -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093094"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093093"><span class="hs-identifier hs-var">i2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Maybe (STUArray s Int Int)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093089"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093089"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (STUArray s Int Int) -&gt; ST s (STUArray s Int Int))
-&gt; ST s (Maybe (STUArray s Int Int)) -&gt; ST s (STUArray s Int Int)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
forall s. MScratch s -&gt; STArray s Int (Maybe (STUArray s Int Int))
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_pos"><span class="hs-identifier hs-var hs-var">m_pos</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093094"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">STArray s Int (Maybe (STUArray s Int Int))
-&gt; Int -&gt; ST s (Maybe (STUArray s Int Int))
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093093"><span class="hs-identifier hs-var">i2</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; STUArray s Int Int -&gt; ST s ()
forall i s e.
(Show i, Ix i, MArray (STUArray s) e (ST s)) =&gt;
STUArray s i e -&gt; STUArray s i e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-identifier hs-var">copySTU</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093097"><span class="hs-identifier hs-var">oldPos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093090"><span class="hs-identifier hs-var">newerPos</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
forall s. Int -&gt; STUArray s Int Int -&gt; [(Int, Action)] -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#doActions"><span class="hs-identifier hs-var">doActions</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093095"><span class="hs-identifier hs-var">preTag</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093090"><span class="hs-identifier hs-var">newerPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instructions -&gt; [(Int, Action)]
</span><a href="Text.Regex.TDFA.Common.html#newPos"><span class="hs-identifier hs-var hs-var">newPos</span></a></span><span> </span><span class="annot"><span class="annottext">Instructions
</span><a href="#local-6989586621679093098"><span class="hs-identifier hs-var">instructions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>  </span><span class="annot"><span class="annottext">STArray s Int OrbitLog -&gt; Int -&gt; OrbitLog -&gt; ST s ()
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MScratch s -&gt; STArray s Int OrbitLog
forall s. MScratch s -&gt; STArray s Int OrbitLog
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#m_orbit"><span class="hs-identifier hs-var hs-var">m_orbit</span></a></span><span> </span><span class="annot"><span class="annottext">MScratch s
</span><a href="#local-6989586621679093094"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679093093"><span class="hs-identifier hs-var">i2</span></a></span><span> </span><span class="annot"><span class="annottext">(OrbitLog -&gt; ST s ()) -&gt; OrbitLog -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">OrbitLog
</span><a href="#local-6989586621679093096"><span class="hs-identifier hs-var">newOrbit</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><span class="annottext">STUArray s Int Int
</span><a href="#local-6989586621679093090"><span class="hs-identifier hs-var">newerPos</span></a></span><span> </span><span class="annot"><span class="annottext">STUArray s Int Int -&gt; Int -&gt; ST s Int
forall (a :: * -&gt; * -&gt; *) e s i.
(MArray a e (ST s), Ix i) =&gt;
a i e -&gt; Int -&gt; ST s e
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="hs-comment">{- USING memcpy TO COPY STUARRAY DATA -}</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="hs-comment">-- #ifdef __GLASGOW_HASKELL__</span><span>
</span><span id="line-700"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;memcpy&quot;</span></span><span>
</span><span id="line-701"></span><span>    </span><span id="memcpy"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#memcpy"><span class="hs-identifier hs-var">memcpy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="hs-comment">{-
Prelude Data.Array.Base&gt; :i STUArray
data STUArray s i e
  = STUArray !i !i !Int (GHC.Prim.MutableByteArray# s)
  -- Defined in Data.Array.Base
-}</span><span>
</span><span id="line-709"></span><span class="hs-comment">-- This has been updated for ghc 6.8.3 and still works with ghc 6.10.1</span><span>
</span><span id="line-710"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-pragma hs-type">copySTU</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-711"></span><span id="local-6989586621679093753"><span id="local-6989586621679093754"><span id="local-6989586621679093755"><span class="annot"><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-identifier hs-type">copySTU</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679093755"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Ix</span></span><span> </span><span class="annot"><a href="#local-6989586621679093755"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">MArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093754"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679093753"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093754"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093755"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093753"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><a href="#local-6989586621679093754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093755"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679093753"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.ST</span></span><span> </span><span class="annot"><a href="#local-6989586621679093754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-comment">-- (STUArray s i e)</span><span>
</span><span id="line-712"></span><span id="copySTU"><span class="annot"><span class="annottext">copySTU :: STUArray s i e -&gt; STUArray s i e -&gt; ST s ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#copySTU"><span class="hs-identifier hs-var hs-var">copySTU</span></a></span></span><span> </span><span id="local-6989586621679093087"><span class="annot"><span class="annottext">_souce :: STUArray s i e
</span><a href="#local-6989586621679093087"><span class="hs-identifier hs-var">_souce</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><span class="annottext">i
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">i
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679093085"><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679093085"><span class="hs-identifier hs-var">msource</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679093084"><span class="annot"><span class="annottext">_destination :: STUArray s i e
</span><a href="#local-6989586621679093084"><span class="hs-identifier hs-var">_destination</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STUArray</span></span><span> </span><span class="annot"><span class="annottext">i
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">i
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679093083"><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679093083"><span class="hs-identifier hs-var">mdest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-713"></span><span class="hs-comment">-- do b1 &lt;- getBounds s1</span><span>
</span><span id="line-714"></span><span class="hs-comment">--  b2 &lt;- getBounds s2</span><span>
</span><span id="line-715"></span><span class="hs-comment">--  when (b1/=b2) (error (&quot;\n\nWTF copySTU: &quot;++show (b1,b2)))</span><span>
</span><span id="line-716"></span><span>  </span><span class="annot"><span class="annottext">STRep s () -&gt; ST s ()
forall s a. STRep s a -&gt; ST s a
</span><span class="hs-identifier hs-var">ST</span></span><span> </span><span class="annot"><span class="annottext">(STRep s () -&gt; ST s ()) -&gt; STRep s () -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679093081"><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679093081"><span class="hs-identifier hs-var">s1#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-717"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s -&gt; Int#
forall d. MutableByteArray# d -&gt; Int#
</span><span class="hs-identifier hs-var">sizeofMutableByteArray#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679093085"><span class="hs-identifier hs-var">msource</span></a></span><span>        </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679093080"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679093080"><span class="hs-identifier hs-var">n#</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-718"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(MutableByteArray# RealWorld
 -&gt; MutableByteArray# RealWorld -&gt; Int# -&gt; IO ())
-&gt; MutableByteArray# s -&gt; MutableByteArray# s -&gt; Int# -&gt; STRep s ()
</span><span class="hs-identifier hs-var">unsafeCoerce#</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
-&gt; MutableByteArray# RealWorld -&gt; Int# -&gt; IO ()
</span><a href="Text.Regex.TDFA.NewDFA.Engine.html#memcpy"><span class="hs-identifier hs-var">memcpy</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679093083"><span class="hs-identifier hs-var">mdest</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# s
</span><a href="#local-6989586621679093085"><span class="hs-identifier hs-var">msource</span></a></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621679093080"><span class="hs-identifier hs-var">n#</span></a></span><span> </span><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679093081"><span class="hs-identifier hs-var">s1#</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621679093079"><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679093079"><span class="hs-identifier hs-var">s2#</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-719"></span><span>    </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# s
</span><a href="#local-6989586621679093079"><span class="hs-identifier hs-var">s2#</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-720"></span><span class="hs-comment">{-
#else /* !__GLASGOW_HASKELL__ */

copySTU :: (MArray (STUArray s) e (S.ST s))=&gt; STUArray s Tag e -&gt; STUArray s Tag e -&gt; S.ST s (STUArray s i e)
copySTU source destination = do
  b@(start,stop) &lt;- getBounds source
  b' &lt;- getBounds destination
  -- traceCopy (&quot;&gt; copySTArray &quot;++show b) $ do
  when (b/=b') (fail $ &quot;Text.Regex.TDFA.RunMutState copySTUArray bounds mismatch&quot;++show (b,b'))
  forM_ (range b) $ \index -&gt;
    set destination index =&lt;&lt; source !! index
  return destination
#endif /* !__GLASGOW_HASKELL__ */
-}</span><span>
</span><span id="line-734"></span></pre></body></html>