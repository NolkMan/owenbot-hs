<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_HADDOCK show-extensions #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- for CommandHandlerType</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances, FunctionalDependencies, UndecidableInstances #-}</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- for Command</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- for runCommand</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-comment">{-|
Module      : Command.Command
License     : BSD (see the LICENSE file)
Description : Everything commands :)

Amateur attempt at command abstraction and polyvariadic magic.

Inspired heavily but calamity-commands, which is provided by Ben Simms 2020
under the MIT license. 

Ideally, this module wouldn't need to be touched after its initial creation
(and hence quite the jump in complex GHC extensions compared to other modules),
however it is documented quite extensively anyway.

__As an OwenDev, you do not need to enable any GHC extensions, as the__
__extensions are used internally within this module only__.

=== __Notable extensions used (if you want to know)__

    * ScopedTypeVariables: For using the same type variables in @where@
    statements as function declarations.
    * FlexibleInstances: To allow complex type variables in instance declarations,
    like @CommandHandlerType m (a -&gt; m ())@.
    [Read more]
    (https://ghc.gitlab.haskell.org/ghc/doc/users_guide/exts/instances.html#extension-FlexibleInstances)
    * FunctionalDependencies: To write that @m@ can be determined from @h@ in
    @CommandHandlerType@. It makes logical sense to tell GHC this because @h@ 
    must be in the @m@ monad (otherwise, @h@ may be in another monad).
    [Read more]
    (https://en.wikibooks.org/wiki/Haskell/Advanced_type_classes)
    * MultiParamTypeClasses: For declaring CommandHandlerType that has 2 params.
    This comes with FunctionalDependencies automatically, and is not explicitly
    used.
    * UndecidableInstances: Risky, but I think I logically checked over it. Used
    in the @m (a -&gt; b)@ instance declaration of 'CommandHandlerType', because
    @(a -&gt; b)@ doesn't explicitly determine the required functional dependency
    (@h -&gt; m@). The extension is risky because the type-checker can fail to
    terminate if the instance declarations recursively reference each other. In
    this module however, all instances strictly converges to the @m (m ())@
    instance so I say it is safe. [Read more]
    (https://www.reddit.com/r/haskell/comments/5zjwym/when_is_undecidableinstances_okay_to_use/)
    * NamedFieldPuns: Shorten pattern matching ADT field names.
    
Implementation references:

    * [Varargs - Haskell Wiki]
    (https://wiki.haskell.org/Varargs)
    * [Haskell-polyvariadic]
    (https://github.com/AJFarmar/haskell-polyvariadic)
    * [How to create a polyvariadic haskell function?]
    (https://stackoverflow.com/questions/3467279/how-to-create-a-polyvariadic-haskell-function)
    * [How to write a Haskell function that takes a variadic function as an argument]
    (https://stackoverflow.com/questions/8353845/how-to-write-a-haskell-function-that-takes-a-variadic-function-as-an-argument)

Design references:

    * [calamity-commands](https://github.com/simmsb/calamity/tree/master/calamity-commands)
-}</span><span>
</span><span id="line-67"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Command.Command</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Troubleshooting</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-comment">-- | See the [Common Errors](#commonerrors) section.</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="hs-comment">-- * The fundamentals</span></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">-- | These offer the core functionality for Commands. The most imporatnt</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- functions are 'command' and 'runCommand'.</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-comment">-- </span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">--     * 'command' creates a 'Command'</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">--     * 'runCommand' converts the 'Command' to a normal receiver.</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- If your command demands a special syntax that is impossible with the</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- existing 'command' function, use 'parsecCommand' (Parsec) or 'regexCommand'</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- (Regex).</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier">Command</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#command"><span class="hs-identifier">command</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#runCommand"><span class="hs-identifier">runCommand</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#runCommands"><span class="hs-identifier">runCommands</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#runHelp"><span class="hs-identifier">runHelp</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Custom command parsing</span></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Parsec and Regex options are available.</span></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#parsecCommand"><span class="hs-identifier">parsecCommand</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#regexCommand"><span class="hs-identifier">regexCommand</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Compsable Functions</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="hs-comment">-- | These can be composed onto 'command' to overwrite default functionality.</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#help"><span class="hs-identifier">help</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#alias"><span class="hs-identifier">alias</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#onError"><span class="hs-identifier">onError</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#defaultErrorHandler"><span class="hs-identifier">defaultErrorHandler</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#requires"><span class="hs-identifier">requires</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Errors</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Error.html#CommandError"><span class="hs-identifier">CommandError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Parsing arguments</span></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">-- | The 'ParsableArgument' is the core dataclass for command arguments that</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- can be parsed.</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- As an OwenDev, if you want to make your own datatype parsable, all you</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- have to do is to add an instance declaration for it (and a parser) inside</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- @Command/Parser.hs@. Parsec offers very very very useful functions that</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- you can simply compose together to create parsers.</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Parser.html#ParsableArgument"><span class="hs-identifier">ParsableArgument</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Parser.html#RemainingText"><span class="hs-identifier">RemainingText</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exported classes</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Here are the monad dataclasses exported from this module.</span></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** The MonadDiscord class</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- | MonadDiscord is the underlying Monad class for all interactions to the</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- Discord REST API. </span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">-- </span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-comment">-- This is a common way to design abstraction so you can mock them. Same as</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Java interfaces, C++ virtual functions. If you want to read more:</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-comment">--     * [Here is a link]</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-comment">-- (https://www.reddit.com/r/haskell/comments/5bnr6b/mocking_in_haskell/)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">--     * [Another link]</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">-- (https://lexi-lambda.github.io/blog/2017/06/29/unit-testing-effectful-haskell-with-monad-mock/)</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Discord.Internal.Monad.html"><span class="hs-identifier">Discord.Internal.Monad</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** MonadIO</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- | Exported solely for convenience purposes, since many modules that use</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">-- Commands require the MonadIO constraint, but it can get confusing where</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-comment">-- to import it from (UnliftIO or Control.Monad.IO.Class). The one exported</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">-- from this module is from &quot;Control.Monad.IO.Class&quot; which is in @base@.</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Common Errors #commonerrors#</span></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-comment">-- | Here are some common errors that can occur when defining commands.</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- They may appear cryptic, but they are most of the time dealable.</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- Could not deduce (ParsableArgument p0) arising from the use of \'command'.</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- The type variable 'p0' is ambiguous.</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">--     * The type for one of the arguments to your handler function cannot</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">--     be inferred. Make sure you use the argument, otherwise, just remove it.</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- Could not deduce (ParsableArgument SomeType) arising from the use of</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-comment">-- \'command'.</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-comment">--     * The type could be inferred as SomeType, but it's not an instance</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-comment">--     of ParsableArgument. Contribute your own parser in @Command/Parser.hs@.</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">-- Could not deduce (MonadIO m) arising from the use of \'liftIO'.</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">--     * Your handler requires IO actions, but you haven't given the</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">--     appropriate constraint. Add @(MonadIO m)@.</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">--     * Rationale: This happens because some handlers are pure and don't need IO -</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">--     it's better to explicitly signify which actions you're going to use</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">--     in the constraints than to add a catch-all constraint into the</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">--     definition of @MonadDiscord@.</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- </span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- If an error is super duper cryptic, it may be a bug in the Commands </span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- module itself, in which case we may need a rewrite.</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Alternative</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">liftA2</span></span><span>
</span><span id="line-167"></span><span>                                            </span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception.Safe</span></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">catch</span></span><span>
</span><span id="line-169"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwM</span></span><span>
</span><span id="line-170"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadCatch</span></span><span>
</span><span id="line-171"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadThrow</span></span><span>
</span><span id="line-172"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Exception</span></span><span>
</span><span id="line-173"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SomeException</span></span><span>
</span><span id="line-174"></span><span>                                            </span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">void</span></span><span>
</span><span id="line-177"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span>
</span><span id="line-178"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span>
</span><span id="line-179"></span><span>                                            </span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>                 </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Parsec.Combinator</span></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Parsec.Error</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">errorMessages</span></span><span>
</span><span id="line-184"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">showErrorMessages</span></span><span>
</span><span id="line-185"></span><span>                                            </span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Text.Parsec.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Parsec</span></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">parse</span></span><span>
</span><span id="line-188"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">eof</span></span><span>
</span><span id="line-189"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ParseError</span></span><span>
</span><span id="line-190"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">space</span></span><span>
</span><span id="line-191"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">anyChar</span></span><span>
</span><span id="line-192"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">string</span></span><span>
</span><span id="line-193"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getInput</span></span><span>
</span><span id="line-194"></span><span>                                            </span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Regex.TDFA</span></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-operator">(=~)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>                   </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">liftIO</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Discord.Internal.Monad.html"><span class="hs-identifier">Discord.Internal.Monad</span></a></span><span>
</span><span id="line-199"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Discord.Types</span></span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Discord</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Command.Error.html"><span class="hs-identifier">Command.Error</span></a></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Command.Error.html#CommandError"><span class="hs-identifier">CommandError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Command.Parser.html"><span class="hs-identifier">Command.Parser</span></a></span><span>             </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Command.Parser.html#ParsableArgument"><span class="hs-identifier">ParsableArgument</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Parser.html#RemainingText"><span class="hs-identifier">RemainingText</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Parser.html#manyTill1"><span class="hs-identifier">manyTill1</span></a></span><span>
</span><span id="line-206"></span><span>                                            </span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Owoifier.html"><span class="hs-identifier">Owoifier</span></a></span><span>                   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Owoifier.html#owoify"><span class="hs-identifier">owoify</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | A @Command@ is a datatype containing the metadata for a user-registered</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- command. </span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- @Command m@ is a command that runs in the monad @m@, which when triggered</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- will run a polyvariadic handler function. The handler *must* run in the</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- @m@ monad, which is enforced by the type-checker (to see the details, look in</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- @CommandHandlerType@ in the source code).</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- The contents of this abstract datatype are not exported from this module for</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- encapsulation. Use 'command', 'parsecCommand', or 'regexCommand' to</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- instantiate one.</span><span>
</span><span id="line-220"></span><span class="hs-keyword">data</span><span> </span><span id="Command"><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-var">Command</span></a></span></span><span> </span><span id="local-6989586621679164746"><span class="annot"><a href="#local-6989586621679164746"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Command"><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-var">Command</span></a></span></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="commandName"><span class="annot"><span class="annottext">Command m -&gt; Text
</span><a href="Command.Command.html#commandName"><span class="hs-identifier hs-var hs-var">commandName</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-comment">-- ^ The name of the command.</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandPrefix"><span class="annot"><span class="annottext">Command m -&gt; Text
</span><a href="Command.Command.html#commandPrefix"><span class="hs-identifier hs-var hs-var">commandPrefix</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">-- ^ The prefix for the command. </span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandAliases"><span class="annot"><span class="annottext">Command m -&gt; [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var hs-var">commandAliases</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- ^ Any alias names for the command.</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandInitialMatch"><span class="annot"><span class="annottext">Command m -&gt; Message -&gt; Command m -&gt; Maybe [Text]
</span><a href="Command.Command.html#commandInitialMatch"><span class="hs-identifier hs-var hs-var">commandInitialMatch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-comment">-- ^ A function that performs an initial match check before checking for</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- requirements or applying arguments. Grabs the necessary parts to be passed</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- into commandApplier. If not matching, this will be Nothing.</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandApplier"><span class="annot"><span class="annottext">Command m -&gt; Message -&gt; [Text] -&gt; m ()
</span><a href="Command.Command.html#commandApplier"><span class="hs-identifier hs-var hs-var">commandApplier</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- ^ The function used to apply the arguments into a handler. It needs to</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">-- take a 'Message' that triggered the command, the input text, and produce</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-comment">-- an action in the monad @m@.</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandErrorHandler"><span class="annot"><span class="annottext">Command m -&gt; Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#commandErrorHandler"><span class="hs-identifier hs-var hs-var">commandErrorHandler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Error.html#CommandError"><span class="hs-identifier hs-type">CommandError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- ^ The function called when a 'CommandError' is raised during the handling</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- of a command.</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandHelp"><span class="annot"><span class="annottext">Command m -&gt; Text
</span><a href="Command.Command.html#commandHelp"><span class="hs-identifier hs-var hs-var">commandHelp</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- ^ The help for this command.</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="commandRequires"><span class="annot"><span class="annottext">Command m -&gt; [Message -&gt; m (Maybe Text)]
</span><a href="Command.Command.html#commandRequires"><span class="hs-identifier hs-var hs-var">commandRequires</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-comment">-- ^ A list of requirements that need to pass (Nothing) for the command to</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- be processed. If any fails, the reason will be passed to</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-comment">-- commandErrorHandler.</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | @command name handler@ creates a 'Command' named @name@, which upon</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- receiving a message will run @handler@. The @name@ cannot contain any spaces,</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- as it breaks the parser. The @handler@ function can take an arbitrary amount</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- of arguments of arbitrary types (it is polyvariadic), as long as they are</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- instances of 'ParsableArgument'.</span><span>
</span><span id="line-252"></span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- The Command that this function creates is polymorphic in the Monad it is run</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- in. This means you can call it from 'DiscordHandler' or any other</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- Monad that satisfies the constraints of 'MonadDiscord'.</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- </span><span>
</span><span id="line-257"></span><span class="hs-comment">-- == __Examples:__</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- @pong@ below responds to a ping by a pong.</span><span>
</span><span id="line-260"></span><span class="hs-comment">--</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- pong :: (MonadDiscord m) =&gt; Command m</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- pong = command &quot;ping&quot; $ \\msg -&gt; respond msg &quot;pong!&quot;</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- </span><span>
</span><span id="line-266"></span><span class="hs-comment">-- @pong2@ shows that @help@ and @runCommand@ can be composed to create a normal</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- receiver.</span><span>
</span><span id="line-268"></span><span class="hs-comment">--</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- pong2 :: (MonadDiscord m) =&gt; Message -&gt; m ()</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- pong2</span><span>
</span><span id="line-272"></span><span class="hs-comment">--     = runCommand</span><span>
</span><span id="line-273"></span><span class="hs-comment">--     . help &quot;Custom help message&quot;</span><span>
</span><span id="line-274"></span><span class="hs-comment">--     . command &quot;ping&quot; $ \\msg -&gt; respond msg &quot;pong!&quot;</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-276"></span><span class="hs-comment">--</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- @weather@ below shows having arbitrary arguments in action. @location@ is</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- likely inferred to be 'T.Text'.</span><span>
</span><span id="line-279"></span><span class="hs-comment">--</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- weather = command &quot;weather&quot; $ \\msg location -&gt; do</span><span>
</span><span id="line-282"></span><span class="hs-comment">--     result &lt;- liftIO $ getWeather location</span><span>
</span><span id="line-283"></span><span class="hs-comment">--     respond msg $ &quot;Weather at &quot; &lt;&gt; location &lt;&gt; &quot; is &quot; &lt;&gt; result &lt;&gt; &quot;!&quot;</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- @complex@ shows that you can parse any type! (as long as you create an</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- instance declaration of 'ParsableArgument' for it). Ideally this should be</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- placed in @Command/Parser.hs@ among all the other parsers.</span><span>
</span><span id="line-289"></span><span class="hs-comment">--</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- instance ParsableArgument Int where</span><span>
</span><span id="line-292"></span><span class="hs-comment">--     parserForArg msg = do</span><span>
</span><span id="line-293"></span><span class="hs-comment">--         -- some parsec</span><span>
</span><span id="line-294"></span><span class="hs-comment">--         parsed \&lt;- read \&lt;$&gt; many digit</span><span>
</span><span id="line-295"></span><span class="hs-comment">--         endOrSpaces</span><span>
</span><span id="line-296"></span><span class="hs-comment">--         pure parsed</span><span>
</span><span id="line-297"></span><span class="hs-comment">--</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- complex :: (MonadDiscord m) =&gt; Command m</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- complex = command &quot;setLimit&quot; $ \\i -&gt; do</span><span>
</span><span id="line-300"></span><span class="hs-comment">--     ...</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span id="local-6989586621679164681"><span id="local-6989586621679164682"><span class="annot"><a href="Command.Command.html#command"><span class="hs-identifier hs-type">command</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Command.Command.html#CommandHandlerType"><span class="hs-identifier hs-type">CommandHandlerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164682"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164681"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164682"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-comment">-- ^ The name of the command.</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164681"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- ^ The handler for the command, that takes an arbitrary amount of</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- 'ParsableArgument's and returns a @m ()@</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164682"><span class="hs-identifier hs-type">m</span></a></span></span></span><span>
</span><span id="line-311"></span><span id="command"><span class="annot"><span class="annottext">command :: Text -&gt; h -&gt; Command m
</span><a href="Command.Command.html#command"><span class="hs-identifier hs-var hs-var">command</span></a></span></span><span> </span><span id="local-6989586621679164574"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164574"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679164573"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679164573"><span class="hs-identifier hs-var">commandHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command :: forall (m :: * -&gt; *).
Text
-&gt; Text
-&gt; [Text]
-&gt; (Message -&gt; Command m -&gt; Maybe [Text])
-&gt; (Message -&gt; [Text] -&gt; m ())
-&gt; (Message -&gt; CommandError -&gt; m ())
-&gt; Text
-&gt; [Message -&gt; m (Maybe Text)]
-&gt; Command m
</span><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandName :: Text
</span><a href="Command.Command.html#commandName"><span class="hs-identifier hs-var">commandName</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164574"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandPrefix :: Text
</span><a href="Command.Command.html#commandPrefix"><span class="hs-identifier hs-var">commandPrefix</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandAliases :: [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var">commandAliases</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandInitialMatch :: Message -&gt; Command m -&gt; Maybe [Text]
</span><a href="Command.Command.html#commandInitialMatch"><span class="hs-identifier hs-var">commandInitialMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679164572"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164572"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679164571"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164571"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parsec Text () Text -&gt; SourceName -&gt; Text -&gt; Either ParseError Text
forall s t a.
Stream s Identity t =&gt;
Parsec s () a -&gt; SourceName -&gt; s -&gt; Either ParseError a
</span><span class="hs-identifier hs-var">parse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Command m -&gt; Parsec Text () Text
forall (m :: * -&gt; *). Command m -&gt; Parsec Text () Text
</span><a href="Command.Command.html#parseCommandName"><span class="hs-identifier hs-var">parseCommandName</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164571"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; Text
</span><span class="hs-identifier hs-var hs-var">messageText</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164572"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679164568"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164568"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-318"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679164567"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164567"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Maybe [Text]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164567"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandApplier :: Message -&gt; [Text] -&gt; m ()
</span><a href="Command.Command.html#commandApplier"><span class="hs-identifier hs-var">commandApplier</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679164566"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164566"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679164565"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164565"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">h -&gt; Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) h.
CommandHandlerType m h =&gt;
h -&gt; Message -&gt; Text -&gt; m ()
</span><a href="Command.Command.html#applyArgs"><span class="hs-identifier hs-var">applyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679164573"><span class="hs-identifier hs-var">commandHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164566"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164565"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandErrorHandler :: Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#commandErrorHandler"><span class="hs-identifier hs-var">commandErrorHandler</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
forall (m :: * -&gt; *).
MonadDiscord m =&gt;
Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#defaultErrorHandler"><span class="hs-identifier hs-var">defaultErrorHandler</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandHelp :: Text
</span><a href="Command.Command.html#commandHelp"><span class="hs-identifier hs-var">commandHelp</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Help not available.&quot;</span></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandRequires :: [Message -&gt; m (Maybe Text)]
</span><a href="Command.Command.html#commandRequires"><span class="hs-identifier hs-var">commandRequires</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- | @onError@ overwrites the default error handler of a command with a custom</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- implementation. Usually the default 'defaultErrorHandler' suffices.</span><span>
</span><span id="line-327"></span><span class="hs-comment">--</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-329"></span><span class="hs-comment">-- example</span><span>
</span><span id="line-330"></span><span class="hs-comment">--     = onError (\\msg e -&gt; respond msg (T.pack $ show e))</span><span>
</span><span id="line-331"></span><span class="hs-comment">--     . command &quot;example&quot; $ do</span><span>
</span><span id="line-332"></span><span class="hs-comment">--         ...</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-334"></span><span id="local-6989586621679164562"><span class="annot"><a href="Command.Command.html#onError"><span class="hs-identifier hs-type">onError</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Error.html#CommandError"><span class="hs-identifier hs-type">CommandError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164562"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-comment">-- ^ Error handler that takes the original message that caused the error,</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-comment">-- and the error itself. It runs in the same monad as the command handlers.</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164562"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164562"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-340"></span><span id="onError"><span class="annot"><span class="annottext">onError :: (Message -&gt; CommandError -&gt; m ()) -&gt; Command m -&gt; Command m
</span><a href="Command.Command.html#onError"><span class="hs-identifier hs-var hs-var">onError</span></a></span></span><span> </span><span id="local-6989586621679164561"><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
</span><a href="#local-6989586621679164561"><span class="hs-identifier hs-var">errorHandler</span></a></span></span><span> </span><span id="local-6989586621679164560"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164560"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164560"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandErrorHandler :: Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#commandErrorHandler"><span class="hs-identifier hs-var">commandErrorHandler</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
</span><a href="#local-6989586621679164561"><span class="hs-identifier hs-var">errorHandler</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | @prefix@ overwrites the default command prefix &quot;:&quot; of a command with a</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- custom one. This is ignored if a custom parser like 'regexCommand' or</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- 'parsecCommand' is used.</span><span>
</span><span id="line-347"></span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- example</span><span>
</span><span id="line-350"></span><span class="hs-comment">--     = prefix &quot;-&gt;&quot;</span><span>
</span><span id="line-351"></span><span class="hs-comment">--     . command &quot;idk&quot; $ do</span><span>
</span><span id="line-352"></span><span class="hs-comment">--         ...</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-354"></span><span id="local-6989586621679164559"><span class="annot"><a href="Command.Command.html#prefix"><span class="hs-identifier hs-type">prefix</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164559"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164559"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-358"></span><span id="prefix"><span class="annot"><span class="annottext">prefix :: Text -&gt; Command m -&gt; Command m
</span><a href="Command.Command.html#prefix"><span class="hs-identifier hs-var hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621679164557"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164557"><span class="hs-identifier hs-var">newPrefix</span></a></span></span><span> </span><span id="local-6989586621679164556"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164556"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164556"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandPrefix :: Text
</span><a href="Command.Command.html#commandPrefix"><span class="hs-identifier hs-var">commandPrefix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164557"><span class="hs-identifier hs-var">newPrefix</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | @requires@ adds a requirement to the command. The requirement is a function</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- that takes a 'Message' and either returns @'Nothing'@ (no problem) or</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- @'Just' &quot;explanation&quot;@. The function is in the @m@ monad so it can access</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- any additional information from Discord as necessary.</span><span>
</span><span id="line-366"></span><span class="hs-comment">--</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- Commands default to having no requirements.</span><span>
</span><span id="line-368"></span><span id="local-6989586621679164555"><span class="annot"><a href="Command.Command.html#requires"><span class="hs-identifier hs-type">requires</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164555"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164555"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164555"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-369"></span><span id="requires"><span class="annot"><span class="annottext">requires :: (Message -&gt; m (Maybe Text)) -&gt; Command m -&gt; Command m
</span><a href="Command.Command.html#requires"><span class="hs-identifier hs-var hs-var">requires</span></a></span></span><span> </span><span id="local-6989586621679164554"><span class="annot"><span class="annottext">Message -&gt; m (Maybe Text)
</span><a href="#local-6989586621679164554"><span class="hs-identifier hs-var">requirement</span></a></span></span><span> </span><span id="local-6989586621679164553"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164553"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164553"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandRequires :: [Message -&gt; m (Maybe Text)]
</span><a href="Command.Command.html#commandRequires"><span class="hs-identifier hs-var">commandRequires</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; m (Maybe Text)
</span><a href="#local-6989586621679164554"><span class="hs-identifier hs-var">requirement</span></a></span><span> </span><span class="annot"><span class="annottext">(Message -&gt; m (Maybe Text))
-&gt; [Message -&gt; m (Maybe Text)] -&gt; [Message -&gt; m (Maybe Text)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Command m -&gt; [Message -&gt; m (Maybe Text)]
forall (m :: * -&gt; *). Command m -&gt; [Message -&gt; m (Maybe Text)]
</span><a href="Command.Command.html#commandRequires"><span class="hs-identifier hs-var hs-var">commandRequires</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164553"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">-- | @help@ sets the help message for the command. The default is &quot;Help not</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- available.&quot;</span><span>
</span><span id="line-375"></span><span id="local-6989586621679164552"><span class="annot"><a href="Command.Command.html#help"><span class="hs-identifier hs-type">help</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164552"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-376"></span><span id="help"><span class="annot"><span class="annottext">help :: Text -&gt; Command m -&gt; Command m
</span><a href="Command.Command.html#help"><span class="hs-identifier hs-var hs-var">help</span></a></span></span><span> </span><span id="local-6989586621679164551"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164551"><span class="hs-identifier hs-var">newHelp</span></a></span></span><span> </span><span id="local-6989586621679164550"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164550"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164550"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandHelp :: Text
</span><a href="Command.Command.html#commandHelp"><span class="hs-identifier hs-var">commandHelp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164551"><span class="hs-identifier hs-var">newHelp</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-comment">-- | @alias@ adds an alias for the command's name. This is ignored if a custom</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- parser like 'regexCommand' or 'parsecCommand' is used.</span><span>
</span><span id="line-382"></span><span class="hs-comment">--</span><span>
</span><span id="line-383"></span><span class="hs-comment">-- Functionally, this is equivalent to defining a new command with the same</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- handler, however the aliases may not appear on help pages.</span><span>
</span><span id="line-385"></span><span id="local-6989586621679164549"><span class="annot"><a href="Command.Command.html#alias"><span class="hs-identifier hs-type">alias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164549"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164549"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-386"></span><span id="alias"><span class="annot"><span class="annottext">alias :: Text -&gt; Command m -&gt; Command m
</span><a href="Command.Command.html#alias"><span class="hs-identifier hs-var hs-var">alias</span></a></span></span><span> </span><span id="local-6989586621679164548"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164548"><span class="hs-identifier hs-var">newAlias</span></a></span></span><span> </span><span id="local-6989586621679164547"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164547"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164547"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandAliases :: [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var">commandAliases</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164548"><span class="hs-identifier hs-var">newAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Command m -&gt; [Text]
forall (m :: * -&gt; *). Command m -&gt; [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var hs-var">commandAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164547"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-comment">-- | @parsecCommand@ defines a command that has no name, and has a custom</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- parser that begins from the start of a message. It can help things like</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- &quot;::quotes&quot; because they have special syntax that demands a special parser.</span><span>
</span><span id="line-393"></span><span class="hs-comment">--</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- 'prefix' and 'alias', if used together, are ignored. Other compoasble</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- functions like 'help', 'requires', and 'onError' are still valid.</span><span>
</span><span id="line-396"></span><span class="hs-comment">--</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- The handler __must__ take a 'Message' and a 'String' as argument (nothing</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- more, nothing less), where the latter is the result of the parser.</span><span>
</span><span id="line-399"></span><span class="hs-comment">--</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- example</span><span>
</span><span id="line-402"></span><span class="hs-comment">--     = requires moderatorPrivs</span><span>
</span><span id="line-403"></span><span class="hs-comment">--     . parsecCommand (string '::' &gt;&gt; many1 anyChar) $ \\msg quoteName -&gt; do</span><span>
</span><span id="line-404"></span><span class="hs-comment">--         ...</span><span>
</span><span id="line-405"></span><span class="hs-comment">--         -- this is triggered on &quot;::&lt;one or more chars&gt;&quot; where quoteName</span><span>
</span><span id="line-406"></span><span class="hs-comment">--         -- contains the section enclosed in &lt;&gt;</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-408"></span><span id="local-6989586621679164546"><span class="annot"><a href="Command.Command.html#parsecCommand"><span class="hs-identifier hs-type">parsecCommand</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164546"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-comment">-- ^ The custom parser for the command. It has to return a 'String'.</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164546"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-comment">-- ^ The handler for the command.</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164546"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-415"></span><span id="parsecCommand"><span class="annot"><span class="annottext">parsecCommand :: Parser SourceName -&gt; (Message -&gt; SourceName -&gt; m ()) -&gt; Command m
</span><a href="Command.Command.html#parsecCommand"><span class="hs-identifier hs-var hs-var">parsecCommand</span></a></span></span><span> </span><span id="local-6989586621679164544"><span class="annot"><span class="annottext">Parser SourceName
</span><a href="#local-6989586621679164544"><span class="hs-identifier hs-var">parserFunc</span></a></span></span><span> </span><span id="local-6989586621679164543"><span class="annot"><span class="annottext">Message -&gt; SourceName -&gt; m ()
</span><a href="#local-6989586621679164543"><span class="hs-identifier hs-var">commandHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command :: forall (m :: * -&gt; *).
Text
-&gt; Text
-&gt; [Text]
-&gt; (Message -&gt; Command m -&gt; Maybe [Text])
-&gt; (Message -&gt; [Text] -&gt; m ())
-&gt; (Message -&gt; CommandError -&gt; m ())
-&gt; Text
-&gt; [Message -&gt; m (Maybe Text)]
-&gt; Command m
</span><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandName :: Text
</span><a href="Command.Command.html#commandName"><span class="hs-identifier hs-var">commandName</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;custom parser&gt;&quot;</span></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandPrefix :: Text
</span><a href="Command.Command.html#commandPrefix"><span class="hs-identifier hs-var">commandPrefix</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandAliases :: [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var">commandAliases</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandInitialMatch :: Message -&gt; Command m -&gt; Maybe [Text]
</span><a href="Command.Command.html#commandInitialMatch"><span class="hs-identifier hs-var">commandInitialMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679164542"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164542"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679164541"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164541"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser SourceName
-&gt; SourceName -&gt; Text -&gt; Either ParseError SourceName
forall s t a.
Stream s Identity t =&gt;
Parsec s () a -&gt; SourceName -&gt; s -&gt; Either ParseError a
</span><span class="hs-identifier hs-var">parse</span></span><span> </span><span class="annot"><span class="annottext">Parser SourceName
</span><a href="#local-6989586621679164544"><span class="hs-identifier hs-var">parserFunc</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; Text
</span><span class="hs-identifier hs-var hs-var">messageText</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164542"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-421"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679164540"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164540"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-422"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679164539"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679164539"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Maybe [Text]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(SourceName -&gt; Text) -&gt; SourceName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679164539"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-comment">-- has to be packed and unpacked, which is not really good.</span><span>
</span><span id="line-424"></span><span>            </span><span class="hs-comment">-- TODO: find some datatype that can express String, T.Text, and [T.Text]</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandApplier :: Message -&gt; [Text] -&gt; m ()
</span><a href="Command.Command.html#commandApplier"><span class="hs-identifier hs-var">commandApplier</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679164537"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164537"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679164536"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164536"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Message -&gt; SourceName -&gt; m ()
</span><a href="#local-6989586621679164543"><span class="hs-identifier hs-var">commandHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164537"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SourceName
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SourceName) -&gt; Text -&gt; SourceName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164536"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandErrorHandler :: Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#commandErrorHandler"><span class="hs-identifier hs-var">commandErrorHandler</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
forall (m :: * -&gt; *).
MonadDiscord m =&gt;
Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#defaultErrorHandler"><span class="hs-identifier hs-var">defaultErrorHandler</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandHelp :: Text
</span><a href="Command.Command.html#commandHelp"><span class="hs-identifier hs-var">commandHelp</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Help not available.&quot;</span></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandRequires :: [Message -&gt; m (Maybe Text)]
</span><a href="Command.Command.html#commandRequires"><span class="hs-identifier hs-var">commandRequires</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- | @regexCommand@ defines a command that has no name, and has a custom</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- regular expression matcher, that __searches across any part of the message__.</span><span>
</span><span id="line-433"></span><span class="hs-comment">--</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- 'prefix' and 'alias', if used together, are ignored. Other compoasble</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- functions like 'help', 'requires', and 'onError' are still valid.</span><span>
</span><span id="line-436"></span><span class="hs-comment">--</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- The handler __must__ take a 'Message' and a '[T.Text]' as argument, where</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- the latter are the list of captured values from the Regex (same as the past</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- @newCommand@).</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- thatcher = regexCommand &quot;thatcher [Ii]s ([Dd]ead|[Aa]live)&quot; $ \\msg caps -&gt; do</span><span>
</span><span id="line-443"></span><span class="hs-comment">--     let verb = head caps</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-446"></span><span id="local-6989586621679164534"><span class="annot"><a href="Command.Command.html#regexCommand"><span class="hs-identifier hs-type">regexCommand</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164534"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164534"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164534"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-451"></span><span id="regexCommand"><span class="annot"><span class="annottext">regexCommand :: Text -&gt; (Message -&gt; [Text] -&gt; m ()) -&gt; Command m
</span><a href="Command.Command.html#regexCommand"><span class="hs-identifier hs-var hs-var">regexCommand</span></a></span></span><span> </span><span id="local-6989586621679164533"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164533"><span class="hs-identifier hs-var">regex</span></a></span></span><span> </span><span id="local-6989586621679164532"><span class="annot"><span class="annottext">Message -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621679164532"><span class="hs-identifier hs-var">commandHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command :: forall (m :: * -&gt; *).
Text
-&gt; Text
-&gt; [Text]
-&gt; (Message -&gt; Command m -&gt; Maybe [Text])
-&gt; (Message -&gt; [Text] -&gt; m ())
-&gt; (Message -&gt; CommandError -&gt; m ())
-&gt; Text
-&gt; [Message -&gt; m (Maybe Text)]
-&gt; Command m
</span><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">commandName :: Text
</span><a href="Command.Command.html#commandName"><span class="hs-identifier hs-var">commandName</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;regex&gt;&quot;</span></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandPrefix :: Text
</span><a href="Command.Command.html#commandPrefix"><span class="hs-identifier hs-var">commandPrefix</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandAliases :: [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var">commandAliases</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandInitialMatch :: Message -&gt; Command m -&gt; Maybe [Text]
</span><a href="Command.Command.html#commandInitialMatch"><span class="hs-identifier hs-var">commandInitialMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679164531"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164531"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679164530"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164530"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-457"></span><span>        </span><span id="local-6989586621679164529"><span class="annot"><span class="annottext">match :: [[Text]]
</span><a href="#local-6989586621679164529"><span class="hs-identifier hs-var hs-var">match</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; Text
</span><span class="hs-identifier hs-var hs-var">messageText</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164531"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [[Text]]
forall source source1 target.
(RegexMaker Regex CompOption ExecOption source,
 RegexContext Regex source1 target) =&gt;
source1 -&gt; source -&gt; target
</span><span class="hs-operator hs-var">=~</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164533"><span class="hs-identifier hs-var">regex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>      </span><span class="hs-keyword">in</span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[[Text]] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679164529"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Maybe [Text]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Maybe [Text]) -&gt; [Text] -&gt; Maybe [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Text]] -&gt; [Text]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Text]] -&gt; [Text])
-&gt; ([[Text]] -&gt; [[Text]]) -&gt; [[Text]] -&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [[Text]] -&gt; [[Text]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679164529"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandApplier :: Message -&gt; [Text] -&gt; m ()
</span><a href="Command.Command.html#commandApplier"><span class="hs-identifier hs-var">commandApplier</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621679164532"><span class="hs-identifier hs-var">commandHandler</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandErrorHandler :: Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#commandErrorHandler"><span class="hs-identifier hs-var">commandErrorHandler</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
forall (m :: * -&gt; *).
MonadDiscord m =&gt;
Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#defaultErrorHandler"><span class="hs-identifier hs-var">defaultErrorHandler</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandHelp :: Text
</span><a href="Command.Command.html#commandHelp"><span class="hs-identifier hs-var">commandHelp</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Help not available.&quot;</span></span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">commandRequires :: [Message -&gt; m (Maybe Text)]
</span><a href="Command.Command.html#commandRequires"><span class="hs-identifier hs-var">commandRequires</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-comment">-- | @runCommand command msg@ runs the specified 'Command' with the given</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- message. It first does the initial checks:</span><span>
</span><span id="line-468"></span><span class="hs-comment">--</span><span>
</span><span id="line-469"></span><span class="hs-comment">-- For commands registered with 'command', the check will check for the prefix</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- and the name.</span><span>
</span><span id="line-471"></span><span class="hs-comment">--</span><span>
</span><span id="line-472"></span><span class="hs-comment">-- For commands registered with 'regexCommand', the check will check against the</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- regex.</span><span>
</span><span id="line-474"></span><span class="hs-comment">--</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- For commands registered with 'parsecCommand', the check will check against the</span><span>
</span><span id="line-476"></span><span class="hs-comment">-- parser.</span><span>
</span><span id="line-477"></span><span class="hs-comment">--</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- Any failures during this stage is silently ignored, as it may still be a valid</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- command elsewhere. After this, the requirements are checked (chance, priv, etc).</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- Finally, the @commandApplier@ is called. Any errors inside the handler is</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- caught and appropriately handled.</span><span>
</span><span id="line-482"></span><span class="hs-comment">--</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-484"></span><span class="hs-comment">-- runCommand pong :: Message -&gt; m ()</span><span>
</span><span id="line-485"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-486"></span><span class="annot"><a href="Command.Command.html#runCommand"><span class="hs-identifier hs-type">runCommand</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679164684"><span class="annot"><a href="#local-6989586621679164684"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164684"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164684"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-comment">-- ^ The command to run against.</span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-comment">-- ^ The message to run the command with.</span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164684"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span id="runCommand"><span class="annot"><span class="annottext">runCommand :: Command m -&gt; Message -&gt; m ()
</span><a href="Command.Command.html#runCommand"><span class="hs-identifier hs-var hs-var">runCommand</span></a></span></span><span> </span><span id="local-6989586621679164524"><span class="annot"><span class="annottext">cmd :: Command m
</span><a href="#local-6989586621679164524"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">{</span><span> </span><span id="local-6989586621679164523"><span class="annot"><span class="annottext">Message -&gt; Command m -&gt; Maybe [Text]
commandInitialMatch :: Message -&gt; Command m -&gt; Maybe [Text]
commandInitialMatch :: forall (m :: * -&gt; *).
Command m -&gt; Message -&gt; Command m -&gt; Maybe [Text]
</span><a href="#local-6989586621679164523"><span class="hs-identifier hs-var hs-var">commandInitialMatch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164522"><span class="annot"><span class="annottext">Message -&gt; [Text] -&gt; m ()
commandApplier :: Message -&gt; [Text] -&gt; m ()
commandApplier :: forall (m :: * -&gt; *). Command m -&gt; Message -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621679164522"><span class="hs-identifier hs-var hs-var">commandApplier</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164521"><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
commandErrorHandler :: Message -&gt; CommandError -&gt; m ()
commandErrorHandler :: forall (m :: * -&gt; *). Command m -&gt; Message -&gt; CommandError -&gt; m ()
</span><a href="#local-6989586621679164521"><span class="hs-identifier hs-var hs-var">commandErrorHandler</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164520"><span class="annot"><span class="annottext">[Message -&gt; m (Maybe Text)]
commandRequires :: [Message -&gt; m (Maybe Text)]
commandRequires :: forall (m :: * -&gt; *). Command m -&gt; [Message -&gt; m (Maybe Text)]
</span><a href="#local-6989586621679164520"><span class="hs-identifier hs-var hs-var">commandRequires</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621679164519"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164519"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; Command m -&gt; Maybe [Text]
</span><a href="#local-6989586621679164523"><span class="hs-identifier hs-var">commandInitialMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164519"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164524"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-496"></span><span>        </span><span class="annot"><span class="annottext">Maybe [Text]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679164518"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164518"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>            </span><span class="hs-comment">-- Check for requirements. checks will be a list of Maybes</span><span>
</span><span id="line-499"></span><span>            </span><span id="local-6989586621679164517"><span class="annot"><span class="annottext">[Maybe Text]
</span><a href="#local-6989586621679164517"><span class="hs-identifier hs-var">checks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[m (Maybe Text)] -&gt; m [Maybe Text]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">([m (Maybe Text)] -&gt; m [Maybe Text])
-&gt; [m (Maybe Text)] -&gt; m [Maybe Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Message -&gt; m (Maybe Text)) -&gt; m (Maybe Text))
-&gt; [Message -&gt; m (Maybe Text)] -&gt; [m (Maybe Text)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Message -&gt; m (Maybe Text)) -&gt; Message -&gt; m (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164519"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Message -&gt; m (Maybe Text)]
</span><a href="#local-6989586621679164520"><span class="hs-identifier hs-var">commandRequires</span></a></span><span>
</span><span id="line-500"></span><span>            </span><span class="hs-comment">-- only get the Justs</span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679164515"><span class="annot"><span class="annottext">failedChecks :: [Text]
</span><a href="#local-6989586621679164515"><span class="hs-identifier hs-var hs-var">failedChecks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Text] -&gt; [Text]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Text]
</span><a href="#local-6989586621679164517"><span class="hs-identifier hs-var">checks</span></a></span><span>
</span><span id="line-502"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164515"><span class="hs-identifier hs-var">failedChecks</span></a></span><span>
</span><span id="line-503"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-504"></span><span>                    </span><span class="hs-comment">-- Apply the arguments on the handler</span><span>
</span><span id="line-505"></span><span>                    </span><span class="annot"><span class="annottext">Message -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621679164522"><span class="hs-identifier hs-var">commandApplier</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164519"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164518"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-506"></span><span>                        </span><span class="hs-comment">-- Asynchrnous errors are not caught as the `catch`</span><span>
</span><span id="line-507"></span><span>                        </span><span class="hs-comment">-- comes from Control.Exception.Safe. This is good.</span><span>
</span><span id="line-508"></span><span>                        </span><span class="annot"><span class="annottext">m () -&gt; (CommandError -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">CommandError -&gt; m ()
</span><a href="#local-6989586621679164514"><span class="hs-identifier hs-var">basicErrorCatcher</span></a></span><span>
</span><span id="line-509"></span><span>                        </span><span class="annot"><span class="annottext">m () -&gt; (SomeException -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; m ()
</span><a href="#local-6989586621679164513"><span class="hs-identifier hs-var">allErrorCatcher</span></a></span><span>
</span><span id="line-510"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-511"></span><span>                    </span><span class="hs-comment">-- give the first requirement error to the error handler</span><span>
</span><span id="line-512"></span><span>                    </span><span class="annot"><span class="annottext">CommandError -&gt; m ()
</span><a href="#local-6989586621679164514"><span class="hs-identifier hs-var">basicErrorCatcher</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; CommandError
</span><a href="Command.Error.html#RequirementError"><span class="hs-identifier hs-var">RequirementError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; CommandError) -&gt; Text -&gt; CommandError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679164515"><span class="hs-identifier hs-var">failedChecks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-comment">-- | Catch CommandErrors and handle them with the handler</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><a href="#local-6989586621679164514"><span class="hs-identifier hs-type">basicErrorCatcher</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Command.Error.html#CommandError"><span class="hs-identifier hs-type">CommandError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164684"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>    </span><span id="local-6989586621679164514"><span class="annot"><span class="annottext">basicErrorCatcher :: CommandError -&gt; m ()
</span><a href="#local-6989586621679164514"><span class="hs-identifier hs-var hs-var">basicErrorCatcher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
</span><a href="#local-6989586621679164521"><span class="hs-identifier hs-var">commandErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164519"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-comment">-- | Catch any and all errors, including ones thrown in basicErrorCatcher.</span><span>
</span><span id="line-519"></span><span>    </span><span class="annot"><a href="#local-6989586621679164513"><span class="hs-identifier hs-type">allErrorCatcher</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164684"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>    </span><span id="local-6989586621679164513"><span class="annot"><span class="annottext">allErrorCatcher :: SomeException -&gt; m ()
</span><a href="#local-6989586621679164513"><span class="hs-identifier hs-var hs-var">allErrorCatcher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; CommandError -&gt; m ()
</span><a href="#local-6989586621679164521"><span class="hs-identifier hs-var">commandErrorHandler</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164519"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CommandError -&gt; m ())
-&gt; (SomeException -&gt; CommandError) -&gt; SomeException -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; CommandError
</span><a href="Command.Error.html#HaskellError"><span class="hs-identifier hs-var">HaskellError</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-comment">-- | @runCommands@ calls runCommand for all the Commands, and folds them with</span><span>
</span><span id="line-523"></span><span class="hs-comment">-- the Monadic bind ('&gt;&gt;').</span><span>
</span><span id="line-524"></span><span id="local-6989586621679164510"><span class="annot"><a href="Command.Command.html#runCommands"><span class="hs-identifier hs-type">runCommands</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679164510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164510"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-529"></span><span id="runCommands"><span class="annot"><span class="annottext">runCommands :: [Command m] -&gt; Message -&gt; m ()
</span><a href="Command.Command.html#runCommands"><span class="hs-identifier hs-var hs-var">runCommands</span></a></span></span><span> </span><span id="local-6989586621679164509"><span class="annot"><span class="annottext">[Command m]
</span><a href="#local-6989586621679164509"><span class="hs-identifier hs-var">cmds</span></a></span></span><span> </span><span id="local-6989586621679164508"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164508"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m [()] -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m [()] -&gt; m ()) -&gt; m [()] -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[m ()] -&gt; m [()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">([m ()] -&gt; m [()]) -&gt; [m ()] -&gt; m [()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Message -&gt; m ()) -&gt; m ()) -&gt; [Message -&gt; m ()] -&gt; [m ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Message -&gt; m ()) -&gt; Message -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164508"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Command m -&gt; Message -&gt; m ()) -&gt; [Command m] -&gt; [Message -&gt; m ()]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Command m -&gt; Message -&gt; m ()
forall (m :: * -&gt; *).
MonadDiscord m =&gt;
Command m -&gt; Message -&gt; m ()
</span><a href="Command.Command.html#runCommand"><span class="hs-identifier hs-var">runCommand</span></a></span><span> </span><span class="annot"><span class="annottext">[Command m]
</span><a href="#local-6989586621679164509"><span class="hs-identifier hs-var">cmds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="hs-comment">-- | @runHelp@ creates a super duper simple help command that just lists</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- each command's names together with their help text.</span><span>
</span><span id="line-533"></span><span id="local-6989586621679164507"><span class="annot"><a href="Command.Command.html#runHelp"><span class="hs-identifier hs-type">runHelp</span></a></span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164507"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164507"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164507"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-539"></span><span id="runHelp"><span class="annot"><span class="annottext">runHelp :: Text -&gt; [Command m] -&gt; Message -&gt; m ()
</span><a href="Command.Command.html#runHelp"><span class="hs-identifier hs-var hs-var">runHelp</span></a></span></span><span> </span><span id="local-6989586621679164506"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164506"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679164505"><span class="annot"><span class="annottext">[Command m]
</span><a href="#local-6989586621679164505"><span class="hs-identifier hs-var">cmds</span></a></span></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Command m -&gt; Message -&gt; m ()
forall (m :: * -&gt; *).
MonadDiscord m =&gt;
Command m -&gt; Message -&gt; m ()
</span><a href="Command.Command.html#runCommand"><span class="hs-identifier hs-var">runCommand</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span class="annot"><span class="annottext">(Command m -&gt; Message -&gt; m ())
-&gt; ((Message -&gt; m ()) -&gt; Command m)
-&gt; (Message -&gt; m ())
-&gt; Message
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Message -&gt; m ()) -&gt; Command m
forall (m :: * -&gt; *) h.
(CommandHandlerType m h, MonadDiscord m) =&gt;
Text -&gt; h -&gt; Command m
</span><a href="Command.Command.html#command"><span class="hs-identifier hs-var">command</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164506"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((Message -&gt; m ()) -&gt; Message -&gt; m ())
-&gt; (Message -&gt; m ()) -&gt; Message -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679164504"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164504"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>        </span><span id="local-6989586621679164503"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679164503"><span class="hs-identifier hs-var">chan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserId -&gt; m Channel
forall (m :: * -&gt; *). MonadDiscord m =&gt; UserId -&gt; m Channel
</span><a href="Discord.Internal.Monad.html#createDM"><span class="hs-identifier hs-var">createDM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">User -&gt; UserId
</span><span class="hs-identifier hs-var hs-var">userId</span></span><span> </span><span class="annot"><span class="annottext">(User -&gt; UserId) -&gt; User -&gt; UserId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Message -&gt; User
</span><span class="hs-identifier hs-var hs-var">messageAuthor</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164504"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>        </span><span class="annot"><span class="annottext">m Message -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m Message -&gt; m ()) -&gt; m Message -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UserId -&gt; Text -&gt; m Message
forall (m :: * -&gt; *). MonadDiscord m =&gt; UserId -&gt; Text -&gt; m Message
</span><a href="Discord.Internal.Monad.html#createMessage"><span class="hs-identifier hs-var">createMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; UserId
</span><span class="hs-identifier hs-var hs-var">channelId</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679164503"><span class="hs-identifier hs-var">chan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Message) -&gt; Text -&gt; m Message
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-544"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;```&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Command m -&gt; Text) -&gt; [Command m] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Command m -&gt; Text
forall (m :: * -&gt; *). Command m -&gt; Text
</span><a href="#local-6989586621679164496"><span class="hs-identifier hs-var">createCommandHelp</span></a></span><span> </span><span class="annot"><span class="annottext">[Command m]
</span><a href="#local-6989586621679164505"><span class="hs-identifier hs-var">cmds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;```&quot;</span></span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-546"></span><span>    </span><span id="local-6989586621679164675"><span class="annot"><a href="#local-6989586621679164496"><span class="hs-identifier hs-type">createCommandHelp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621679164496"><span class="annot"><span class="annottext">createCommandHelp :: Command m -&gt; Text
</span><a href="#local-6989586621679164496"><span class="hs-identifier hs-var hs-var">createCommandHelp</span></a></span></span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">{</span><span> </span><span id="local-6989586621679164495"><span class="annot"><span class="annottext">Text
commandPrefix :: Text
commandPrefix :: forall (m :: * -&gt; *). Command m -&gt; Text
</span><a href="#local-6989586621679164495"><span class="hs-identifier hs-var hs-var">commandPrefix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164494"><span class="annot"><span class="annottext">Text
commandName :: Text
commandName :: forall (m :: * -&gt; *). Command m -&gt; Text
</span><a href="#local-6989586621679164494"><span class="hs-identifier hs-var hs-var">commandName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164493"><span class="annot"><span class="annottext">Text
commandHelp :: Text
commandHelp :: forall (m :: * -&gt; *). Command m -&gt; Text
</span><a href="#local-6989586621679164493"><span class="hs-identifier hs-var hs-var">commandHelp</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;# &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164495"><span class="hs-identifier hs-var">commandPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164494"><span class="hs-identifier hs-var">commandName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164493"><span class="hs-identifier hs-var">commandHelp</span></a></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-comment">-- | @defaultErrorHandler m e@ is the default error handler unless you override</span><span>
</span><span id="line-553"></span><span class="hs-comment">-- it manually. This is exported and documented for reference only.</span><span>
</span><span id="line-554"></span><span class="hs-comment">--</span><span>
</span><span id="line-555"></span><span class="hs-comment">-- [On argument error] It calls 'respond' with the errors. This isn't owoified</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- for legibility.</span><span>
</span><span id="line-557"></span><span class="hs-comment">-- [On requirement error] It sends a DM to the invoking user with the errors.</span><span>
</span><span id="line-558"></span><span class="hs-comment">-- [On a processing error] It calls 'respond' with the error.</span><span>
</span><span id="line-559"></span><span class="hs-comment">-- [On a Discord request failure] It calls 'respond' with the error.</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- [On a Runtime/Haskell error] It calls 'respond' with the error, owoified.</span><span>
</span><span id="line-561"></span><span id="local-6989586621679164731"><span class="annot"><a href="Command.Command.html#defaultErrorHandler"><span class="hs-identifier hs-type">defaultErrorHandler</span></a></span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Monad.html#MonadDiscord"><span class="hs-identifier hs-type">MonadDiscord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164731"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Command.Error.html#CommandError"><span class="hs-identifier hs-type">CommandError</span></a></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164731"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-566"></span><span id="defaultErrorHandler"><span class="annot"><span class="annottext">defaultErrorHandler :: Message -&gt; CommandError -&gt; m ()
</span><a href="Command.Command.html#defaultErrorHandler"><span class="hs-identifier hs-var hs-var">defaultErrorHandler</span></a></span></span><span> </span><span id="local-6989586621679164492"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164492"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679164491"><span class="annot"><span class="annottext">CommandError
</span><a href="#local-6989586621679164491"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CommandError
</span><a href="#local-6989586621679164491"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-568"></span><span>        </span><span class="annot"><a href="Command.Error.html#ArgumentParseError"><span class="hs-identifier hs-type">ArgumentParseError</span></a></span><span> </span><span id="local-6989586621679164489"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164489"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-569"></span><span>            </span><span class="annot"><span class="annottext">Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *). MonadDiscord m =&gt; Message -&gt; Text -&gt; m ()
</span><a href="Discord.Internal.Monad.html#respond"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164492"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164489"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="annot"><a href="Command.Error.html#RequirementError"><span class="hs-identifier hs-type">RequirementError</span></a></span><span> </span><span id="local-6989586621679164487"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164487"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-571"></span><span>            </span><span id="local-6989586621679164486"><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679164486"><span class="hs-identifier hs-var">chan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserId -&gt; m Channel
forall (m :: * -&gt; *). MonadDiscord m =&gt; UserId -&gt; m Channel
</span><a href="Discord.Internal.Monad.html#createDM"><span class="hs-identifier hs-var">createDM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">User -&gt; UserId
</span><span class="hs-identifier hs-var hs-var">userId</span></span><span> </span><span class="annot"><span class="annottext">(User -&gt; UserId) -&gt; User -&gt; UserId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Message -&gt; User
</span><span class="hs-identifier hs-var hs-var">messageAuthor</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164492"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>            </span><span class="annot"><span class="annottext">m Message -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m Message -&gt; m ()) -&gt; m Message -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UserId -&gt; Text -&gt; m Message
forall (m :: * -&gt; *). MonadDiscord m =&gt; UserId -&gt; Text -&gt; m Message
</span><a href="Discord.Internal.Monad.html#createMessage"><span class="hs-identifier hs-var">createMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Channel -&gt; UserId
</span><span class="hs-identifier hs-var hs-var">channelId</span></span><span> </span><span class="annot"><span class="annottext">Channel
</span><a href="#local-6989586621679164486"><span class="hs-identifier hs-var">chan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164487"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-573"></span><span>        </span><span class="annot"><a href="Command.Error.html#ProcessingError"><span class="hs-identifier hs-type">ProcessingError</span></a></span><span> </span><span id="local-6989586621679164484"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164484"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-574"></span><span>            </span><span class="annot"><span class="annottext">Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *). MonadDiscord m =&gt; Message -&gt; Text -&gt; m ()
</span><a href="Discord.Internal.Monad.html#respond"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164492"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164484"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><a href="Command.Error.html#DiscordError"><span class="hs-identifier hs-type">DiscordError</span></a></span><span> </span><span id="local-6989586621679164482"><span class="annot"><span class="annottext">RestCallErrorCode
</span><a href="#local-6989586621679164482"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-576"></span><span>            </span><span class="annot"><span class="annottext">Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *). MonadDiscord m =&gt; Message -&gt; Text -&gt; m ()
</span><a href="Discord.Internal.Monad.html#respond"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164492"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(SourceName -&gt; Text) -&gt; SourceName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;Discord request failed with a &quot;</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceName -&gt; SourceName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RestCallErrorCode -&gt; SourceName
forall a. Show a =&gt; a -&gt; SourceName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RestCallErrorCode
</span><a href="#local-6989586621679164482"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>        </span><span class="annot"><a href="Command.Error.html#HaskellError"><span class="hs-identifier hs-type">HaskellError</span></a></span><span> </span><span id="local-6989586621679164480"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679164480"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-578"></span><span>            </span><span class="annot"><span class="annottext">Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *). MonadDiscord m =&gt; Message -&gt; Text -&gt; m ()
</span><a href="Discord.Internal.Monad.html#respond"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164492"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Owoifier.html#owoify"><span class="hs-identifier hs-var">owoify</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(SourceName -&gt; Text) -&gt; SourceName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;Runtime error (contact OwenDev, this is a bug): &quot;</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceName -&gt; SourceName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; SourceName
forall a. Show a =&gt; a -&gt; SourceName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679164480"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">-- @CommandHandlerType@ is a dataclass for all types of arguments that a</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- command handler may have. Its only function is @applyArgs@.</span><span>
</span><span id="line-590"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679164735"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="CommandHandlerType"><span class="annot"><a href="Command.Command.html#CommandHandlerType"><span class="hs-identifier hs-var">CommandHandlerType</span></a></span></span><span> </span><span id="local-6989586621679164735"><span class="annot"><a href="#local-6989586621679164735"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679164734"><span class="annot"><a href="#local-6989586621679164734"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679164734"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164735"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-591"></span><span>    </span><span id="applyArgs"><span class="annot"><a href="Command.Command.html#applyArgs"><span class="hs-identifier hs-type">applyArgs</span></a></span></span><span>
</span><span id="line-592"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679164734"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-comment">-- ^ The handler. It must be in the same monad as @m@.</span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-comment">-- ^ The relevant message.</span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-comment">-- ^ The arguments of the command, i.e. everything after the command</span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-comment">-- name followed by one or more spaces. Is &quot;&quot; if empty.</span><span>
</span><span id="line-599"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164735"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-comment">-- ^ The monad to run the handler in, and to throw parse errors in.</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="hs-comment">-- | For the case when all arguments have been applied. Base case.</span><span>
</span><span id="line-603"></span><span id="local-6989586621679164479"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679164479"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#CommandHandlerType"><span class="hs-identifier hs-type">CommandHandlerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164479"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679164479"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621679164475"><span class="annot"><span class="annottext">applyArgs :: m () -&gt; Message -&gt; Text -&gt; m ()
</span><a href="#local-6989586621679164475"><span class="hs-identifier hs-var hs-var hs-var hs-var">applyArgs</span></a></span></span><span> </span><span id="local-6989586621679164474"><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679164474"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span id="local-6989586621679164473"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164473"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679164472"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164472"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parsec Text () () -&gt; SourceName -&gt; Text -&gt; Either ParseError ()
forall s t a.
Stream s Identity t =&gt;
Parsec s () a -&gt; SourceName -&gt; s -&gt; Either ParseError a
</span><span class="hs-identifier hs-var">parse</span></span><span> </span><span class="annot"><span class="annottext">Parsec Text () ()
forall s (m :: * -&gt; *) t u.
(Stream s m t, Show t) =&gt;
ParsecT s u m ()
</span><span class="hs-identifier hs-var">eof</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164472"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-606"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679164471"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164471"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandError -&gt; m ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(CommandError -&gt; m ()) -&gt; CommandError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; CommandError
</span><a href="Command.Error.html#ArgumentParseError"><span class="hs-identifier hs-var">ArgumentParseError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; CommandError) -&gt; Text -&gt; CommandError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-607"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Too many arguments! &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParseError -&gt; Text
</span><a href="Command.Command.html#showErrAsText"><span class="hs-identifier hs-var">showErrAsText</span></a></span><span> </span><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164471"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-608"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679164474"><span class="hs-identifier hs-var">handler</span></a></span></span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span class="hs-comment">-- | For the case where there are multiple arguments to apply. </span><span>
</span><span id="line-611"></span><span id="local-6989586621679164467"><span id="local-6989586621679164468"><span id="local-6989586621679164469"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679164469"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Parser.html#ParsableArgument"><span class="hs-identifier hs-type">ParsableArgument</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Command.html#CommandHandlerType"><span class="hs-identifier hs-type">CommandHandlerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164469"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164467"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#CommandHandlerType"><span class="hs-identifier hs-type">CommandHandlerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164469"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679164468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164467"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621679164464"><span class="annot"><span class="annottext">applyArgs :: (a -&gt; b) -&gt; Message -&gt; Text -&gt; m ()
</span><a href="#local-6989586621679164464"><span class="hs-identifier hs-var hs-var hs-var hs-var">applyArgs</span></a></span></span><span> </span><span id="local-6989586621679164463"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679164463"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span id="local-6989586621679164462"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164462"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679164461"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164461"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parsec Text () (a, Text)
-&gt; SourceName -&gt; Text -&gt; Either ParseError (a, Text)
forall s t a.
Stream s Identity t =&gt;
Parsec s () a -&gt; SourceName -&gt; s -&gt; Either ParseError a
</span><span class="hs-identifier hs-var">parse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Text -&gt; (a, Text))
-&gt; ParsecT Text () Identity a
-&gt; Parsec Text () Text
-&gt; Parsec Text () (a, Text)
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; ParsecT Text () Identity a
forall a. ParsableArgument a =&gt; Message -&gt; Parser a
</span><a href="Command.Parser.html#parserForArg"><span class="hs-identifier hs-var">parserForArg</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164462"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parsec Text () Text
forall (m :: * -&gt; *) s u. Monad m =&gt; ParsecT s u m s
</span><span class="hs-identifier hs-var">getInput</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;arguments&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164461"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-614"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679164459"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164459"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandError -&gt; m ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(CommandError -&gt; m ()) -&gt; CommandError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; CommandError
</span><a href="Command.Error.html#ArgumentParseError"><span class="hs-identifier hs-var">ArgumentParseError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; CommandError) -&gt; Text -&gt; CommandError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-615"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error while parsing argument. &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParseError -&gt; Text
</span><a href="Command.Command.html#showErrAsText"><span class="hs-identifier hs-var">showErrAsText</span></a></span><span> </span><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164459"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-616"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679164458"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679164458"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164457"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164457"><span class="hs-identifier hs-var">remaining</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) h.
CommandHandlerType m h =&gt;
h -&gt; Message -&gt; Text -&gt; m ()
</span><a href="Command.Command.html#applyArgs"><span class="hs-identifier hs-var">applyArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679164463"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679164458"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164462"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164457"><span class="hs-identifier hs-var">remaining</span></a></span></span></span></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">-- | For the case where there is only one argument to apply.</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- It overlaps the previous instance (it is more specific). With the OVERLAPPING</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- pragma, GHC prefers this one when both match.</span><span>
</span><span id="line-621"></span><span class="hs-comment">--</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- This instance is necessary because otherwise @Message -&gt; m ()@ will match</span><span>
</span><span id="line-623"></span><span class="hs-comment">-- both @m ()@ (@(-&gt;) r@ is a monad) and @a -&gt; b@ and since neither are more</span><span>
</span><span id="line-624"></span><span class="hs-comment">-- specific, GHC cannot prefer one over the other, even with any pragmas.</span><span>
</span><span id="line-625"></span><span id="local-6989586621679164455"><span id="local-6989586621679164456"><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679164456"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Command.Parser.html#ParsableArgument"><span class="hs-identifier hs-type">ParsableArgument</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164455"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Command.Command.html#CommandHandlerType"><span class="hs-identifier hs-type">CommandHandlerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164456"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679164455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679164456"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-626"></span><span>    </span><span id="local-6989586621679164452"><span class="annot"><span class="annottext">applyArgs :: (a -&gt; m ()) -&gt; Message -&gt; Text -&gt; m ()
</span><a href="#local-6989586621679164452"><span class="hs-identifier hs-var hs-var hs-var hs-var">applyArgs</span></a></span></span><span> </span><span id="local-6989586621679164451"><span class="annot"><span class="annottext">a -&gt; m ()
</span><a href="#local-6989586621679164451"><span class="hs-identifier hs-var">handler</span></a></span></span><span> </span><span id="local-6989586621679164450"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164450"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679164449"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164449"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-627"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parsec Text () (a, Text)
-&gt; SourceName -&gt; Text -&gt; Either ParseError (a, Text)
forall s t a.
Stream s Identity t =&gt;
Parsec s () a -&gt; SourceName -&gt; s -&gt; Either ParseError a
</span><span class="hs-identifier hs-var">parse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Text -&gt; (a, Text))
-&gt; ParsecT Text () Identity a
-&gt; Parsec Text () Text
-&gt; Parsec Text () (a, Text)
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; ParsecT Text () Identity a
forall a. ParsableArgument a =&gt; Message -&gt; Parser a
</span><a href="Command.Parser.html#parserForArg"><span class="hs-identifier hs-var">parserForArg</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164450"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parsec Text () Text
forall (m :: * -&gt; *) s u. Monad m =&gt; ParsecT s u m s
</span><span class="hs-identifier hs-var">getInput</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;arguments&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164449"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-628"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679164448"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164448"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CommandError -&gt; m ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwM</span></span><span> </span><span class="annot"><span class="annottext">(CommandError -&gt; m ()) -&gt; CommandError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; CommandError
</span><a href="Command.Error.html#ArgumentParseError"><span class="hs-identifier hs-var">ArgumentParseError</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; CommandError) -&gt; Text -&gt; CommandError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-629"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error while parsing argument. &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ParseError -&gt; Text
</span><a href="Command.Command.html#showErrAsText"><span class="hs-identifier hs-var">showErrAsText</span></a></span><span> </span><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164448"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-630"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679164447"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679164447"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679164446"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164446"><span class="hs-identifier hs-var">remaining</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; Message -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) h.
CommandHandlerType m h =&gt;
h -&gt; Message -&gt; Text -&gt; m ()
</span><a href="Command.Command.html#applyArgs"><span class="hs-identifier hs-var">applyArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; m ()
</span><a href="#local-6989586621679164451"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679164447"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679164450"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679164446"><span class="hs-identifier hs-var">remaining</span></a></span></span></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="hs-comment">-- The default 'Show' instance for ParseError contains the error position,</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- which only adds clutter in a Discord message. This defines a much</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- simpler string representation.</span><span>
</span><span id="line-635"></span><span class="annot"><a href="Command.Command.html#showErrAsText"><span class="hs-identifier hs-type">showErrAsText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ParseError</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-636"></span><span id="showErrAsText"><span class="annot"><span class="annottext">showErrAsText :: ParseError -&gt; Text
</span><a href="Command.Command.html#showErrAsText"><span class="hs-identifier hs-var hs-var">showErrAsText</span></a></span></span><span> </span><span id="local-6989586621679164445"><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164445"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.tail</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(SourceName -&gt; Text) -&gt; SourceName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; SourceName
-&gt; SourceName
-&gt; SourceName
-&gt; SourceName
-&gt; [Message]
-&gt; SourceName
</span><span class="hs-identifier hs-var">showErrorMessages</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;or&quot;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;unknown parse error&quot;</span></span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;Expecting&quot;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;Unexpected&quot;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><span class="hs-string">&quot;end of message&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParseError -&gt; [Message]
</span><span class="hs-identifier hs-var">errorMessages</span></span><span> </span><span class="annot"><span class="annottext">ParseError
</span><a href="#local-6989586621679164445"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="hs-comment">-- | @parseCommandName@ returns a parser that tries to consume the prefix,</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- Command name, appropriate amount of spaces, and returns the arguments.</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- If there are no arguments, it will return the empty text, &quot;&quot;.</span><span>
</span><span id="line-642"></span><span id="local-6989586621679164736"><span class="annot"><a href="Command.Command.html#parseCommandName"><span class="hs-identifier hs-type">parseCommandName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Command.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679164736"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span><span>
</span><span id="line-643"></span><span id="parseCommandName"><span class="annot"><span class="annottext">parseCommandName :: Command m -&gt; Parsec Text () Text
</span><a href="Command.Command.html#parseCommandName"><span class="hs-identifier hs-var hs-var">parseCommandName</span></a></span></span><span> </span><span id="local-6989586621679164443"><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164443"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>    </span><span class="hs-comment">-- consume prefix</span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><span class="annottext">SourceName -&gt; Parser SourceName
forall s (m :: * -&gt; *) u.
Stream s m Char =&gt;
SourceName -&gt; ParsecT s u m SourceName
</span><span class="hs-identifier hs-var">string</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SourceName
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SourceName) -&gt; Text -&gt; SourceName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Command m -&gt; Text
forall (m :: * -&gt; *). Command m -&gt; Text
</span><a href="Command.Command.html#commandPrefix"><span class="hs-identifier hs-var hs-var">commandPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164443"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-comment">-- consume at least 1 character until a space is encountered</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-comment">-- don't consume the space</span><span>
</span><span id="line-648"></span><span>    </span><span id="local-6989586621679164442"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679164442"><span class="hs-identifier hs-var">cmdName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char
-&gt; Parsec Text () () -&gt; Parser SourceName
forall s (m :: * -&gt; *) t u a end.
Stream s m t =&gt;
ParsecT s u m a -&gt; ParsecT s u m end -&gt; ParsecT s u m [a]
</span><a href="Command.Parser.html#manyTill1"><span class="hs-identifier hs-var">manyTill1</span></a></span><span> </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char
forall s (m :: * -&gt; *) u. Stream s m Char =&gt; ParsecT s u m Char
</span><span class="hs-identifier hs-var">anyChar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsecT Text () Identity Char -&gt; Parsec Text () ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParsecT Text () Identity Char -&gt; ParsecT Text () Identity Char
forall s (m :: * -&gt; *) t u a.
Stream s m t =&gt;
ParsecT s u m a -&gt; ParsecT s u m a
</span><span class="hs-identifier hs-var">lookAhead</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char
forall s (m :: * -&gt; *) u. Stream s m Char =&gt; ParsecT s u m Char
</span><span class="hs-identifier hs-var">space</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parsec Text () () -&gt; Parsec Text () () -&gt; Parsec Text () ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parsec Text () ()
forall s (m :: * -&gt; *) t u.
(Stream s m t, Show t) =&gt;
ParsecT s u m ()
</span><span class="hs-identifier hs-var">eof</span></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-comment">-- check it's the proper command</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Parsec Text () ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Parsec Text () ()) -&gt; Bool -&gt; Parsec Text () ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679164442"><span class="hs-identifier hs-var">cmdName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Command m -&gt; Text
forall (m :: * -&gt; *). Command m -&gt; Text
</span><a href="Command.Command.html#commandName"><span class="hs-identifier hs-var hs-var">commandName</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164443"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; [Text]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Command m -&gt; [Text]
forall (m :: * -&gt; *). Command m -&gt; [Text]
</span><a href="Command.Command.html#commandAliases"><span class="hs-identifier hs-var hs-var">commandAliases</span></a></span><span> </span><span class="annot"><span class="annottext">Command m
</span><a href="#local-6989586621679164443"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>    </span><span class="hs-comment">-- parse either an end of input, or spaces followed by arguments</span><span>
</span><span id="line-652"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parsec Text () ()
forall s (m :: * -&gt; *) t u.
(Stream s m t, Show t) =&gt;
ParsecT s u m ()
</span><span class="hs-identifier hs-var">eof</span></span><span> </span><span class="annot"><span class="annottext">Parsec Text () () -&gt; Parsec Text () Text -&gt; Parsec Text () Text
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Parsec Text () Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parsec Text () Text -&gt; Parsec Text () Text -&gt; Parsec Text () Text
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-comment">-- consumes one or more isSpace characters</span><span>
</span><span id="line-654"></span><span>        </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char -&gt; Parser SourceName
forall s (m :: * -&gt; *) t u a.
Stream s m t =&gt;
ParsecT s u m a -&gt; ParsecT s u m [a]
</span><span class="hs-identifier hs-var">many1</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char
forall s (m :: * -&gt; *) u. Stream s m Char =&gt; ParsecT s u m Char
</span><span class="hs-identifier hs-var">space</span></span><span>
</span><span id="line-655"></span><span>        </span><span class="hs-comment">-- consume everything until end of input</span><span>
</span><span id="line-656"></span><span>        </span><span id="local-6989586621679164437"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679164437"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char
-&gt; Parsec Text () () -&gt; Parser SourceName
forall s (m :: * -&gt; *) t u a end.
Stream s m t =&gt;
ParsecT s u m a -&gt; ParsecT s u m end -&gt; ParsecT s u m [a]
</span><span class="hs-identifier hs-var">manyTill</span></span><span> </span><span class="annot"><span class="annottext">ParsecT Text () Identity Char
forall s (m :: * -&gt; *) u. Stream s m Char =&gt; ParsecT s u m Char
</span><span class="hs-identifier hs-var">anyChar</span></span><span> </span><span class="annot"><span class="annottext">Parsec Text () ()
forall s (m :: * -&gt; *) t u.
(Stream s m t, Show t) =&gt;
ParsecT s u m ()
</span><span class="hs-identifier hs-var">eof</span></span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-comment">-- return the args</span><span>
</span><span id="line-658"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Parsec Text () Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621679164437"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span></pre></body></html>