<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Provide HTTP primitives</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Discord.Internal.Rest.HTTP</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#restLoop"><span class="hs-identifier">restLoop</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#Request"><span class="hs-identifier">Request</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#JsonRequest"><span class="hs-identifier">JsonRequest</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalException"><span class="hs-identifier">RestCallInternalException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">log</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception.Safe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Chan</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ix</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">inRange</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.POSIX</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">POSIXTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getPOSIXTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TE</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Req</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Discord.Internal.Types.html"><span class="hs-identifier">Discord.Internal.Types</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html"><span class="hs-identifier">Discord.Internal.Rest.Prelude</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">data</span><span> </span><span id="RestCallInternalException"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalException"><span class="hs-identifier hs-var">RestCallInternalException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RestCallInternalErrorCode"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalErrorCode"><span class="hs-identifier hs-var">RestCallInternalErrorCode</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-35"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span id="RestCallInternalNoParse"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalNoParse"><span class="hs-identifier hs-var">RestCallInternalNoParse</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span>
</span><span id="line-36"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span id="RestCallInternalHttpException"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalHttpException"><span class="hs-identifier hs-var">RestCallInternalHttpException</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.HttpException</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679166597"><span id="local-6989586621679166599"><span id="local-6989586621679166601"><span class="annot"><span class="annottext">Int -&gt; RestCallInternalException -&gt; ShowS
[RestCallInternalException] -&gt; ShowS
RestCallInternalException -&gt; String
(Int -&gt; RestCallInternalException -&gt; ShowS)
-&gt; (RestCallInternalException -&gt; String)
-&gt; ([RestCallInternalException] -&gt; ShowS)
-&gt; Show RestCallInternalException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RestCallInternalException] -&gt; ShowS
$cshowList :: [RestCallInternalException] -&gt; ShowS
show :: RestCallInternalException -&gt; String
$cshow :: RestCallInternalException -&gt; String
showsPrec :: Int -&gt; RestCallInternalException -&gt; ShowS
$cshowsPrec :: Int -&gt; RestCallInternalException -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#restLoop"><span class="hs-identifier hs-type">restLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Discord.Internal.Types.Prelude.html#Auth"><span class="hs-identifier hs-type">Auth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Chan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#JsonRequest"><span class="hs-identifier hs-type">JsonRequest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalException"><span class="hs-identifier hs-type">RestCallInternalException</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Chan</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span id="restLoop"><span class="annot"><span class="annottext">restLoop :: Auth
-&gt; Chan
     (String, JsonRequest,
      MVar (Either RestCallInternalException ByteString))
-&gt; Chan Text
-&gt; IO ()
</span><a href="Discord.Internal.Rest.HTTP.html#restLoop"><span class="hs-identifier hs-var hs-var">restLoop</span></a></span></span><span> </span><span id="local-6989586621679166595"><span class="annot"><span class="annottext">Auth
</span><a href="#local-6989586621679166595"><span class="hs-identifier hs-var">auth</span></a></span></span><span> </span><span id="local-6989586621679166594"><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
</span><a href="#local-6989586621679166594"><span class="hs-identifier hs-var">urls</span></a></span></span><span> </span><span id="local-6989586621679166593"><span class="annot"><span class="annottext">Chan Text
</span><a href="#local-6989586621679166593"><span class="hs-identifier hs-var">log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; IO ()
forall b. Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>  </span><span id="local-6989586621679166592"><span class="annot"><span class="annottext">loop :: Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679166590"><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679166588"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166588"><span class="hs-identifier hs-var">route</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679166587"><span class="annot"><span class="annottext">JsonRequest
</span><a href="#local-6989586621679166587"><span class="hs-identifier hs-var">request</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679166586"><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
-&gt; IO
     (String, JsonRequest,
      MVar (Either RestCallInternalException ByteString))
forall a. Chan a -&gt; IO a
</span><span class="hs-identifier hs-var">readChan</span></span><span> </span><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
</span><a href="#local-6989586621679166594"><span class="hs-identifier hs-var">urls</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span id="local-6989586621679166584"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166584"><span class="hs-identifier hs-var">curtime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO POSIXTime
</span><span class="hs-identifier hs-var">getPOSIXTime</span></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; String -&gt; POSIXTime -&gt; RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#compareRate"><span class="hs-identifier hs-var">compareRate</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166588"><span class="hs-identifier hs-var">route</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166584"><span class="hs-identifier hs-var">curtime</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-48"></span><span>      </span><span class="annot"><span class="annottext">RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#Locked"><span class="hs-identifier hs-var">Locked</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
-&gt; (String, JsonRequest,
    MVar (Either RestCallInternalException ByteString))
-&gt; IO ()
forall a. Chan a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeChan</span></span><span> </span><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
</span><a href="#local-6989586621679166594"><span class="hs-identifier hs-var">urls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166588"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JsonRequest
</span><a href="#local-6989586621679166587"><span class="hs-identifier hs-var">request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>                   </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span><span>
</span><span id="line-50"></span><span>      </span><span class="annot"><span class="annottext">RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#Available"><span class="hs-identifier hs-var">Available</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679166579"><span class="annot"><span class="annottext">action :: RestIO LbsResponse
</span><a href="#local-6989586621679166579"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Auth -&gt; JsonRequest -&gt; RestIO LbsResponse
</span><a href="Discord.Internal.Rest.HTTP.html#compileRequest"><span class="hs-identifier hs-var">compileRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Auth
</span><a href="#local-6989586621679166595"><span class="hs-identifier hs-var">auth</span></a></span><span> </span><span class="annot"><span class="annottext">JsonRequest
</span><a href="#local-6989586621679166587"><span class="hs-identifier hs-var">request</span></a></span><span>
</span><span id="line-51"></span><span>                      </span><span id="local-6989586621679166577"><span class="annot"><span class="annottext">Either HttpException (RequestResponse, Timeout)
</span><a href="#local-6989586621679166577"><span class="hs-identifier hs-var">reqIO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (RequestResponse, Timeout)
-&gt; IO (Either HttpException (RequestResponse, Timeout))
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO (RequestResponse, Timeout)
 -&gt; IO (Either HttpException (RequestResponse, Timeout)))
-&gt; IO (RequestResponse, Timeout)
-&gt; IO (Either HttpException (RequestResponse, Timeout))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RestIO (RequestResponse, Timeout) -&gt; IO (RequestResponse, Timeout)
forall a. RestIO a -&gt; IO a
</span><a href="Discord.Internal.Rest.Prelude.html#restIOtoIO"><span class="hs-identifier hs-var hs-var">restIOtoIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Chan Text
-&gt; RestIO LbsResponse -&gt; RestIO (RequestResponse, Timeout)
</span><a href="Discord.Internal.Rest.HTTP.html#tryRequest"><span class="hs-identifier hs-var">tryRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Chan Text
</span><a href="#local-6989586621679166593"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="annot"><span class="annottext">RestIO LbsResponse
</span><a href="#local-6989586621679166579"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either HttpException (RequestResponse, Timeout)
</span><a href="#local-6989586621679166577"><span class="hs-identifier hs-var">reqIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.HttpException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RequestResponse"><span class="hs-identifier hs-type">RequestResponse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#Timeout"><span class="hs-identifier hs-type">Timeout</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-53"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679166574"><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621679166574"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-54"></span><span>                          </span><span class="annot"><span class="annottext">Chan Text -&gt; Text -&gt; IO ()
forall a. Chan a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeChan</span></span><span> </span><span class="annot"><span class="annottext">Chan Text
</span><a href="#local-6989586621679166593"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rest - http exception &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpException -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621679166574"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>                          </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
-&gt; Either RestCallInternalException ByteString -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RestCallInternalException
-&gt; Either RestCallInternalException ByteString
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpException -&gt; RestCallInternalException
</span><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalHttpException"><span class="hs-identifier hs-var">RestCallInternalHttpException</span></a></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621679166574"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>                          </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span><span>
</span><span id="line-57"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679166570"><span class="annot"><span class="annottext">RequestResponse
</span><a href="#local-6989586621679166570"><span class="hs-identifier hs-var">resp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679166569"><span class="annot"><span class="annottext">Timeout
</span><a href="#local-6989586621679166569"><span class="hs-identifier hs-var">retry</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>                          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RequestResponse
</span><a href="#local-6989586621679166570"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-59"></span><span>                            </span><span class="hs-comment">-- decode &quot;[]&quot; == () for expected empty calls</span><span>
</span><span id="line-60"></span><span>                            </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#ResponseByteString"><span class="hs-identifier hs-type">ResponseByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
-&gt; Either RestCallInternalException ByteString -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either RestCallInternalException ByteString
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;[]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>                            </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#ResponseByteString"><span class="hs-identifier hs-type">ResponseByteString</span></a></span><span> </span><span id="local-6989586621679166567"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166567"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
-&gt; Either RestCallInternalException ByteString -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either RestCallInternalException ByteString
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166567"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>                            </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#ResponseErrorCode"><span class="hs-identifier hs-type">ResponseErrorCode</span></a></span><span> </span><span id="local-6989586621679166565"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166565"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679166564"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166564"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679166563"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166563"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-63"></span><span>                              </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
-&gt; Either RestCallInternalException ByteString -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RestCallInternalException
-&gt; Either RestCallInternalException ByteString
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString -&gt; RestCallInternalException
</span><a href="Discord.Internal.Rest.HTTP.html#RestCallInternalErrorCode"><span class="hs-identifier hs-var">RestCallInternalErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166565"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166564"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166563"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>                            </span><span class="annot"><span class="annottext">RequestResponse
</span><a href="Discord.Internal.Rest.HTTP.html#ResponseTryAgain"><span class="hs-identifier hs-var">ResponseTryAgain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
-&gt; (String, JsonRequest,
    MVar (Either RestCallInternalException ByteString))
-&gt; IO ()
forall a. Chan a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeChan</span></span><span> </span><span class="annot"><span class="annottext">Chan
  (String, JsonRequest,
   MVar (Either RestCallInternalException ByteString))
</span><a href="#local-6989586621679166594"><span class="hs-identifier hs-var">urls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166588"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">JsonRequest
</span><a href="#local-6989586621679166587"><span class="hs-identifier hs-var">request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MVar (Either RestCallInternalException ByteString)
</span><a href="#local-6989586621679166586"><span class="hs-identifier hs-var">thread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>                          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Timeout
</span><a href="#local-6989586621679166569"><span class="hs-identifier hs-var">retry</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-66"></span><span>                            </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#GlobalWait"><span class="hs-identifier hs-type">GlobalWait</span></a></span><span> </span><span id="local-6989586621679166560"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166560"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-67"></span><span>                                </span><span class="annot"><span class="annottext">Chan Text -&gt; Text -&gt; IO ()
forall a. Chan a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeChan</span></span><span> </span><span class="annot"><span class="annottext">Chan Text
</span><a href="#local-6989586621679166593"><span class="hs-identifier hs-var">log</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;rest - GLOBAL WAIT LIMIT: &quot;</span></span><span>
</span><span id="line-68"></span><span>                                                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166560"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166584"><span class="hs-identifier hs-var">curtime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>                                </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166560"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166584"><span class="hs-identifier hs-var">curtime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>                                </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span><span>
</span><span id="line-71"></span><span>                            </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#PathWait"><span class="hs-identifier hs-type">PathWait</span></a></span><span> </span><span id="local-6989586621679166556"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166556"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Map String POSIXTime -&gt; IO b) -&gt; Map String POSIXTime -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; POSIXTime -&gt; Map String POSIXTime -&gt; Map String POSIXTime
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166588"><span class="hs-identifier hs-var">route</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166556"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; POSIXTime -&gt; Map String POSIXTime
</span><a href="Discord.Internal.Rest.HTTP.html#removeAllExpire"><span class="hs-identifier hs-var">removeAllExpire</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166584"><span class="hs-identifier hs-var">curtime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>                            </span><span class="annot"><span class="annottext">Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; IO b
</span><a href="#local-6989586621679166592"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166590"><span class="hs-identifier hs-var">ratelocker</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">data</span><span> </span><span id="RateLimited"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RateLimited"><span class="hs-identifier hs-var">RateLimited</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Available"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#Available"><span class="hs-identifier hs-var">Available</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Locked"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#Locked"><span class="hs-identifier hs-var">Locked</span></a></span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#compareRate"><span class="hs-identifier hs-type">compareRate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RateLimited"><span class="hs-identifier hs-type">RateLimited</span></a></span><span>
</span><span id="line-77"></span><span id="compareRate"><span class="annot"><span class="annottext">compareRate :: Map String POSIXTime -&gt; String -&gt; POSIXTime -&gt; RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#compareRate"><span class="hs-identifier hs-var hs-var">compareRate</span></a></span></span><span> </span><span id="local-6989586621679166552"><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166552"><span class="hs-identifier hs-var">ratelocker</span></a></span></span><span> </span><span id="local-6989586621679166551"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166551"><span class="hs-identifier hs-var">route</span></a></span></span><span> </span><span id="local-6989586621679166550"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166550"><span class="hs-identifier hs-var">curtime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String -&gt; Map String POSIXTime -&gt; Maybe POSIXTime
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679166551"><span class="hs-identifier hs-var">route</span></a></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166552"><span class="hs-identifier hs-var">ratelocker</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679166548"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166548"><span class="hs-identifier hs-var">unlockTime</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166550"><span class="hs-identifier hs-var">curtime</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166548"><span class="hs-identifier hs-var">unlockTime</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#Locked"><span class="hs-identifier hs-var">Locked</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#Available"><span class="hs-identifier hs-var">Available</span></a></span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">Maybe POSIXTime
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RateLimited
</span><a href="Discord.Internal.Rest.HTTP.html#Available"><span class="hs-identifier hs-var">Available</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#removeAllExpire"><span class="hs-identifier hs-type">removeAllExpire</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span>
</span><span id="line-83"></span><span id="removeAllExpire"><span class="annot"><span class="annottext">removeAllExpire :: Map String POSIXTime -&gt; POSIXTime -&gt; Map String POSIXTime
</span><a href="Discord.Internal.Rest.HTTP.html#removeAllExpire"><span class="hs-identifier hs-var hs-var">removeAllExpire</span></a></span></span><span> </span><span id="local-6989586621679166546"><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166546"><span class="hs-identifier hs-var">ratelocker</span></a></span></span><span> </span><span id="local-6989586621679166545"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166545"><span class="hs-identifier hs-var">curtime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">M.size</span></span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166546"><span class="hs-identifier hs-var">ratelocker</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; Bool) -&gt; Map String POSIXTime -&gt; Map String POSIXTime
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166545"><span class="hs-identifier hs-var">curtime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166546"><span class="hs-identifier hs-var">ratelocker</span></a></span><span>
</span><span id="line-85"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Map String POSIXTime
</span><a href="#local-6989586621679166546"><span class="hs-identifier hs-var">ratelocker</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">data</span><span> </span><span id="RequestResponse"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RequestResponse"><span class="hs-identifier hs-var">RequestResponse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ResponseTryAgain"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#ResponseTryAgain"><span class="hs-identifier hs-var">ResponseTryAgain</span></a></span></span><span>
</span><span id="line-88"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="ResponseByteString"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#ResponseByteString"><span class="hs-identifier hs-var">ResponseByteString</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span>
</span><span id="line-89"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="ResponseErrorCode"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#ResponseErrorCode"><span class="hs-identifier hs-var">ResponseErrorCode</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679166536"><span id="local-6989586621679166538"><span id="local-6989586621679166540"><span class="annot"><span class="annottext">Int -&gt; RequestResponse -&gt; ShowS
[RequestResponse] -&gt; ShowS
RequestResponse -&gt; String
(Int -&gt; RequestResponse -&gt; ShowS)
-&gt; (RequestResponse -&gt; String)
-&gt; ([RequestResponse] -&gt; ShowS)
-&gt; Show RequestResponse
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RequestResponse] -&gt; ShowS
$cshowList :: [RequestResponse] -&gt; ShowS
show :: RequestResponse -&gt; String
$cshow :: RequestResponse -&gt; String
showsPrec :: Int -&gt; RequestResponse -&gt; ShowS
$cshowsPrec :: Int -&gt; RequestResponse -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">data</span><span> </span><span id="Timeout"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#Timeout"><span class="hs-identifier hs-var">Timeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="GlobalWait"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#GlobalWait"><span class="hs-identifier hs-var">GlobalWait</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span>
</span><span id="line-93"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="PathWait"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#PathWait"><span class="hs-identifier hs-var">PathWait</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span>
</span><span id="line-94"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="NoLimit"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#tryRequest"><span class="hs-identifier hs-type">tryRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Chan</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#RestIO"><span class="hs-identifier hs-type">RestIO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.LbsResponse</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#RestIO"><span class="hs-identifier hs-type">RestIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#RequestResponse"><span class="hs-identifier hs-type">RequestResponse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#Timeout"><span class="hs-identifier hs-type">Timeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="tryRequest"><span class="annot"><span class="annottext">tryRequest :: Chan Text
-&gt; RestIO LbsResponse -&gt; RestIO (RequestResponse, Timeout)
</span><a href="Discord.Internal.Rest.HTTP.html#tryRequest"><span class="hs-identifier hs-var hs-var">tryRequest</span></a></span></span><span> </span><span id="local-6989586621679166535"><span class="annot"><span class="annottext">Chan Text
</span><a href="#local-6989586621679166535"><span class="hs-identifier hs-var">_log</span></a></span></span><span> </span><span id="local-6989586621679166534"><span class="annot"><span class="annottext">RestIO LbsResponse
</span><a href="#local-6989586621679166534"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621679166533"><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RestIO LbsResponse
</span><a href="#local-6989586621679166534"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621679166532"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166532"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO POSIXTime -&gt; RestIO POSIXTime
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO POSIXTime
</span><span class="hs-identifier hs-var">getPOSIXTime</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679166531"><span class="annot"><span class="annottext">body :: HttpResponseBody LbsResponse
</span><a href="#local-6989586621679166531"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LbsResponse -&gt; HttpResponseBody LbsResponse
forall response.
HttpResponse response =&gt;
response -&gt; HttpResponseBody response
</span><span class="hs-identifier hs-var">R.responseBody</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span id="local-6989586621679166529"><span class="annot"><span class="annottext">code :: Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LbsResponse -&gt; Int
forall response. HttpResponse response =&gt; response -&gt; Int
</span><span class="hs-identifier hs-var">R.responseStatusCode</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span id="local-6989586621679166527"><span class="annot"><span class="annottext">status :: ByteString
</span><a href="#local-6989586621679166527"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LbsResponse -&gt; ByteString
forall response. HttpResponse response =&gt; response -&gt; ByteString
</span><span class="hs-identifier hs-var">R.responseStatusMessage</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span id="local-6989586621679166525"><span class="annot"><span class="annottext">global :: Bool
</span><a href="#local-6989586621679166525"><span class="hs-identifier hs-var hs-var">global</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;true&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Maybe String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; Bool) -&gt; Maybe String -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe String
forall a. Read a =&gt; ByteString -&gt; Maybe a
</span><a href="Discord.Internal.Rest.HTTP.html#readMaybeBS"><span class="hs-identifier hs-var">readMaybeBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe String) -&gt; Maybe ByteString -&gt; Maybe String
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse -&gt; ByteString -&gt; Maybe ByteString
forall response.
HttpResponse response =&gt;
response -&gt; ByteString -&gt; Maybe ByteString
</span><span class="hs-identifier hs-var">R.responseHeader</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;X-RateLimit-Global&quot;</span></span><span>
</span><span id="line-104"></span><span>      </span><span id="local-6989586621679166521"><span class="annot"><span class="annottext">remain :: Integer
</span><a href="#local-6989586621679166521"><span class="hs-identifier hs-var hs-var">remain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer -&gt; Integer
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Integer -&gt; Integer) -&gt; Maybe Integer -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Integer
forall a. Read a =&gt; ByteString -&gt; Maybe a
</span><a href="Discord.Internal.Rest.HTTP.html#readMaybeBS"><span class="hs-identifier hs-var">readMaybeBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe Integer) -&gt; Maybe ByteString -&gt; Maybe Integer
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse -&gt; ByteString -&gt; Maybe ByteString
forall response.
HttpResponse response =&gt;
response -&gt; ByteString -&gt; Maybe ByteString
</span><span class="hs-identifier hs-var">R.responseHeader</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;X-RateLimit-Remaining&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-105"></span><span>      </span><span id="local-6989586621679166520"><span class="annot"><span class="annottext">reset :: POSIXTime
</span><a href="#local-6989586621679166520"><span class="hs-identifier hs-var hs-var">reset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; POSIXTime
</span><a href="#local-6989586621679166519"><span class="hs-identifier hs-var">withDelta</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; POSIXTime)
-&gt; (Maybe Double -&gt; Double) -&gt; Maybe Double -&gt; POSIXTime
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Maybe Double -&gt; Double
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Double -&gt; POSIXTime) -&gt; Maybe Double -&gt; POSIXTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Double
forall a. Read a =&gt; ByteString -&gt; Maybe a
</span><a href="Discord.Internal.Rest.HTTP.html#readMaybeBS"><span class="hs-identifier hs-var">readMaybeBS</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe Double) -&gt; Maybe ByteString -&gt; Maybe Double
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse -&gt; ByteString -&gt; Maybe ByteString
forall response.
HttpResponse response =&gt;
response -&gt; ByteString -&gt; Maybe ByteString
</span><span class="hs-identifier hs-var">R.responseHeader</span></span><span> </span><span class="annot"><span class="annottext">LbsResponse
</span><a href="#local-6989586621679166533"><span class="hs-identifier hs-var">resp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;X-RateLimit-Reset-After&quot;</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><a href="#local-6989586621679166519"><span class="hs-identifier hs-type">withDelta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621679166519"><span class="annot"><span class="annottext">withDelta :: Double -&gt; POSIXTime
</span><a href="#local-6989586621679166519"><span class="hs-identifier hs-var hs-var">withDelta</span></a></span></span><span> </span><span id="local-6989586621679166517"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679166517"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166532"><span class="hs-identifier hs-var">now</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; POSIXTime
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Rational
forall a. Real a =&gt; a -&gt; Rational
</span><span class="hs-identifier hs-var">toRational</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679166517"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">429</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RequestResponse, Timeout) -&gt; RestIO (RequestResponse, Timeout)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestResponse
</span><a href="Discord.Internal.Rest.HTTP.html#ResponseTryAgain"><span class="hs-identifier hs-var">ResponseTryAgain</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679166525"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#GlobalWait"><span class="hs-identifier hs-var">GlobalWait</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166520"><span class="hs-identifier hs-var">reset</span></a></span><span>
</span><span id="line-111"></span><span>                                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#PathWait"><span class="hs-identifier hs-var">PathWait</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166520"><span class="hs-identifier hs-var">reset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">502</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RequestResponse, Timeout) -&gt; RestIO (RequestResponse, Timeout)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestResponse
</span><a href="Discord.Internal.Rest.HTTP.html#ResponseTryAgain"><span class="hs-identifier hs-var">ResponseTryAgain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">299</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RequestResponse, Timeout) -&gt; RestIO (RequestResponse, Timeout)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RequestResponse
</span><a href="Discord.Internal.Rest.HTTP.html#ResponseByteString"><span class="hs-identifier hs-var">ResponseByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166531"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-114"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679166521"><span class="hs-identifier hs-var">remain</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#PathWait"><span class="hs-identifier hs-var">PathWait</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166520"><span class="hs-identifier hs-var">reset</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Int -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">400</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">499</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RequestResponse, Timeout) -&gt; RestIO (RequestResponse, Timeout)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString -&gt; RequestResponse
</span><a href="Discord.Internal.Rest.HTTP.html#ResponseErrorCode"><span class="hs-identifier hs-var">ResponseErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166527"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166531"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679166521"><span class="hs-identifier hs-var">remain</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#PathWait"><span class="hs-identifier hs-var">PathWait</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679166520"><span class="hs-identifier hs-var">reset</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RequestResponse, Timeout) -&gt; RestIO (RequestResponse, Timeout)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString -&gt; RequestResponse
</span><a href="Discord.Internal.Rest.HTTP.html#ResponseErrorCode"><span class="hs-identifier hs-var">ResponseErrorCode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679166529"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166527"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BL.toStrict</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679166531"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Timeout
</span><a href="Discord.Internal.Rest.HTTP.html#NoLimit"><span class="hs-identifier hs-var">NoLimit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span id="local-6989586621679166659"><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#readMaybeBS"><span class="hs-identifier hs-type">readMaybeBS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Read</span></span><span> </span><span class="annot"><a href="#local-6989586621679166659"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">B.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679166659"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-120"></span><span id="readMaybeBS"><span class="annot"><span class="annottext">readMaybeBS :: ByteString -&gt; Maybe a
</span><a href="Discord.Internal.Rest.HTTP.html#readMaybeBS"><span class="hs-identifier hs-var hs-var">readMaybeBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe a
forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe a)
-&gt; (ByteString -&gt; String) -&gt; ByteString -&gt; Maybe a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">TE.decodeUtf8</span></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="Discord.Internal.Rest.HTTP.html#compileRequest"><span class="hs-identifier hs-type">compileRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Discord.Internal.Types.Prelude.html#Auth"><span class="hs-identifier hs-type">Auth</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#JsonRequest"><span class="hs-identifier hs-type">JsonRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#RestIO"><span class="hs-identifier hs-type">RestIO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.LbsResponse</span></span><span>
</span><span id="line-123"></span><span id="compileRequest"><span class="annot"><span class="annottext">compileRequest :: Auth -&gt; JsonRequest -&gt; RestIO LbsResponse
</span><a href="Discord.Internal.Rest.HTTP.html#compileRequest"><span class="hs-identifier hs-var hs-var">compileRequest</span></a></span></span><span> </span><span id="local-6989586621679166512"><span class="annot"><span class="annottext">Auth
</span><a href="#local-6989586621679166512"><span class="hs-identifier hs-var">auth</span></a></span></span><span> </span><span id="local-6989586621679166511"><span class="annot"><span class="annottext">JsonRequest
</span><a href="#local-6989586621679166511"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RestIO LbsResponse
</span><a href="#local-6989586621679166510"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679166509"><span class="annot"><span class="annottext">authopt :: Option 'Https
</span><a href="#local-6989586621679166509"><span class="hs-identifier hs-var hs-var">authopt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Auth -&gt; Option 'Https
</span><a href="Discord.Internal.Rest.Prelude.html#authHeader"><span class="hs-identifier hs-var">authHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Auth
</span><a href="#local-6989586621679166512"><span class="hs-identifier hs-var">auth</span></a></span><span> </span><span class="annot"><span class="annottext">Option 'Https -&gt; Option 'Https -&gt; Option 'Https
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Option 'Https
forall (scheme :: Scheme).
ByteString -&gt; ByteString -&gt; Option scheme
</span><span class="hs-identifier hs-var">R.header</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;X-RateLimit-Precision&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;millisecond&quot;</span></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621679166510"><span class="annot"><span class="annottext">action :: RestIO LbsResponse
</span><a href="#local-6989586621679166510"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">JsonRequest
</span><a href="#local-6989586621679166511"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span id="local-6989586621679166505"><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166505"><span class="hs-identifier hs-var">url</span></a></span></span><span>      </span><span id="local-6989586621679166504"><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166504"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DELETE
-&gt; Url 'Https
-&gt; NoReqBody
-&gt; Proxy LbsResponse
-&gt; Option 'Https
-&gt; RestIO LbsResponse
forall (m :: * -&gt; *) method body response (scheme :: Scheme).
(MonadHttp m, HttpMethod method, HttpBody body,
 HttpResponse response,
 HttpBodyAllowed (AllowsBody method) (ProvidesBody body)) =&gt;
method
-&gt; Url scheme
-&gt; body
-&gt; Proxy response
-&gt; Option scheme
-&gt; m response
</span><span class="hs-identifier hs-var">R.req</span></span><span> </span><span class="annot"><span class="annottext">DELETE
</span><span class="hs-identifier hs-var">R.DELETE</span></span><span> </span><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166505"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">NoReqBody
</span><span class="hs-identifier hs-var">R.NoReqBody</span></span><span> </span><span class="annot"><span class="annottext">Proxy LbsResponse
</span><span class="hs-identifier hs-var">R.lbsResponse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166509"><span class="hs-identifier hs-var">authopt</span></a></span><span> </span><span class="annot"><span class="annottext">Option 'Https -&gt; Option 'Https -&gt; Option 'Https
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166504"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#Get"><span class="hs-identifier hs-type">Get</span></a></span><span>    </span><span id="local-6989586621679166498"><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166498"><span class="hs-identifier hs-var">url</span></a></span></span><span>      </span><span id="local-6989586621679166497"><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166497"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GET
-&gt; Url 'Https
-&gt; NoReqBody
-&gt; Proxy LbsResponse
-&gt; Option 'Https
-&gt; RestIO LbsResponse
forall (m :: * -&gt; *) method body response (scheme :: Scheme).
(MonadHttp m, HttpMethod method, HttpBody body,
 HttpResponse response,
 HttpBodyAllowed (AllowsBody method) (ProvidesBody body)) =&gt;
method
-&gt; Url scheme
-&gt; body
-&gt; Proxy response
-&gt; Option scheme
-&gt; m response
</span><span class="hs-identifier hs-var">R.req</span></span><span> </span><span class="annot"><span class="annottext">GET
</span><span class="hs-identifier hs-var">R.GET</span></span><span>    </span><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166498"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">NoReqBody
</span><span class="hs-identifier hs-var">R.NoReqBody</span></span><span> </span><span class="annot"><span class="annottext">Proxy LbsResponse
</span><span class="hs-identifier hs-var">R.lbsResponse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166509"><span class="hs-identifier hs-var">authopt</span></a></span><span> </span><span class="annot"><span class="annottext">Option 'Https -&gt; Option 'Https -&gt; Option 'Https
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166497"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#Put"><span class="hs-identifier hs-type">Put</span></a></span><span>    </span><span id="local-6989586621679166494"><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166494"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span id="local-6989586621679166493"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679166493"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621679166492"><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166492"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PUT
-&gt; Url 'Https
-&gt; a
-&gt; Proxy LbsResponse
-&gt; Option 'Https
-&gt; RestIO LbsResponse
forall (m :: * -&gt; *) method body response (scheme :: Scheme).
(MonadHttp m, HttpMethod method, HttpBody body,
 HttpResponse response,
 HttpBodyAllowed (AllowsBody method) (ProvidesBody body)) =&gt;
method
-&gt; Url scheme
-&gt; body
-&gt; Proxy response
-&gt; Option scheme
-&gt; m response
</span><span class="hs-identifier hs-var">R.req</span></span><span> </span><span class="annot"><span class="annottext">PUT
</span><span class="hs-identifier hs-var">R.PUT</span></span><span>    </span><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166494"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679166493"><span class="hs-identifier hs-var">body</span></a></span><span>        </span><span class="annot"><span class="annottext">Proxy LbsResponse
</span><span class="hs-identifier hs-var">R.lbsResponse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166509"><span class="hs-identifier hs-var">authopt</span></a></span><span> </span><span class="annot"><span class="annottext">Option 'Https -&gt; Option 'Https -&gt; Option 'Https
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166492"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#Patch"><span class="hs-identifier hs-type">Patch</span></a></span><span>  </span><span id="local-6989586621679166489"><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166489"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span id="local-6989586621679166488"><span class="annot"><span class="annottext">RestIO a
</span><a href="#local-6989586621679166488"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621679166487"><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166487"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679166486"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679166486"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RestIO a
</span><a href="#local-6989586621679166488"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-132"></span><span>                                 </span><span class="annot"><span class="annottext">PATCH
-&gt; Url 'Https
-&gt; a
-&gt; Proxy LbsResponse
-&gt; Option 'Https
-&gt; RestIO LbsResponse
forall (m :: * -&gt; *) method body response (scheme :: Scheme).
(MonadHttp m, HttpMethod method, HttpBody body,
 HttpResponse response,
 HttpBodyAllowed (AllowsBody method) (ProvidesBody body)) =&gt;
method
-&gt; Url scheme
-&gt; body
-&gt; Proxy response
-&gt; Option scheme
-&gt; m response
</span><span class="hs-identifier hs-var">R.req</span></span><span> </span><span class="annot"><span class="annottext">PATCH
</span><span class="hs-identifier hs-var">R.PATCH</span></span><span>  </span><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166489"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679166486"><span class="hs-identifier hs-var">b</span></a></span><span>        </span><span class="annot"><span class="annottext">Proxy LbsResponse
</span><span class="hs-identifier hs-var">R.lbsResponse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166509"><span class="hs-identifier hs-var">authopt</span></a></span><span> </span><span class="annot"><span class="annottext">Option 'Https -&gt; Option 'Https -&gt; Option 'Https
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166487"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Discord.Internal.Rest.Prelude.html#Post"><span class="hs-identifier hs-type">Post</span></a></span><span>   </span><span id="local-6989586621679166483"><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166483"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span id="local-6989586621679166482"><span class="annot"><span class="annottext">RestIO a
</span><a href="#local-6989586621679166482"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621679166481"><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166481"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679166480"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679166480"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RestIO a
</span><a href="#local-6989586621679166482"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-134"></span><span>                                 </span><span class="annot"><span class="annottext">POST
-&gt; Url 'Https
-&gt; a
-&gt; Proxy LbsResponse
-&gt; Option 'Https
-&gt; RestIO LbsResponse
forall (m :: * -&gt; *) method body response (scheme :: Scheme).
(MonadHttp m, HttpMethod method, HttpBody body,
 HttpResponse response,
 HttpBodyAllowed (AllowsBody method) (ProvidesBody body)) =&gt;
method
-&gt; Url scheme
-&gt; body
-&gt; Proxy response
-&gt; Option scheme
-&gt; m response
</span><span class="hs-identifier hs-var">R.req</span></span><span> </span><span class="annot"><span class="annottext">POST
</span><span class="hs-identifier hs-var">R.POST</span></span><span>   </span><span class="annot"><span class="annottext">Url 'Https
</span><a href="#local-6989586621679166483"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679166480"><span class="hs-identifier hs-var">b</span></a></span><span>        </span><span class="annot"><span class="annottext">Proxy LbsResponse
</span><span class="hs-identifier hs-var">R.lbsResponse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166509"><span class="hs-identifier hs-var">authopt</span></a></span><span> </span><span class="annot"><span class="annottext">Option 'Https -&gt; Option 'Https -&gt; Option 'Https
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Option 'Https
</span><a href="#local-6989586621679166481"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span></pre></body></html>